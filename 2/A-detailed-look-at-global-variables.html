<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>全局变量和全局环境 | Deep JavaScript</title>
    <meta name="description" content="A book in the depths of JavaScript">
    <link rel="stylesheet" href="/deep-javascript-cn/assets/style.49790c05.css">
    <link rel="modulepreload" href="/deep-javascript-cn/assets/app.66821973.js">
    <link rel="modulepreload" href="/deep-javascript-cn/assets/2_A-detailed-look-at-global-variables.md.bed9838d.lean.js">
    
    <link rel="icon" href="/deep-javascript-cn/favicon.ico">
  <script>(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-6b5fd0a9><!--[--><!--]--><!--[--><span tabindex="-1" data-v-45f6ae50></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-45f6ae50> Skip to content </a><!--]--><!----><header class="VPNav" data-v-6b5fd0a9 data-v-0e356168><div class="VPNavBar has-sidebar" data-v-0e356168 data-v-8856f192><div class="container" data-v-8856f192><div class="VPNavBarTitle has-sidebar" data-v-8856f192 data-v-6a6f7ff6><a class="title" href="/deep-javascript-cn/" data-v-6a6f7ff6><!--[--><img class="VPImage logo" src="/deep-javascript-cn/js.svg" data-v-73ae1788><!--]--><!--[-->Deep JavaScript<!--]--></a></div><div class="content" data-v-8856f192><!----><!----><!----><div class="VPNavBarAppearance appearance" data-v-8856f192 data-v-311055f2><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-311055f2 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-8856f192 data-v-0562f5c0 data-v-8dccea88><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8dccea88><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-8dccea88><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-8dccea88><div class="VPMenu" data-v-8dccea88 data-v-e73581a2><!----><!--[--><!--[--><!----><div class="group" data-v-0562f5c0><div class="item appearance" data-v-0562f5c0><p class="label" data-v-0562f5c0>Appearance</p><div class="appearance-action" data-v-0562f5c0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-0562f5c0 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-8856f192 data-v-6f008456><span class="container" data-v-6f008456><span class="top" data-v-6f008456></span><span class="middle" data-v-6f008456></span><span class="bottom" data-v-6f008456></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-6b5fd0a9 data-v-92b0f14a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-92b0f14a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-92b0f14a><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-92b0f14a>Menu</span></button><a class="top-link" href="#" data-v-92b0f14a> Return to top </a></div><aside class="VPSidebar" data-v-6b5fd0a9 data-v-55e4c7db><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-55e4c7db><span class="visually-hidden" id="sidebar-aria-label" data-v-55e4c7db> Sidebar Navigation </span><!--[--><div class="group" data-v-55e4c7db><section class="VPSidebarGroup collapsible" data-v-55e4c7db data-v-1f69a7ed><div class="title" role="button" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>Ⅱ.类型，值，和变量</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/deep-javascript-cn/2/Type-coercion-in-JavaScript.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>2.⚡JS中的类型强转</span><!--]--><!----></a><a class="VPLink link" href="/deep-javascript-cn/2/The-destructuring-algorithm.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>3.解构算法</span><!--]--><!----></a><a class="VPLink link" href="/deep-javascript-cn/2/Environments-under-the-hood-of-variables.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>4.⚡环境-变量背后的原理</span><!--]--><!----></a><a class="VPLink link active" href="/deep-javascript-cn/2/A-detailed-look-at-global-variables.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>5.⚡深入理解全局变量</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup collapsible" data-v-55e4c7db data-v-1f69a7ed><div class="title" role="button" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>Ⅲ.数据处理</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/deep-javascript-cn/3/Copying-objects-and-arrays.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>7.JS对象和数组的拷贝</span><!--]--><!----></a><a class="VPLink link" href="/deep-javascript-cn/3/Updating-data-destructively-and-non-destructively.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>8.破坏性和非破坏性更新数据</span><!--]--><!----></a><a class="VPLink link" href="/deep-javascript-cn/3/The-problem-of-shared-mutable-state-and-how-to-avoid-them.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>9.共享可变状态问题</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup collapsible" data-v-55e4c7db data-v-1f69a7ed><div class="title" role="button" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>Ⅳ.OOP：对象属性特性</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/deep-javascript-cn/4/Property-attributes-an-Introduction.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>10.⚡属性特性介绍</span><!--]--><!----></a><a class="VPLink link" href="/deep-javascript-cn/4/Protecting-objects-from-changed.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>11.保护对象更改</span><!--]--><!----></a><a class="VPLink link" href="/deep-javascript-cn/4/Properties-assignment-vs-definition.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>12.⚡属性赋值和属性定义</span><!--]--><!----></a><a class="VPLink link" href="/deep-javascript-cn/4/Enumerability-of-Properties.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>13.属性的可枚举性</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup collapsible" data-v-55e4c7db data-v-1f69a7ed><div class="title" role="button" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>Ⅴ.OOP技术</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/deep-javascript-cn/5/Techniques-for-instantiating-classes.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>14.⚡实例化类技术（异步属性）</span><!--]--><!----></a><a class="VPLink link" href="/deep-javascript-cn/5/Copying-instances-of-classes-clone-vs-copy-constructors.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>15.类实例拷贝-clone&amp;拷贝构造器</span><!--]--><!----></a><a class="VPLink link" href="/deep-javascript-cn/5/Immutable-wrappers-for-collections.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>16.集合不可变性包装器</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup collapsible" data-v-55e4c7db data-v-1f69a7ed><div class="title" role="button" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>Ⅵ.正则表达式</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/deep-javascript-cn/6/Regular-expressions-lookaround-assertions-by-example.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>17.⚡正则环视断言</span><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-55e4c7db><section class="VPSidebarGroup collapsible" data-v-55e4c7db data-v-1f69a7ed><div class="title" role="button" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>Ⅶ.其它话题：元编程</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/deep-javascript-cn/7/Metaprogramming-with-Proxies.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>20.⚡使用Proxies进行元编程</span><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-6b5fd0a9 data-v-a4c57a06><div class="VPDoc has-sidebar" data-v-a4c57a06 data-v-79ca2460><div class="container" data-v-79ca2460><div class="aside" data-v-79ca2460><div class="aside-curtain" data-v-79ca2460></div><div class="aside-container" data-v-79ca2460><div class="aside-content" data-v-79ca2460><div class="VPDocAside" data-v-79ca2460 data-v-779d834d><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-779d834d data-v-51e5a8ce><div class="content" data-v-51e5a8ce><div class="outline-marker" data-v-51e5a8ce></div><div class="outline-title" data-v-51e5a8ce>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-51e5a8ce><span class="visually-hidden" id="doc-outline-aria-label" data-v-51e5a8ce> Table of Contents for current page </span><ul class="root" data-v-51e5a8ce><!--[--><li style="" data-v-51e5a8ce><a class="outline-link" href="#_1️⃣-作用域" data-v-51e5a8ce>1️⃣ 作用域</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_2️⃣-词法环境" data-v-51e5a8ce>2️⃣ 词法环境</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_3️⃣-全局对象" data-v-51e5a8ce>3️⃣ 全局对象</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_4️⃣-在浏览器中，globalthis-不直接指向全局对象" data-v-51e5a8ce>4️⃣ 在浏览器中，globalThis 不直接指向全局对象</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_5️⃣-全局环境" data-v-51e5a8ce>5️⃣ 全局环境</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_6️⃣-总结：为什么js同时拥有普通全局变量和全局对象？" data-v-51e5a8ce>6️⃣ 总结：为什么JS同时拥有普通全局变量和全局对象？</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_7️⃣-进一步阅读和本章来源" data-v-51e5a8ce>7️⃣ 进一步阅读和本章来源</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-779d834d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-79ca2460><div class="content-container" data-v-79ca2460><!--[--><!--]--><main class="main" data-v-79ca2460><div style="position:relative;" class="vp-doc _deep-javascript-cn_2_A-detailed-look-at-global-variables" data-v-79ca2460><div><p>目录：</p><nav class="table-of-contents"><ul><li><a href="#_1️⃣-作用域">1️⃣ 作用域</a></li><li><a href="#_2️⃣-词法环境">2️⃣ 词法环境</a></li><li><a href="#_3️⃣-全局对象">3️⃣ 全局对象</a></li><li><a href="#_4️⃣-在浏览器中，globalthis-不直接指向全局对象">4️⃣ 在浏览器中，globalThis 不直接指向全局对象</a></li><li><a href="#_5️⃣-全局环境">5️⃣ 全局环境</a><ul><li><a href="#_5-1-脚本作用域和模块作用域">5.1 脚本作用域和模块作用域</a></li><li><a href="#_5-2-创建变量：声明式记录-vs-对象记录">5.2 创建变量：声明式记录 vs. 对象记录</a></li><li><a href="#_5-3-获取或设置变量">5.3 获取或设置变量</a></li><li><a href="#_5-4-全局ecmascript变量-和-全局宿主变量">5.4 全局ECMAScript变量 和 全局宿主变量</a></li></ul></li><li><a href="#_6️⃣-总结：为什么js同时拥有普通全局变量和全局对象？">6️⃣ 总结：为什么JS同时拥有普通全局变量和全局对象？</a></li><li><a href="#_7️⃣-进一步阅读和本章来源">7️⃣ 进一步阅读和本章来源</a></li></ul></nav><p>本章将详细的看一看JS全局变量是如何工作的。几个有趣的现象扮演着重要的角色：脚本作用域，所谓的 <em>全局对象（<code>global object</code>）</em> 以及其它。</p><p id="1"></p><h2 id="_1️⃣-作用域" tabindex="-1">1️⃣ 作用域 <a class="header-anchor" href="#_1️⃣-作用域" aria-hidden="true">#</a></h2><p>📚一个变量的词法作用域（<code>lexical scope</code>, 简称 <code>scope</code>） 是一个程序能访问到的区域。JS作用域是<em>静态的</em>（在运行时不会改变），并且作用域可以进行嵌套：🌰</p><div class="language-js"><span class="copy"></span><div class="highlight-lines"><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br></div><pre><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">func</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// A</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">aVariable</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">     </span><span style="color:#676E95;font-style:italic;">// B</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">anotherVariable</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>if</code> 语句（B行）产生的作用域嵌套在函数 <code>func()</code> (A行) 中。</p><p>包裹在 <code>S</code> 作用域称外的作用域称之为S的 <strong>外部作用域（<code>outer scope</code>）</strong>，上例中 <code>func</code> 便是 <code>if</code> 的外部作用域。</p><p id="2"></p><h2 id="_2️⃣-词法环境" tabindex="-1">2️⃣ 词法环境 <a class="header-anchor" href="#_2️⃣-词法环境" aria-hidden="true">#</a></h2><p>在JS语言规范中，作用域通过 <em>词法环境（<code>lexical environments</code>）</em> 实现。由2个组件组成：</p><ul><li>一个 <em>环境记录（<code>environment record</code>）</em> 将变量名映射到变量值（可理解为字典）。这是该作用域中存储变量的实际存储空间。记录中的 <code>name-value</code> 条目（<code>entries</code>）称之为 <em>绑定（<code>bindings</code>）</em></li><li>一个 <em>外部环境（<code>outer environment</code>）</em> 的引用：外部作用域的环境</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>👩🏻‍🏫 因此，嵌套作用域树通过外部环境引用的环境树表示（The tree of nested scopes is therefore represented by a tree of environments linked by outer environment references）。</p></div><p id="3"></p><h2 id="_3️⃣-全局对象" tabindex="-1">3️⃣ 全局对象 <a class="header-anchor" href="#_3️⃣-全局对象" aria-hidden="true">#</a></h2><p>全局对象是指其属性变为全局变量的对象（我们将稍后检查它如何准确地适合环境树。）。它可以通过以下全局变量被访问：</p><ul><li>所有平台都能访问： <a href="https://exploringjs.com/impatient-js/ch_variables-assignment.html#globalThis" target="_blank" rel="noopener noreferrer">globalThis</a>。这个名字的由来基于它和全局作用于下的 <code>this</code> 拥有相同的值的事实。</li><li>其它全局对象不是所有平台都存在： <ul><li><code>window</code> 是引用全局对象的经典方式。它在浏览器代码中运行正常，但是不支持 <em>Web Workers（和浏览器进程并行运行的进程）</em> 和 Node.js</li><li><code>self</code> 在浏览器环境（包括Web Workers）中都可以访问，但不支持Node.js</li><li><code>global</code> 只存在于Node.js 中</li></ul></li></ul><p id="4"></p><h2 id="_4️⃣-在浏览器中，globalthis-不直接指向全局对象" tabindex="-1">4️⃣ 在浏览器中，globalThis 不直接指向全局对象 <a class="header-anchor" href="#_4️⃣-在浏览器中，globalthis-不直接指向全局对象" aria-hidden="true">#</a></h2><p>在浏览器中，<code>globalThis</code> 不直接指向全局对象，存在一个间接性。示例，想象一下web页面中的 <code>iframe</code>:</p><ul><li>当iframe的 <code>src</code> 发生变化时，它将获取一个全新的全局对象</li><li>然而，<code>globalThis</code> 总是相同的值。该值可在iframe外部进行检验，示例如下（示例灵感来源于 <a href="https://github.com/tc39/proposal-global#html-and-the-windowproxy" target="_blank" rel="noopener noreferrer">an example in the globalThis proosal</a>）</li></ul><p><code>parent.html</code>文件：</p><div class="language-html"><span class="copy"></span><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">iframe</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">iframe.html?first</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">iframe</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">scirpt</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  const iframe = document.querySelector(&#39;iframe&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">  const icw = iframe.contentWindow // iframe的 &#39;globalThis&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  iframe.onload = () =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 访问iframe全局对象上的属性</span></span>
<span class="line"><span style="color:#A6ACCD;">    const firstGlobalThis = icw.globalThis</span></span>
<span class="line"><span style="color:#A6ACCD;">    const firstArray = icw.Array  // 全局对象 Array</span></span>
<span class="line"><span style="color:#A6ACCD;">    console.log(icw.iframeName) // &#39;first&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">    iframe.onload = () =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      const secondGlobalThis = icw.globalThis</span></span>
<span class="line"><span style="color:#A6ACCD;">      const secondArray = icw.Array</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">      // 全局对象是不同的</span></span>
<span class="line"><span style="color:#A6ACCD;">      console.log(icw.iframeName) // &#39;second&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">      console.log(secondArray === firstArray) // false</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span></span>
<span class="line"><span style="color:#A6ACCD;">      // 但是 globalThis 仍一样</span></span>
<span class="line"><span style="color:#A6ACCD;">      console.log(firstGlobalThis === secondGlobalThis) // true 🤩</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    // 改变iframe src</span></span>
<span class="line"><span style="color:#A6ACCD;">    iframe.src = &#39;iframe.html?second&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">scirpt</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p><code>iframe.html</code> 文件：</p><div class="language-html"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  globalThis</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iframeName </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> location</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">search</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">slice</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>👩🏻‍🏫 浏览器是如何确保 <code>globalThis</code> 这种情况下仍不改变的呢？浏览器内部对这2个对象进行了区分：</p><ul><li><a href="https://html.spec.whatwg.org/multipage/window-object.html#the-window-object" target="_blank" rel="noopener noreferrer">Window</a> 是全局对象，<strong>当location发生变化时，它也跟着发生变化 📚</strong>（译者注：这也是为什么微前端中调用window.reload()是最硬核的隔离的原因）</li><li><a href="https://html.spec.whatwg.org/multipage/window-object.html#the-windowproxy-exotic-object" target="_blank" rel="noopener noreferrer">WindowProxy</a> 是将所有访问转发到当前 <code>Window</code> 的一个对象。<strong>这个对象永远不会改变 😎</strong></li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>📚 在<strong>浏览器</strong>中，<code>globalThis</code> 指向 <code>WindowProxy</code>；则其余环境中，它直接指向全局对象。</p></div><p id="5"></p><h2 id="_5️⃣-全局环境" tabindex="-1">5️⃣ 全局环境 <a class="header-anchor" href="#_5️⃣-全局环境" aria-hidden="true">#</a></h2><p>全局作用域是最外层（<code>outermost</code>）的作用域 - 它上面没有外层作用域了。它的环境是 <em>全局环境（<code>global environment</code>）</em>。每个环境都通过由外部环境引用链接的环境链与全局环境连接，全局环境的外部环境引用是 <code>null</code>。（译者注：类似原型链的机制）</p><p>💡全局环境记录使用2个环境记录管理其变量：</p><ol><li>一个 <em>对象环境记录（<code>object environment record</code>）</em>,它和普通环境记录使用相同的接口，但是将其<em>绑定（<code>bindings</code>）</em> 保存在JS对象中。这种情况下，该对象为全局对象。</li><li>一个 <em>普通（声明式）环境记录（<code>normal (declarative) environment</code>）</em> 拥有自己存储绑定的空间 😎</li></ol><p>这两个记录中的哪一个在什么时候使用，稍后会解释。</p><p id="5.1"></p><h3 id="_5-1-脚本作用域和模块作用域" tabindex="-1">5.1 脚本作用域和模块作用域 <a class="header-anchor" href="#_5-1-脚本作用域和模块作用域" aria-hidden="true">#</a></h3><p>在JS中，只有最上层的脚本（<code>scripts</code>） 在全局作用域中。相比之下，每个模块都拥有自己的作用域，它们是脚本作用域的子作用域。</p><p>如果我们忽略变量绑定如何添加到全局环境的复杂规则，全局作用域和模块作用域工作原理就好像下面嵌套代码块一样：</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 全局作用域 （所有脚本的作用域）</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// （全局变量）</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 模块1作用域</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 模块2作用域</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// (更多模块作用域)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p id="5.2"></p><h3 id="_5-2-创建变量：声明式记录-vs-对象记录" tabindex="-1">5.2 创建变量：声明式记录 vs. 对象记录 <a class="header-anchor" href="#_5-2-创建变量：声明式记录-vs-对象记录" aria-hidden="true">#</a></h3><p>📚 为了创建一个真正的全局变量，我们必须在全局作用域中：即在最上层的脚本（<code>scirpts</code>）中:</p><ul><li>顶层 <code>const &amp; let</code> &amp; <code>class</code> 在声明式环境记录（<code>declarative environment record</code>）中创建绑定</li><li>顶层 <code>var</code> &amp; <code>function</code>声明 在对象环境记录中创建绑定</li></ul><div class="language-html"><span class="copy"></span><div class="highlight-lines"><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> one </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 声明式环境记录中创建绑定</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> two </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 对象环境记录中创建绑定</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 所有脚本共享相同的最上层作用域</span></span>
<span class="line"><span style="color:#A6ACCD;">  console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(one) </span><span style="color:#676E95;font-style:italic;">// 1</span></span>
<span class="line"><span style="color:#A6ACCD;">  console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(two) </span><span style="color:#676E95;font-style:italic;">// 2</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 并非所有声明都创建全局对象的属性 🤔</span></span>
<span class="line"><span style="color:#A6ACCD;">  console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(globalThis</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">one) </span><span style="color:#676E95;font-style:italic;">// undefined</span></span>
<span class="line"><span style="color:#A6ACCD;">  console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(globalThis</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">two) </span><span style="color:#676E95;font-style:italic;">// 2</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p id="5.3"></p><h3 id="_5-3-获取或设置变量" tabindex="-1">5.3 获取或设置变量 <a class="header-anchor" href="#_5-3-获取或设置变量" aria-hidden="true">#</a></h3><p>当我们获取或者设置一个变量，2个环境记录中都存在该变量的绑定时，声明式记录获胜😎：</p><div class="language-html"><span class="copy"></span><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> myGlobalVariable </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 声明式环境记录</span></span>
<span class="line"><span style="color:#A6ACCD;">  global</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">myGlobalVaribale </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 对象环境记录</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(myGlobalVariable) </span><span style="color:#676E95;font-style:italic;">// 1 (声明式环境记录获胜 ✌️)</span></span>
<span class="line"><span style="color:#A6ACCD;">  console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(globalThis</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">myGlobalVariable) </span><span style="color:#676E95;font-style:italic;">// 2 (从对象环境记录中获取)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p id="5.4"></p><h3 id="_5-4-全局ecmascript变量-和-全局宿主变量" tabindex="-1">5.4 全局ECMAScript变量 和 全局宿主变量 <a class="header-anchor" href="#_5-4-全局ecmascript变量-和-全局宿主变量" aria-hidden="true">#</a></h3><p>除了通过 <code>var</code> 或者 函数声明 创建的变量外，全局变量包含以下属性：</p><ul><li>ECMAScript所有内置的全局变量（比如 <code>Math</code>）</li><li>所有宿主平台（浏览器，Node.js等等）内置全局变量（比如 <code>global</code> | <code>window</code>）</li></ul><p>使用 <code>const | let</code> 可确保全局变量声明不受内置的ECMAScript &amp; 宿主全局变量影响或者影响到内置的ECMAScript &amp; 宿主全局变量。</p><p>比如：浏览器有一个 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/location" target="_blank" rel="noopener noreferrer">location</a> 全局变量：</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">// 将改变当前document的location（直接跳转到该地址）</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> location </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://example.com</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 屏蔽 window.location, 但是不会改变它</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> location </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://example.com</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>如果一个变量已经存在（比如这里的 <code>location</code>）, 则带有初始化器的<code>var</code> 声明表现得就像是赋值。这也是为什么我们这个例子会遇到麻烦。</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>👩🏻‍🏫 注意这只会在全局作用域中会存在问题。在模块中，我们永远不会在全局作用域中（除非使用类似 <code>eval()</code> 方法）。</p></div><p>总结目前所学到的：</p><p><img src="/deep-javascript-cn/assets/global-environment.bf6827ee.jpg" alt="global-environment"></p><ol><li>全局作用域的环境通过一个 <strong>全局环境记录（<code>Global environment record</code>）</strong> 管理其绑定</li><li>而 <em>全局环境记录</em> 又由2个环境记录组成： <ol><li><em>对象环境记录（<code>Object environment record</code>）</em> 将绑定存储在全局对象（<code>Global object</code>）上</li><li><em>声明式环境记录（<code>Declarative environment record</code>）</em> 使用自己内部存储记录其绑定</li></ol></li><li>因此，全局变量可以通过向全局对象添加属性或者通过各种声明（<code>var</code> | 函数声明）进行创建</li><li>全局对象的初始化包含ECMAScript全局变量和宿主平台提供的全局变量</li><li>每个ECMAScript模块（即 <code>ESM</code>）都拥有自己独立的环境，模块的外部环境是全局环境</li></ol><p id="6"></p><h2 id="_6️⃣-总结：为什么js同时拥有普通全局变量和全局对象？" tabindex="-1">6️⃣ 总结：为什么JS同时拥有普通全局变量和全局对象？ <a class="header-anchor" href="#_6️⃣-总结：为什么js同时拥有普通全局变量和全局对象？" aria-hidden="true">#</a></h2><p>全局对象通常被认为是一种错误。基于此，新的构建，比如 <code>const | let | classes</code> 创建普通全局变量（在脚本作用域时）。</p><p>幸运的是，大多数现代JS都写在 <a href="https://exploringjs.com/impatient-js/ch_modules.html" target="_blank" rel="noopener noreferrer">ESM 和 CJS 模块中</a>。每个模块都拥有自己独立的作用域，这也是为什么统治全局变量的规则在基于模块的代码中，就显得不那么重要了。</p><p id="7"></p><h2 id="_7️⃣-进一步阅读和本章来源" tabindex="-1">7️⃣ 进一步阅读和本章来源 <a class="header-anchor" href="#_7️⃣-进一步阅读和本章来源" aria-hidden="true">#</a></h2><p>ECMAScript规范中的环境和全局对象：</p><ul><li><a href="https://tc39.es/ecma262/#sec-lexical-environments" target="_blank" rel="noopener noreferrer">Section &quot;Lexical Environments&quot;</a> 提供对环境的概览</li><li><a href="https://tc39.es/ecma262/#sec-global-environment-records" target="_blank" rel="noopener noreferrer">Section &quot;Global Environment Records&quot;</a> 介绍了全局环境</li><li><a href="https://tc39.es/ecma262/#sec-ecmascript-standard-built-in-objects" target="_blank" rel="noopener noreferrer">Section &quot;ECMAScript Standard Built-in Objects&quot;</a> 描述ECMAScript如何管理其内置对象的（包括全局对象）</li></ul><p><code>globalThis</code>:</p><ul><li><a href="https://2ality.com/2019/08/global-this.html" target="_blank" rel="noopener noreferrer">ES feature: globalThis</a> 2ality文章</li><li><a href="https://mathiasbynens.be/notes/globalthis" target="_blank" rel="noopener noreferrer">Ahorrifying globalThis polyfill in universal JavaScript</a> 各种访问全局 <code>this</code> 的方式</li></ul><p>浏览器中的全局对象：</p><ul><li><a href="https://blog.whatwg.org/windowproxy-window-and-location" target="_blank" rel="noopener noreferrer">Defining the WindowProxy, Window and Location objects</a> 浏览器发生了什么</li><li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#realms-settings-objects-global-objects" target="_blank" rel="noopener noreferrer">section &quot;Realm, settings objects and global objects&quot;</a> WHATWG HTML标准（非常技术性）</li><li>在ECMAScript 规范中，我们可以看到浏览器如何自定义全局this的 <a href="https://tc39.es/ecma262/#sec-initializehostdefinedrealm" target="_blank" rel="noopener noreferrer">section &quot;InitializeHostDefinedRealm()&quot;</a></li></ul><p>原文链接：</p><ul><li><a href="https://exploringjs.com/deep-js/ch_global-scope.html" target="_blank" rel="noopener noreferrer">5 A Detailed look at global variables</a></li></ul><p>2022年07月04日16:22:00</p></div></div></main><footer class="VPDocFooter" data-v-79ca2460 data-v-04568844><div class="edit-info" data-v-04568844><div class="edit-link" data-v-04568844><a class="VPLink link edit-link-button" href="https://github.com/jamessawyer/deep-javascript-cn/edit/main/docs/2/A-detailed-look-at-global-variables.md" target="_blank" rel="noopener noreferrer" data-v-04568844 data-v-5704c677><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" data-v-04568844><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> 在GitHub编辑此页<!--]--><!----></a></div><div class="last-updated" data-v-04568844><p class="VPLastUpdated" data-v-04568844 data-v-0ce8c960>Last updated: <time datatime="2022-08-02T06:47:11.000Z" data-v-0ce8c960></time></p></div></div><div class="prev-next" data-v-04568844><div class="pager" data-v-04568844><a class="pager-link prev" href="/deep-javascript-cn/2/Environments-under-the-hood-of-variables.html" data-v-04568844><span class="desc" data-v-04568844>Previous page</span><span class="title" data-v-04568844>4.⚡环境-变量背后的原理</span></a></div><div class="has-prev pager" data-v-04568844><a class="pager-link next" href="/deep-javascript-cn/3/Copying-objects-and-arrays.html" data-v-04568844><span class="desc" data-v-04568844>Next page</span><span class="title" data-v-04568844>7.JS对象和数组的拷贝</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"2_a-detailed-look-at-global-variables.md\":\"bed9838d\",\"2_environments-under-the-hood-of-variables.md\":\"91eac52e\",\"2_the-destructuring-algorithm.md\":\"91508f2d\",\"2_type-coercion-in-javascript.md\":\"ae3ec813\",\"3_copying-objects-and-arrays.md\":\"ca8fc35b\",\"3_the-problem-of-shared-mutable-state-and-how-to-avoid-them.md\":\"30359ef3\",\"3_updating-data-destructively-and-non-destructively.md\":\"b8f72886\",\"4_enumerability-of-properties.md\":\"c05b4e3a\",\"4_properties-assignment-vs-definition.md\":\"642c344d\",\"4_property-attributes-an-introduction.md\":\"d0e92b42\",\"4_protecting-objects-from-changed.md\":\"bd4fa559\",\"5_copying-instances-of-classes-clone-vs-copy-constructors.md\":\"3ea15a7b\",\"5_immutable-wrappers-for-collections.md\":\"51931918\",\"5_techniques-for-instantiating-classes.md\":\"46a645e2\",\"6_regular-expressions-lookaround-assertions-by-example.md\":\"2a3eae7c\",\"7_metaprogramming-with-proxies.md\":\"e157ba83\",\"index.md\":\"4c1e9617\"}")</script>
    <script type="module" async src="/deep-javascript-cn/assets/app.66821973.js"></script>
    
  </body>
</html>