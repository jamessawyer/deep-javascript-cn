import{_ as s,c as a,o as n,O as l}from"./chunks/framework.103df890.js";const C=JSON.parse('{"title":"å…±äº«å¯å˜çŠ¶æ€é—®é¢˜","description":"","frontmatter":{"title":"å…±äº«å¯å˜çŠ¶æ€é—®é¢˜"},"headers":[],"relativePath":"3/The-problem-of-shared-mutable-state-and-how-to-avoid-them.md","lastUpdated":1682474873000}'),p={name:"3/The-problem-of-shared-mutable-state-and-how-to-avoid-them.md"},o=l(`<p>ç›®å½•ï¼š</p><nav class="table-of-contents"><ul><li><a href="#_1ï¸âƒ£-ä»€ä¹ˆæ˜¯å…±äº«å¯å˜çŠ¶æ€åŠä¸ºä»€ä¹ˆè¿™ä¼šæˆä¸ºé—®é¢˜">1ï¸âƒ£ ä»€ä¹ˆæ˜¯å…±äº«å¯å˜çŠ¶æ€åŠä¸ºä»€ä¹ˆè¿™ä¼šæˆä¸ºé—®é¢˜?</a></li><li><a href="#_2ï¸âƒ£-é€šè¿‡æ‹·è´æ•°æ®é¿å…å…±äº«">2ï¸âƒ£ é€šè¿‡æ‹·è´æ•°æ®é¿å…å…±äº«</a><ul><li><a href="#_2-1-æ‹·è´æ˜¯å¦‚ä½•å¸®åŠ©è§£å†³å…±äº«å¯å˜çŠ¶æ€çš„">2.1 æ‹·è´æ˜¯å¦‚ä½•å¸®åŠ©è§£å†³å…±äº«å¯å˜çŠ¶æ€çš„ï¼Ÿ</a></li></ul></li><li><a href="#_3ï¸âƒ£-é€šè¿‡éç ´åæ€§æ›´æ–°é¿å…çªå˜">3ï¸âƒ£ é€šè¿‡éç ´åæ€§æ›´æ–°é¿å…çªå˜</a><ul><li><a href="#_3-1-éç ´åæ€§æ›´æ–°å¦‚ä½•å¯¹å…±äº«å¯å˜çŠ¶æ€æœ‰å¸®åŠ©çš„">3.1 éç ´åæ€§æ›´æ–°å¦‚ä½•å¯¹å…±äº«å¯å˜çŠ¶æ€æœ‰å¸®åŠ©çš„ï¼Ÿ</a></li></ul></li><li><a href="#_4ï¸âƒ£-ä½¿æ•°æ®ä¸å¯å˜çš„æ–¹å¼é˜»æ­¢çªå˜">4ï¸âƒ£ ä½¿æ•°æ®ä¸å¯å˜çš„æ–¹å¼é˜»æ­¢çªå˜</a><ul><li><a href="#_4-1-ä¸å¯å˜æ€§å¦‚ä½•å¸®åŠ©å…±äº«å¯å˜çŠ¶æ€çš„">4.1 ä¸å¯å˜æ€§å¦‚ä½•å¸®åŠ©å…±äº«å¯å˜çŠ¶æ€çš„ï¼Ÿ</a></li></ul></li><li><a href="#_5ï¸âƒ£-é¿å…å…±äº«å¯å˜çŠ¶æ€çš„åº“">5ï¸âƒ£ é¿å…å…±äº«å¯å˜çŠ¶æ€çš„åº“</a><ul><li><a href="#_5-1-immutable-js">5.1 Immutable.js</a></li><li><a href="#_5-2-immer">5.2 Immer</a></li></ul></li></ul></nav><p>æœ¬ç« å°†å›ç­”å¦‚ä¸‹3ä¸ªé—®é¢˜ï¼š</p><ol><li>ä»€ä¹ˆæ˜¯å…±äº«å¯å˜çŠ¶æ€ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆå…±äº«å¯å˜çŠ¶æ€ä¼šæˆä¸ºéº»çƒ¦ï¼Ÿ</li><li>å¦‚ä½•é¿å…è¿™äº›éº»çƒ¦ï¼Ÿ</li></ol><p id="1"></p><h2 id="_1ï¸âƒ£-ä»€ä¹ˆæ˜¯å…±äº«å¯å˜çŠ¶æ€åŠä¸ºä»€ä¹ˆè¿™ä¼šæˆä¸ºé—®é¢˜" tabindex="-1">1ï¸âƒ£ ä»€ä¹ˆæ˜¯å…±äº«å¯å˜çŠ¶æ€åŠä¸ºä»€ä¹ˆè¿™ä¼šæˆä¸ºé—®é¢˜? <a class="header-anchor" href="#_1ï¸âƒ£-ä»€ä¹ˆæ˜¯å…±äº«å¯å˜çŠ¶æ€åŠä¸ºä»€ä¹ˆè¿™ä¼šæˆä¸ºé—®é¢˜" aria-label="Permalink to &quot;1ï¸âƒ£ ä»€ä¹ˆæ˜¯å…±äº«å¯å˜çŠ¶æ€åŠä¸ºä»€ä¹ˆè¿™ä¼šæˆä¸ºé—®é¢˜?&quot;">â€‹</a></h2><p>å…±äº«å¯å˜çŠ¶æ€æ•ˆæœå¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœ2æ–¹æˆ–æ›´å¤šæ–¹ï¼ˆ<code>parties</code>ï¼‰å¯ä»¥æ”¹å˜ç›¸åŒçš„æ•°æ®ï¼ˆå˜é‡ï¼Œå¯¹è±¡ç­‰ï¼‰</li><li>å¹¶ä¸”å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸæœ‰é‡å </li><li>åˆ™ä¼šå­˜åœ¨æŸä¸€æ–¹çš„ä¿®æ”¹ä¼šå¯¼è‡´å…¶å®ƒæ–¹ä¸èƒ½æ­£å¸¸å·¥ä½œ</li></ul><p>ğŸš¨æ³¨æ„è¿™ä¸ªå®šä¹‰é€‚ç”¨äºå‡½æ•°è°ƒç”¨ï¼Œåä½œå¼å¤šä»»åŠ¡ï¼ˆæ¯”å¦‚ï¼ŒJSä¸­çš„å¼‚æ­¥å‡½æ•°ï¼‰ç­‰ã€‚é£é™©éƒ½ç±»ä¼¼ã€‚</p><p>ä¸‹é¢ä»£ç æ˜¯ä¸ªä¾‹å­ã€‚è¿™ä¸ªä¾‹å­ä¸å¤ªç°å®ï¼Œä»…åšæ¼”ç¤ºå’Œä¾¿äºç†è§£ä½¿ç”¨ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">logElements</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">arr</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">shift</span><span style="color:#F07178;">())</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">arr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">banana</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">orange</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">apple</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Before sorting</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">logElements</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">arr</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sort</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// æ”¹å˜äº†arr</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">After sorting:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">logElements</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">arr</span><span style="color:#F07178;">)  </span><span style="color:#676E95;font-style:italic;">// A</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¾“å‡ºç»“æœ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;Before sorting:&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;banana&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;orange&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;apple&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;After sorting:&#39;</span></span></code></pre></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ä¸ªç‹¬ç«‹çš„å½“äº‹æ–¹:</p><ul><li>å‡½æ•° <code>main()</code> æƒ³è¦åœ¨æ•°ç»„æ’åºå‰åè®°å½•å®ƒ</li><li>å‡½æ•° <code>logElements()</code> è®°å½•å…¶å‚æ•° <code>arr</code> ä¸­çš„å…ƒç´ ï¼Œä½†æ˜¯è¿™æ ·åšçš„æ—¶å€™å´ç§»é™¤äº†æ•°ç»„ä¸­çš„å…ƒç´ ğŸ˜…</li></ul><p><code>logElements()</code> ç ´åäº† <code>main()</code>ï¼Œå¹¶å¯¼è‡´ <code>A</code> è¡Œæ‰“å°äº†ä¸€ä¸ªç©ºæ•°ç»„ã€‚</p><p>åœ¨æœ¬ç« åç»­éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†çœ‹3ç§é¿å…å…±äº«å¯å˜çŠ¶æ€å¼•å‘çš„é—®é¢˜çš„3ç§æ–¹å¼ï¼š</p><ol><li>é€šè¿‡æ‹·è´æ•°æ®é¿å…å…±äº«</li><li>é€šè¿‡éç ´åæ€§æ›´æ–°é¿å…çªå˜ï¼ˆ<code>mutations</code>ï¼‰</li><li>ä½¿æ•°æ®ä¸å¯å˜ï¼ˆ<code>immutable</code>ï¼‰ä»¥ä¾¿é˜»æ­¢çªå˜</li></ol><p>ç‰¹åˆ«çš„ï¼Œæˆ‘ä»¬å°†ç¨åå›é¡¾ä¸Šé¢çš„ä¾‹å­ï¼Œå¹¶ä¿®å¤å®ƒã€‚</p><p id="2"></p><h2 id="_2ï¸âƒ£-é€šè¿‡æ‹·è´æ•°æ®é¿å…å…±äº«" tabindex="-1">2ï¸âƒ£ é€šè¿‡æ‹·è´æ•°æ®é¿å…å…±äº« <a class="header-anchor" href="#_2ï¸âƒ£-é€šè¿‡æ‹·è´æ•°æ®é¿å…å…±äº«" aria-label="Permalink to &quot;2ï¸âƒ£ é€šè¿‡æ‹·è´æ•°æ®é¿å…å…±äº«&quot;">â€‹</a></h2><p><em>æ‹·è´æ•°æ®æ˜¯é¿å…å…±äº«çš„ä¸€ç§æ–¹å¼ã€‚</em></p><p>ğŸ’¡å¯¹æ‹·è´æ•°æ®ï¼Œå¯ä»¥å‚è€ƒæœ¬ä¹¦çš„ä¸‹é¢2ç« ï¼š</p><ul><li><a href="./Copying-objects-and-arrays.html">7.Copying objects and Arrays</a></li><li><a href="./../5/Copying-instances-of-classes-clone-vs-copy-constructors.html">15.Copying instances of classes: .clone() vs. copy constructors</a></li></ul><p id="2.1"></p><h3 id="_2-1-æ‹·è´æ˜¯å¦‚ä½•å¸®åŠ©è§£å†³å…±äº«å¯å˜çŠ¶æ€çš„" tabindex="-1">2.1 æ‹·è´æ˜¯å¦‚ä½•å¸®åŠ©è§£å†³å…±äº«å¯å˜çŠ¶æ€çš„ï¼Ÿ <a class="header-anchor" href="#_2-1-æ‹·è´æ˜¯å¦‚ä½•å¸®åŠ©è§£å†³å…±äº«å¯å˜çŠ¶æ€çš„" aria-label="Permalink to &quot;2.1 æ‹·è´æ˜¯å¦‚ä½•å¸®åŠ©è§£å†³å…±äº«å¯å˜çŠ¶æ€çš„ï¼Ÿ&quot;">â€‹</a></h3><p><strong>åªè¦æˆ‘ä»¬åªä»å…±äº«æ•°æ®ä¸­ è¯»ï¼ˆ<code>read</code>ï¼‰æ•°æ®ï¼Œæˆ‘ä»¬ä»€ä¹ˆé—®é¢˜ä¹Ÿæ²¡æœ‰</strong>ã€‚åœ¨ <em>ä¿®æ”¹ï¼ˆ<code>modifying</code>ï¼‰</em> æ•°æ®å‰ï¼Œæˆ‘ä»¬å¯é€šè¿‡æ‹·è´ï¼ˆå¿…è¦æ—¶éœ€æ·±æ‹·è´ï¼‰æ–¹å¼ <em>å–æ¶ˆå…±äº«ï¼ˆ<code>un-share</code>ï¼‰</em> å®ƒã€‚</p><p>ğŸš€ğŸš€ <em>é˜²å¾¡æ€§æ‹·è´ï¼ˆ<code>Defensive copying</code>ï¼‰</em> æ˜¯ä¸€ç§åœ¨å¯èƒ½å‡ºç°é—®é¢˜æ—¶å§‹ç»ˆè¿›è¡Œå¤åˆ¶çš„æŠ€æœ¯ã€‚å®ƒçš„ç›®çš„æ˜¯ä¿è¯å½“å‰å®ä½“ï¼ˆå‡½æ•°ï¼Œç±»ï¼Œç­‰ï¼‰çš„å®‰å…¨ï¼š</p><ul><li>è¾“å…¥ï¼šæ‹·è´æ½œåœ¨ä¼ ç»™æˆ‘ä»¬çš„å…±äº«æ•°æ®ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸æ‰“æ‰°å¤–éƒ¨æ•°æ®çš„å‰æä¸‹ï¼Œä½¿ç”¨è¯¥æ•°æ®</li><li>è¾“å‡ºï¼šåœ¨æš´éœ²ç»™å¤–ç•Œå‰ï¼Œ æˆ‘ä»¬æ‹·è´å†…éƒ¨æ•°æ®ï¼Œè¿™æ„å‘³ç€å¤–éƒ¨ä¸èƒ½å¹²æ‰°åˆ°æˆ‘ä»¬å†…éƒ¨çš„æ´»åŠ¨</li></ul><p>æ³¨æ„ï¼Œè¿™äº›æªæ–½ä¿æŠ¤æˆ‘ä»¬ä¸å—å…¶ä»–æ–¹é¢çš„å½±å“ï¼Œä½†å®ƒä»¬ä¹Ÿä¿æŠ¤å…¶ä»–æ–¹é¢ä¸å—æˆ‘ä»¬çš„å½±å“ã€‚</p><p>ä¸‹é¢é˜è¿°è¿™2ç§é˜²å¾¡æ€§æ‹·è´ã€‚</p><h4 id="_2-1-1-æ‹·è´å…±äº«è¾“å…¥" tabindex="-1">2.1.1 æ‹·è´å…±äº«è¾“å…¥ <a class="header-anchor" href="#_2-1-1-æ‹·è´å…±äº«è¾“å…¥" aria-label="Permalink to &quot;2.1.1 æ‹·è´å…±äº«è¾“å…¥&quot;">â€‹</a></h4><p>è¿˜è®°å¾—åœ¨æœ¬ç« å¼€å§‹çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†éº»çƒ¦ï¼Œå› ä¸º<code>logElements()</code>ä¿®æ”¹äº†å®ƒçš„å‚æ•°<code>arr</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">logElements</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">arr</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">shift</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ˜è®©æˆ‘ä»¬ç»™è¿™ä¸ªå‡½æ•°æ·»åŠ é˜²å¾¡æ€§æ‹·è´ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">logElements</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">arr</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">arr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">arr</span><span style="color:#F07178;">] </span><span style="color:#676E95;font-style:italic;">// é˜²å¾¡æ€§æ‹·è´</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">shift</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ <code>main()</code> ä¸­å†è°ƒç”¨ <code>logElements()</code> ä¸ä¼šå­˜åœ¨ä»»ä½•é—®é¢˜äº†ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">arr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">banana</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">orange</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">apple</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Before sorting</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">logElements</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">arr</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sort</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// æ”¹å˜äº†arr</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">After sorting:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">logElements</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">arr</span><span style="color:#F07178;">)  </span><span style="color:#676E95;font-style:italic;">// A</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ‰“å°ç»“æœ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;Before sorting:&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;banana&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;orange&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;apple&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;After sorting:&#39;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// &#39;apple&#39;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// &#39;banana&#39;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// &#39;orange&#39;</span></span></code></pre></div><h4 id="_2-1-2-å¯¹æš´éœ²çš„å†…éƒ¨æ•°æ®è¿›è¡Œæ‹·è´" tabindex="-1">2.1.2 å¯¹æš´éœ²çš„å†…éƒ¨æ•°æ®è¿›è¡Œæ‹·è´ <a class="header-anchor" href="#_2-1-2-å¯¹æš´éœ²çš„å†…éƒ¨æ•°æ®è¿›è¡Œæ‹·è´" aria-label="Permalink to &quot;2.1.2 å¯¹æš´éœ²çš„å†…éƒ¨æ•°æ®è¿›è¡Œæ‹·è´&quot;">â€‹</a></h4><p>æˆ‘ä»¬å…ˆä»ç±» <code>StringBuilder</code> å¼€å§‹ï¼Œå®ƒåœ¨ <code>A</code> è¡Œæ²¡æœ‰æ‹·è´æš´éœ²ç»™å¤–éƒ¨çš„å†…éƒ¨æ•°æ®ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">StringBuilder</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">_data</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">add</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">getParts</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ğŸš¨ è¿™é‡Œå‘å¤–éƒ¨æš´éœ²äº†å†…éƒ¨æ•°æ®</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    ä½†æ˜¯æ²¡æœ‰å¯¹å…¶è¿›è¡Œæ‹·è´</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_data</span><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">// A</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">toString</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>åªè¦ä¸ä½¿ç”¨ <code>getParts()</code> æ–¹æ³•ï¼Œä¸€åˆ‡æ­£å¸¸:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> sb1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">StringBuilderr</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">sb1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">sb1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> world!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(sb1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello world!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>ç„¶è€Œï¼Œå¦‚æœæ”¹å˜äº† <code>.getParts()</code> çš„è¿”å›ç»“æœï¼ˆ<code>A</code> è¡Œï¼‰ï¼Œä¼šä½¿å¾— <code>StringBuilder</code> å°†å˜å¾—ä¸æ­£å¸¸ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> sb2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">StringBuilderr</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">sb2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">sb2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> world!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">sb2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getParts</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// A</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(sb2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// âŒ ä¸æ­£å¸¸</span></span></code></pre></div><p>ğŸ˜è§£å†³åŠæ³•å°±æ˜¯ï¼Œåœ¨æš´éœ²å†…éƒ¨æ•°æ® <code>_data</code> ä¹‹å‰ï¼ˆAè¡Œï¼‰å¯¹å…¶è¿›è¡Œé˜²å¾¡æ€§æ‹·è´ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">StringBuilder</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">_data</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">add</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">getParts</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ğŸš¨ é˜²å¾¡æ€§æ‹·è´</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">...this.</span><span style="color:#A6ACCD;">_data</span><span style="color:#F07178;"> ] </span><span style="color:#676E95;font-style:italic;">// A</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">toString</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ç°åœ¨å†æ”¹å˜ <code>.getParts()</code> çš„ç»“æœä¸å†ä¼šå½±å“åˆ°å®ä¾‹çš„æ“ä½œï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> sb </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">StringBuilderr</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">sb</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">sb</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> world!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">sb</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getParts</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// A ä¸å†å½±å“å®ä¾‹sb</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(sb</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello world!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// âœ…</span></span></code></pre></div><p id="3"></p><h2 id="_3ï¸âƒ£-é€šè¿‡éç ´åæ€§æ›´æ–°é¿å…çªå˜" tabindex="-1">3ï¸âƒ£ é€šè¿‡éç ´åæ€§æ›´æ–°é¿å…çªå˜ <a class="header-anchor" href="#_3ï¸âƒ£-é€šè¿‡éç ´åæ€§æ›´æ–°é¿å…çªå˜" aria-label="Permalink to &quot;3ï¸âƒ£ é€šè¿‡éç ´åæ€§æ›´æ–°é¿å…çªå˜&quot;">â€‹</a></h2><p>å¦‚æœæˆ‘ä»¬éç ´åæ€§çš„æ›´æ–°æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…çªå˜ã€‚</p><p>ğŸ’¡å…³äºæ›´æ–°æ•°æ®ï¼Œå¯å‚è€ƒä¸Šä¸€ç« ï¼š</p><ul><li><a href="./Updating-data-destructively-and-non-destructively.html">8.Updating data destructively and non-destructively</a></li></ul><p id="3.1"></p><h3 id="_3-1-éç ´åæ€§æ›´æ–°å¦‚ä½•å¯¹å…±äº«å¯å˜çŠ¶æ€æœ‰å¸®åŠ©çš„" tabindex="-1">3.1 éç ´åæ€§æ›´æ–°å¦‚ä½•å¯¹å…±äº«å¯å˜çŠ¶æ€æœ‰å¸®åŠ©çš„ï¼Ÿ <a class="header-anchor" href="#_3-1-éç ´åæ€§æ›´æ–°å¦‚ä½•å¯¹å…±äº«å¯å˜çŠ¶æ€æœ‰å¸®åŠ©çš„" aria-label="Permalink to &quot;3.1 éç ´åæ€§æ›´æ–°å¦‚ä½•å¯¹å…±äº«å¯å˜çŠ¶æ€æœ‰å¸®åŠ©çš„ï¼Ÿ&quot;">â€‹</a></h3><p>é€šè¿‡éç ´åæ€§æ›´æ–°ï¼Œå…±äº«å¯å˜çŠ¶æ€ä¸å†æ˜¯é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬æ°¸è¿œä¸ä¼šæ”¹å˜è¯¥å…±äº«å¯å˜çŠ¶æ€ã€‚ï¼ˆæ³¨æ„ï¼šåªæœ‰æ¯ä¸ªè®¿é—®æ•°æ®çš„æ“ä½œéƒ½è¿™æ ·åšï¼Œæ‰æœ‰æ•ˆï¼‰ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼Œæ‹·è´æ•°æ®å˜å¾—ååˆ†ç®€å•ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> original </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">city</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Berlin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">country</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Germany</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> copy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> original</span></span></code></pre></div><p>è¿™æ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºæˆ‘ä»¬åªè¿›è¡Œéç ´åæ€§çš„æ›´æ”¹ï¼Œå› æ­¤æ ¹æ®éœ€è¦å¤åˆ¶æ•°æ®ã€‚</p><p id="4"></p><h2 id="_4ï¸âƒ£-ä½¿æ•°æ®ä¸å¯å˜çš„æ–¹å¼é˜»æ­¢çªå˜" tabindex="-1">4ï¸âƒ£ ä½¿æ•°æ®ä¸å¯å˜çš„æ–¹å¼é˜»æ­¢çªå˜ <a class="header-anchor" href="#_4ï¸âƒ£-ä½¿æ•°æ®ä¸å¯å˜çš„æ–¹å¼é˜»æ­¢çªå˜" aria-label="Permalink to &quot;4ï¸âƒ£ ä½¿æ•°æ®ä¸å¯å˜çš„æ–¹å¼é˜»æ­¢çªå˜&quot;">â€‹</a></h2><p><strong>ğŸ“šæˆ‘ä»¬å¯ä»¥å°†å…±äº«æ•°æ®å˜ä¸ºä¸å¯å˜ï¼Œä»¥é˜»æ­¢å…¶çªå˜ã€‚</strong></p><p>JSä¸­å¦‚ä½•ä½¿æ•°æ®ä¸å¯å˜ï¼Œå¯å‚è€ƒä¸‹é¢2ç« ï¼š</p><ul><li><a href="./../4/Protecting-objects-from-changed.html">11.Protecting objects from being changed</a></li><li><a href="./../5/Immutable-wrappers-for-collections.html">16.Immutable wrappers for collections</a></li></ul><p id="4.1"></p><h3 id="_4-1-ä¸å¯å˜æ€§å¦‚ä½•å¸®åŠ©å…±äº«å¯å˜çŠ¶æ€çš„" tabindex="-1">4.1 ä¸å¯å˜æ€§å¦‚ä½•å¸®åŠ©å…±äº«å¯å˜çŠ¶æ€çš„ï¼Ÿ <a class="header-anchor" href="#_4-1-ä¸å¯å˜æ€§å¦‚ä½•å¸®åŠ©å…±äº«å¯å˜çŠ¶æ€çš„" aria-label="Permalink to &quot;4.1 ä¸å¯å˜æ€§å¦‚ä½•å¸®åŠ©å…±äº«å¯å˜çŠ¶æ€çš„ï¼Ÿ&quot;">â€‹</a></h3><p>å¦‚æœæ•°æ®ä¸å¯å˜ï¼Œå®ƒå¯ä»¥æ— ä»»ä½•é£é™©å…±äº«ğŸ˜ã€‚ç‰¹åˆ«æ˜¯ï¼Œæ²¡æœ‰å¿…è¦å†è¿›è¡Œé˜²å¾¡æ€§çš„æ‹·è´äº†ã€‚</p><p>ğŸ’¡ <em>éç ´åæ€§æ›´æ–°æ—¶å¯¹ä¸å¯å˜æ•°æ®çš„ä¸€ä¸ªé‡è¦è¡¥å……</em>ï¼š</p><p>å¦‚æœæˆ‘ä»¬å°†2è€…ç»“åˆèµ·æ¥ï¼Œä¸å¯å˜æ•°æ®å°†å’Œå¯å˜æ•°æ®ä¸€æ ·å˜å¾—ååˆ†æœ‰ç”¨ï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰ç›¸å…³çš„é£é™©ã€‚ğŸ¤©</p><p id="5"></p><h2 id="_5ï¸âƒ£-é¿å…å…±äº«å¯å˜çŠ¶æ€çš„åº“" tabindex="-1">5ï¸âƒ£ é¿å…å…±äº«å¯å˜çŠ¶æ€çš„åº“ <a class="header-anchor" href="#_5ï¸âƒ£-é¿å…å…±äº«å¯å˜çŠ¶æ€çš„åº“" aria-label="Permalink to &quot;5ï¸âƒ£ é¿å…å…±äº«å¯å˜çŠ¶æ€çš„åº“&quot;">â€‹</a></h2><p>JSä¸­æœ‰å‡ ä¸ªæ”¯æŒä¸å¯å˜æ•°æ®+éç ´åæ€§æ›´æ–°çš„åº“ã€‚æœ€æµè¡Œçš„2ä¸ªæ˜¯ï¼š</p><ol><li><a href="https://github.com/immutable-js/immutable-js" target="_blank" rel="noreferrer">Immutable.js</a> å¯¹lists, stacks, sets, mapsç­‰æä¾›ä¸å¯å˜æ•°æ®ç»“æ„</li><li><a href="https://immerjs.github.io/immer/" target="_blank" rel="noreferrer">Immer.js</a> ä¹Ÿæ”¯æŒä¸å¯å˜æ•°æ®+éç ´åæ€§æ›´æ–°ï¼Œ<em>ä½†åªé’ˆå¯¹æ™®é€šçš„å¯¹è±¡ï¼Œæ•°ç»„ï¼ŒSetsï¼ŒMaps</em>ã€‚å³ä¸éœ€è¦æ–°çš„æ•°æ®ç»“æ„</li></ol><p>ä¸‹é¢æ›´è¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹è¿™2ä¸ªåº“ã€‚</p><p id="5.1"></p><h3 id="_5-1-immutable-js" tabindex="-1">5.1 Immutable.js <a class="header-anchor" href="#_5-1-immutable-js" aria-label="Permalink to &quot;5.1 Immutable.js&quot;">â€‹</a></h3><p><a href="https://github.com/immutable-js/immutable-js" target="_blank" rel="noreferrer">Immutable.js</a> ä»“åº“æè¿°å¦‚ä¸‹ï¼š</p><ul><li>JavaScriptçš„ä¸å¯å˜æŒä¹…æ•°æ®é›†åˆæé«˜äº†æ•ˆç‡å’Œç®€å•æ€§ã€‚</li></ul><p>Immutable.jsæä¾›äº†å¦‚ä¸‹ä¸å¯å˜æ•°æ®ç»“æ„ï¼š</p><ul><li>Lists</li><li>Stack</li><li>Set (ä¸åŒäºJSå†…ç½®çš„Set)</li><li>Map (ä¸åŒäºJSå†…ç½®çš„Map)</li><li>ç­‰ç­‰</li></ul><p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ä¸å¯å˜çš„ <code>Map</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Map</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">immutable/dist/immutable.es.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> map0 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Map</span><span style="color:#A6ACCD;">([</span></span>
<span class="line"><span style="color:#A6ACCD;">  [</span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">no</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  [</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">yes</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¿®æ”¹ç‰ˆæœ¬çš„map0</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> map1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> map0</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">maybe</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// ğŸ’¡ ä¿®æ”¹ç‰ˆæœ¬ä¸åŒäºåŸç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ok</span><span style="color:#A6ACCD;">(map1 </span><span style="color:#89DDFF;">!==</span><span style="color:#A6ACCD;"> map0)</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(map1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#A6ACCD;">(map0)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// A</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// æˆ‘ä»¬æ’¤é”€ä¹‹å‰çš„æ”¹å˜</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> map2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> map1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">yes</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// ğŸ’¡ map2æ˜¯ä¸åŒäºmap0çš„æ–°å¯¹è±¡</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// ä½†æ˜¯å®ƒä»¬å†…å®¹ç›¸åŒ</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ok</span><span style="color:#A6ACCD;">(map2 </span><span style="color:#89DDFF;">!==</span><span style="color:#A6ACCD;"> map0)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(map2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#A6ACCD;">(map0)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// (B)</span></span></code></pre></div><p>æ³¨æ„ï¼š</p><ul><li>åƒ<code>.set()</code>è¿™æ ·çš„â€œç ´åæ€§â€æ“ä½œä¸ä¼šä¿®æ”¹æ¥æ”¶æ–¹ï¼Œè€Œæ˜¯è¿”å›ä¿®æ”¹åçš„å‰¯æœ¬</li><li>ä¸ºäº†æ£€æŸ¥ä¸¤ä¸ªæ•°æ®ç»“æ„æ˜¯å¦å…·æœ‰ç›¸åŒçš„å†…å®¹ï¼Œæˆ‘ä»¬ä½¿ç”¨å†…ç½®çš„<code>.equals()</code>æ–¹æ³•(ç¬¬Aè¡Œå’Œç¬¬Bè¡Œ)</li></ul><p id="5.2"></p><h3 id="_5-2-immer" tabindex="-1">5.2 Immer <a class="header-anchor" href="#_5-2-immer" aria-label="Permalink to &quot;5.2 Immer&quot;">â€‹</a></h3><p><a href="https://immerjs.github.io/immer/" target="_blank" rel="noreferrer">Immer</a> ä»“åº“æè¿°å¦‚ä¸‹ï¼š</p><ul><li>é€šè¿‡æ”¹å˜å½“å‰çŠ¶æ€åˆ›å»ºä¸‹ä¸€ä¸ªä¸å¯å˜çŠ¶æ€</li></ul><p>Immerå¸®åŠ©éç ´åæ€§åœ°æ›´æ–°(å¯èƒ½åµŒå¥—)æ™®é€šå¯¹è±¡ã€æ•°ç»„ã€Setså’ŒMapsã€‚å³ä¸æ¶‰åŠåˆ°è‡ªå®šä¹‰æ•°æ®ç»“æ„ã€‚</p><p>ğŸŒ°ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">produce</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">immer/dist/immer.module.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> people </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Jane</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">work</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">employer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Acme</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}}</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> modifiedPeople </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">produce</span><span style="color:#A6ACCD;">(people</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">draft</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">draft</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">work</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">employer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Cyberdyne</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">draft</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">John</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> work</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">employer</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Spectre</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}}</span><span style="color:#F07178;">)</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deepEqual</span><span style="color:#A6ACCD;">(modifiedPeople</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Jane</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">work</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">employer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Cyberdyne</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">John</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">work</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">employer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Spectre</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}},</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deepEqual</span><span style="color:#A6ACCD;">(people</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Jane</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">work</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">employer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Acme</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}},</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span></code></pre></div><p>å­˜å‚¨åœ¨ <code>people.produce()</code> ä¸­çš„åŸæ•°æ®ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå˜é‡ <code>draft</code>ã€‚æˆ‘ä»¬å‡è£…è¿™ä¸ªå˜é‡æ˜¯ <code>people</code>ï¼Œç„¶åä½¿ç”¨æ­£å¸¸çš„ç ´åæ€§æ”¹å˜æ“ä½œã€‚<strong>Immerä¼šæ‹¦æˆªè¿™äº›æ“ä½œ</strong>ã€‚å®ƒä¸ä¼šæ”¹å˜ <code>draft</code>ï¼Œè€Œæ˜¯å¯¹ <code>people</code> è¿›è¡Œéç ´åæ€§çš„æ”¹å˜ã€‚ç»“æœé€šè¿‡ <code>modifiedPeople</code> è¿›è¡Œå¼•ç”¨ã€‚é¢å¤–çš„å¥½å¤„æ˜¯ï¼Œå®ƒæ˜¯æ·±åº¦ä¸å¯å˜çš„ğŸš€ã€‚</p><p><code>assert.deepEqual()</code> èƒ½æ­£å¸¸è¿ä½œï¼Œæ˜¯å› ä¸ºImmerè¿”å›çš„æ˜¯æ™®é€šå¯¹è±¡å’Œæ•°ç»„ğŸ¤©ã€‚</p><p>2022å¹´07æœˆ29æ—¥21:39:12</p>`,93),e=[o];function t(c,r,y,F,D,i){return n(),a("div",null,e)}const d=s(p,[["render",t]]);export{C as __pageData,d as default};
