import{_ as s,c as a,o as n,a as l}from"./app.d0a0f41b.js";const C=JSON.parse('{"title":"Proxyå…ƒç¼–ç¨‹","description":"","frontmatter":{"title":"Proxyå…ƒç¼–ç¨‹"},"headers":[{"level":2,"title":"1ï¸âƒ£ æ¦‚è§ˆï¼ˆOverviewï¼‰","slug":"_1ï¸âƒ£-æ¦‚è§ˆ-overview","link":"#_1ï¸âƒ£-æ¦‚è§ˆ-overview","children":[]},{"level":2,"title":"2ï¸âƒ£ ç¼–ç¨‹ vs å…ƒç¼–ç¨‹","slug":"_2ï¸âƒ£-ç¼–ç¨‹-vs-å…ƒç¼–ç¨‹","link":"#_2ï¸âƒ£-ç¼–ç¨‹-vs-å…ƒç¼–ç¨‹","children":[{"level":3,"title":"2.1 å…ƒç¼–ç¨‹çš„ç§ç±»","slug":"_2-1-å…ƒç¼–ç¨‹çš„ç§ç±»","link":"#_2-1-å…ƒç¼–ç¨‹çš„ç§ç±»","children":[]}]},{"level":2,"title":"3ï¸âƒ£ â­ä»£ç†è§£é‡Š","slug":"_3ï¸âƒ£-â­ä»£ç†è§£é‡Š","link":"#_3ï¸âƒ£-â­ä»£ç†è§£é‡Š","children":[{"level":3,"title":"3.1 ä¸€ä¸ªç¤ºä¾‹","slug":"_3-1-ä¸€ä¸ªç¤ºä¾‹","link":"#_3-1-ä¸€ä¸ªç¤ºä¾‹","children":[]},{"level":3,"title":"3.2 â­ å‡½æ•°ä¸“æœ‰çš„é™·é˜±","slug":"_3-2-â­-å‡½æ•°ä¸“æœ‰çš„é™·é˜±","link":"#_3-2-â­-å‡½æ•°ä¸“æœ‰çš„é™·é˜±","children":[]},{"level":3,"title":"3.3 æ‹¦æˆªæ–¹æ³•è°ƒç”¨","slug":"_3-3-æ‹¦æˆªæ–¹æ³•è°ƒç”¨","link":"#_3-3-æ‹¦æˆªæ–¹æ³•è°ƒç”¨","children":[]},{"level":3,"title":"3.4 â­ å¯æ’¤é”€çš„ä»£ç†","slug":"_3-4-â­-å¯æ’¤é”€çš„ä»£ç†","link":"#_3-4-â­-å¯æ’¤é”€çš„ä»£ç†","children":[]},{"level":3,"title":"3.5 ä»£ç†ä½œä¸ºåŸå‹","slug":"_3-5-ä»£ç†ä½œä¸ºåŸå‹","link":"#_3-5-ä»£ç†ä½œä¸ºåŸå‹","children":[]},{"level":3,"title":"3.6 è½¬å‘æ‹¦æˆªçš„æ“ä½œ","slug":"_3-6-è½¬å‘æ‹¦æˆªçš„æ“ä½œ","link":"#_3-6-è½¬å‘æ‹¦æˆªçš„æ“ä½œ","children":[]},{"level":3,"title":"3.7 â­ ç¼ºé™·ï¼šä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥è¢«ä»£ç†é€æ˜åŒ…è£…","slug":"_3-7-â­-ç¼ºé™·-ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥è¢«ä»£ç†é€æ˜åŒ…è£…","link":"#_3-7-â­-ç¼ºé™·-ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥è¢«ä»£ç†é€æ˜åŒ…è£…","children":[]}]},{"level":2,"title":"4ï¸âƒ£ ä»£ç†ä½¿ç”¨ç¤ºä¾‹","slug":"_4ï¸âƒ£-ä»£ç†ä½¿ç”¨ç¤ºä¾‹","link":"#_4ï¸âƒ£-ä»£ç†ä½¿ç”¨ç¤ºä¾‹","children":[{"level":3,"title":"4.1 ç”¨get & setè¿½è¸ªå±æ€§è®¿é—®","slug":"_4-1-ç”¨get-setè¿½è¸ªå±æ€§è®¿é—®","link":"#_4-1-ç”¨get-setè¿½è¸ªå±æ€§è®¿é—®","children":[]},{"level":3,"title":"4.2 è®¿é—®æœªçŸ¥å±æ€§è¿›è¡Œè­¦å‘Š","slug":"_4-2-è®¿é—®æœªçŸ¥å±æ€§è¿›è¡Œè­¦å‘Š","link":"#_4-2-è®¿é—®æœªçŸ¥å±æ€§è¿›è¡Œè­¦å‘Š","children":[]},{"level":3,"title":"4.3 è´Ÿæ•°ç»„ç´¢å¼•ï¼ˆget trapï¼‰","slug":"_4-3-è´Ÿæ•°ç»„ç´¢å¼•-get-trap","link":"#_4-3-è´Ÿæ•°ç»„ç´¢å¼•-get-trap","children":[]},{"level":3,"title":"4.4 æ•°æ®ç»‘å®šï¼ˆset trapï¼‰","slug":"_4-4-æ•°æ®ç»‘å®š-set-trap","link":"#_4-4-æ•°æ®ç»‘å®š-set-trap","children":[]},{"level":3,"title":"4.5 è®¿é—®restfulç½‘ç»œæœåŠ¡ï¼ˆmethod callsï¼‰","slug":"_4-5-è®¿é—®restfulç½‘ç»œæœåŠ¡-method-calls","link":"#_4-5-è®¿é—®restfulç½‘ç»œæœåŠ¡-method-calls","children":[]},{"level":3,"title":"4.6 â­ å¯æ’¤é”€å¼•ç”¨","slug":"_4-6-â­-å¯æ’¤é”€å¼•ç”¨","link":"#_4-6-â­-å¯æ’¤é”€å¼•ç”¨","children":[]},{"level":3,"title":"4.7 ä½¿ç”¨jså®ç°DOM","slug":"_4-7-ä½¿ç”¨jså®ç°dom","link":"#_4-7-ä½¿ç”¨jså®ç°dom","children":[]},{"level":3,"title":"4.8 æ›´å¤šä½¿ç”¨åœºæ™¯","slug":"_4-8-æ›´å¤šä½¿ç”¨åœºæ™¯","link":"#_4-8-æ›´å¤šä½¿ç”¨åœºæ™¯","children":[]},{"level":3,"title":"4.9 ä½¿ç”¨ä»£ç†çš„åº“","slug":"_4-9-ä½¿ç”¨ä»£ç†çš„åº“","link":"#_4-9-ä½¿ç”¨ä»£ç†çš„åº“","children":[]}]},{"level":2,"title":"5ï¸âƒ£ ğŸ“šProxy APIçš„è®¾è®¡æ€æƒ³","slug":"_5ï¸âƒ£-ğŸ“šproxy-apiçš„è®¾è®¡æ€æƒ³","link":"#_5ï¸âƒ£-ğŸ“šproxy-apiçš„è®¾è®¡æ€æƒ³","children":[{"level":3,"title":"5.1 åˆ†å±‚ï¼šä¿æŒåŸºç¡€çº§åˆ«å’Œå…ƒçº§åˆ«åˆ†ç¦»","slug":"_5-1-åˆ†å±‚-ä¿æŒåŸºç¡€çº§åˆ«å’Œå…ƒçº§åˆ«åˆ†ç¦»","link":"#_5-1-åˆ†å±‚-ä¿æŒåŸºç¡€çº§åˆ«å’Œå…ƒçº§åˆ«åˆ†ç¦»","children":[]},{"level":3,"title":"5.2 è™šæ‹Ÿå¯¹è±¡ vs åŒ…è£…å™¨","slug":"_5-2-è™šæ‹Ÿå¯¹è±¡-vs-åŒ…è£…å™¨","link":"#_5-2-è™šæ‹Ÿå¯¹è±¡-vs-åŒ…è£…å™¨","children":[]},{"level":3,"title":"5.3 é€æ˜è™šæ‹ŸåŒ–å’Œhandlerå°è£…","slug":"_5-3-é€æ˜è™šæ‹ŸåŒ–å’Œhandlerå°è£…","link":"#_5-3-é€æ˜è™šæ‹ŸåŒ–å’Œhandlerå°è£…","children":[]},{"level":3,"title":"5.4 â­ï¸ å…ƒå¯¹è±¡åè®®å’Œä»£ç†traps","slug":"_5-4-â­ï¸-å…ƒå¯¹è±¡åè®®å’Œä»£ç†traps","link":"#_5-4-â­ï¸-å…ƒå¯¹è±¡åè®®å’Œä»£ç†traps","children":[]},{"level":3,"title":"5.5 å¯¹ä»£ç†å¼ºåˆ¶ä¸å˜æ€§","slug":"_5-5-å¯¹ä»£ç†å¼ºåˆ¶ä¸å˜æ€§","link":"#_5-5-å¯¹ä»£ç†å¼ºåˆ¶ä¸å˜æ€§","children":[]}]},{"level":2,"title":"6ï¸âƒ£ Proxyé—®ç­”ï¼šenumerate é™·é˜±å»å“ªé‡Œäº†ï¼Ÿ","slug":"_6ï¸âƒ£-proxyé—®ç­”-enumerate-é™·é˜±å»å“ªé‡Œäº†","link":"#_6ï¸âƒ£-proxyé—®ç­”-enumerate-é™·é˜±å»å“ªé‡Œäº†","children":[]},{"level":2,"title":"7ï¸âƒ£ Proxy API æ‰‹å†Œ","slug":"_7ï¸âƒ£-proxy-api-æ‰‹å†Œ","link":"#_7ï¸âƒ£-proxy-api-æ‰‹å†Œ","children":[{"level":3,"title":"7.1 åˆ›å»ºä»£ç†","slug":"_7-1-åˆ›å»ºä»£ç†","link":"#_7-1-åˆ›å»ºä»£ç†","children":[]},{"level":3,"title":"7.2 Handleræ–¹æ³•","slug":"_7-2-handleræ–¹æ³•","link":"#_7-2-handleræ–¹æ³•","children":[]},{"level":3,"title":"7.3 handleræ–¹æ³•çš„ä¸å˜æ€§","slug":"_7-3-handleræ–¹æ³•çš„ä¸å˜æ€§","link":"#_7-3-handleræ–¹æ³•çš„ä¸å˜æ€§","children":[]},{"level":3,"title":"7.4 å½±å“åŸå‹é“¾çš„æ“ä½œ","slug":"_7-4-å½±å“åŸå‹é“¾çš„æ“ä½œ","link":"#_7-4-å½±å“åŸå‹é“¾çš„æ“ä½œ","children":[]},{"level":3,"title":"7.5 Reflect","slug":"_7-5-reflect","link":"#_7-5-reflect","children":[]}]},{"level":2,"title":"8ï¸âƒ£ æ€»ç»“","slug":"_8ï¸âƒ£-æ€»ç»“","link":"#_8ï¸âƒ£-æ€»ç»“","children":[]}],"relativePath":"7/Metaprogramming-with-Proxies.md","lastUpdated":1677749232000}'),p={name:"7/Metaprogramming-with-Proxies.md"},o=l(`<p>ç›®å½•ï¼š</p><nav class="table-of-contents"><ul><li><a href="#_1ï¸âƒ£-æ¦‚è§ˆ-overview">1ï¸âƒ£ æ¦‚è§ˆï¼ˆOverviewï¼‰</a></li><li><a href="#_2ï¸âƒ£-ç¼–ç¨‹-vs-å…ƒç¼–ç¨‹">2ï¸âƒ£ ç¼–ç¨‹ vs å…ƒç¼–ç¨‹</a><ul><li><a href="#_2-1-å…ƒç¼–ç¨‹çš„ç§ç±»">2.1 å…ƒç¼–ç¨‹çš„ç§ç±»</a></li></ul></li><li><a href="#_3ï¸âƒ£-â­ä»£ç†è§£é‡Š">3ï¸âƒ£ â­ä»£ç†è§£é‡Š</a><ul><li><a href="#_3-1-ä¸€ä¸ªç¤ºä¾‹">3.1 ä¸€ä¸ªç¤ºä¾‹</a></li><li><a href="#_3-2-â­-å‡½æ•°ä¸“æœ‰çš„é™·é˜±">3.2 â­ å‡½æ•°ä¸“æœ‰çš„é™·é˜±</a></li><li><a href="#_3-3-æ‹¦æˆªæ–¹æ³•è°ƒç”¨">3.3 æ‹¦æˆªæ–¹æ³•è°ƒç”¨</a></li><li><a href="#_3-4-â­-å¯æ’¤é”€çš„ä»£ç†">3.4 â­ å¯æ’¤é”€çš„ä»£ç†</a></li><li><a href="#_3-5-ä»£ç†ä½œä¸ºåŸå‹">3.5 ä»£ç†ä½œä¸ºåŸå‹</a></li><li><a href="#_3-6-è½¬å‘æ‹¦æˆªçš„æ“ä½œ">3.6 è½¬å‘æ‹¦æˆªçš„æ“ä½œ</a></li><li><a href="#_3-7-â­-ç¼ºé™·-ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥è¢«ä»£ç†é€æ˜åŒ…è£…">3.7 â­ ç¼ºé™·ï¼šä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥è¢«ä»£ç†é€æ˜åŒ…è£…</a></li></ul></li><li><a href="#_4ï¸âƒ£-ä»£ç†ä½¿ç”¨ç¤ºä¾‹">4ï¸âƒ£ ä»£ç†ä½¿ç”¨ç¤ºä¾‹</a><ul><li><a href="#_4-1-ç”¨get-setè¿½è¸ªå±æ€§è®¿é—®">4.1 ç”¨get &amp; setè¿½è¸ªå±æ€§è®¿é—®</a></li><li><a href="#_4-2-è®¿é—®æœªçŸ¥å±æ€§è¿›è¡Œè­¦å‘Š">4.2 è®¿é—®æœªçŸ¥å±æ€§è¿›è¡Œè­¦å‘Š</a></li><li><a href="#_4-3-è´Ÿæ•°ç»„ç´¢å¼•-get-trap">4.3 è´Ÿæ•°ç»„ç´¢å¼•ï¼ˆget trapï¼‰</a></li><li><a href="#_4-4-æ•°æ®ç»‘å®š-set-trap">4.4 æ•°æ®ç»‘å®šï¼ˆset trapï¼‰</a></li><li><a href="#_4-5-è®¿é—®restfulç½‘ç»œæœåŠ¡-method-calls">4.5 è®¿é—®restfulç½‘ç»œæœåŠ¡ï¼ˆmethod callsï¼‰</a></li><li><a href="#_4-6-â­-å¯æ’¤é”€å¼•ç”¨">4.6 â­ å¯æ’¤é”€å¼•ç”¨</a></li><li><a href="#_4-7-ä½¿ç”¨jså®ç°dom">4.7 ä½¿ç”¨jså®ç°DOM</a></li><li><a href="#_4-8-æ›´å¤šä½¿ç”¨åœºæ™¯">4.8 æ›´å¤šä½¿ç”¨åœºæ™¯</a></li><li><a href="#_4-9-ä½¿ç”¨ä»£ç†çš„åº“">4.9 ä½¿ç”¨ä»£ç†çš„åº“</a></li></ul></li><li><a href="#_5ï¸âƒ£-ğŸ“šproxy-apiçš„è®¾è®¡æ€æƒ³">5ï¸âƒ£ ğŸ“šProxy APIçš„è®¾è®¡æ€æƒ³</a><ul><li><a href="#_5-1-åˆ†å±‚-ä¿æŒåŸºç¡€çº§åˆ«å’Œå…ƒçº§åˆ«åˆ†ç¦»">5.1 åˆ†å±‚ï¼šä¿æŒåŸºç¡€çº§åˆ«å’Œå…ƒçº§åˆ«åˆ†ç¦»</a></li><li><a href="#_5-2-è™šæ‹Ÿå¯¹è±¡-vs-åŒ…è£…å™¨">5.2 è™šæ‹Ÿå¯¹è±¡ vs åŒ…è£…å™¨</a></li><li><a href="#_5-3-é€æ˜è™šæ‹ŸåŒ–å’Œhandlerå°è£…">5.3 é€æ˜è™šæ‹ŸåŒ–å’Œhandlerå°è£…</a></li><li><a href="#_5-4-â­ï¸-å…ƒå¯¹è±¡åè®®å’Œä»£ç†traps">5.4 â­ï¸ å…ƒå¯¹è±¡åè®®å’Œä»£ç†traps</a></li><li><a href="#_5-5-å¯¹ä»£ç†å¼ºåˆ¶ä¸å˜æ€§">5.5 å¯¹ä»£ç†å¼ºåˆ¶ä¸å˜æ€§</a></li></ul></li><li><a href="#_6ï¸âƒ£-proxyé—®ç­”-enumerate-é™·é˜±å»å“ªé‡Œäº†">6ï¸âƒ£ Proxyé—®ç­”ï¼šenumerate é™·é˜±å»å“ªé‡Œäº†ï¼Ÿ</a></li><li><a href="#_7ï¸âƒ£-proxy-api-æ‰‹å†Œ">7ï¸âƒ£ Proxy API æ‰‹å†Œ</a><ul><li><a href="#_7-1-åˆ›å»ºä»£ç†">7.1 åˆ›å»ºä»£ç†</a></li><li><a href="#_7-2-handleræ–¹æ³•">7.2 Handleræ–¹æ³•</a></li><li><a href="#_7-3-handleræ–¹æ³•çš„ä¸å˜æ€§">7.3 handleræ–¹æ³•çš„ä¸å˜æ€§</a></li><li><a href="#_7-4-å½±å“åŸå‹é“¾çš„æ“ä½œ">7.4 å½±å“åŸå‹é“¾çš„æ“ä½œ</a></li><li><a href="#_7-5-reflect">7.5 Reflect</a></li></ul></li><li><a href="#_8ï¸âƒ£-æ€»ç»“">8ï¸âƒ£ æ€»ç»“</a></li></ul></nav><h2 id="_1ï¸âƒ£-æ¦‚è§ˆ-overview" tabindex="-1">1ï¸âƒ£ æ¦‚è§ˆï¼ˆOverviewï¼‰ <a class="header-anchor" href="#_1ï¸âƒ£-æ¦‚è§ˆ-overview" aria-hidden="true">#</a></h2><p>ä»£ç†ä½¿æˆ‘ä»¬å¯ä»¥å¯¹å¯¹è±¡æ“ä½œï¼ˆæ¯”å¦‚è·å–å±æ€§æ—¶ï¼‰è¿›è¡Œæ‹¦æˆªå’Œè‡ªå®šä¹‰æ“ä½œï¼Œè¿™ä¾¿æ˜¯ <em>å…ƒç¼–ç¨‹</em> çš„åŠŸèƒ½ã€‚</p><p>ä¸‹é¢ç¤ºä¾‹ä¸­ï¼š</p><ul><li><code>proxy</code> æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡</li><li><code>handler</code> é€šè¿‡å®ç°ç‰¹å®šçš„æ–¹æ³•èƒ½æ‹¦æˆªå¯¹ <code>proxy</code> æ‰§è¡Œçš„æ“ä½œ</li><li>å¦‚æœ <code>handler</code> æ²¡æœ‰æ‹¦æˆªæŸä¸ªæ“ä½œï¼Œåˆ™ä¼šè½¬å‘åˆ° <code>target</code> ä¸Š</li></ul><p>ä¸‹é¢åªå¯¹ <code>get</code> æ“ä½œï¼ˆè·å–å¯¹è±¡å±æ€§ï¼‰è¿›è¡Œæ‹¦æˆªï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> logged </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> target </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">size</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">logged</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">123</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"></span></code></pre></div><p>å½“æˆ‘ä»¬è®¿é—®å±æ€§ <code>proxy.size</code>, handlerä¼šæ‹¦æˆªè¯¥æ“ä½œï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(proxy</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">123</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deepEqual</span><span style="color:#A6ACCD;">(logged</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET size</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">])</span></span>
<span class="line"></span></code></pre></div><p>ä¸‹é¢çš„ <a href="#7">API å‚è€ƒæŒ‡å—éƒ¨åˆ†</a> åˆ—ä¸¾å‡ºæ‰€æœ‰å¯æ‹¦æˆªçš„æ“ä½œã€‚</p><h2 id="_2ï¸âƒ£-ç¼–ç¨‹-vs-å…ƒç¼–ç¨‹" tabindex="-1">2ï¸âƒ£ ç¼–ç¨‹ vs å…ƒç¼–ç¨‹ <a class="header-anchor" href="#_2ï¸âƒ£-ç¼–ç¨‹-vs-å…ƒç¼–ç¨‹" aria-hidden="true">#</a></h2><p>åœ¨æˆ‘ä»¬æ·±å…¥Proxiesä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ä»€ä¹ˆæ˜¯ <em>å…ƒç¼–ç¨‹</em>ã€‚</p><p>ğŸ‘©ğŸ»â€ğŸ« åœ¨ç¼–ç¨‹ä¸­ï¼Œå­˜åœ¨çº§åˆ«ï¼š</p><ul><li><strong>åŸºç¡€çº§åˆ«</strong>ï¼ˆbase levelï¼‰ï¼Œä¹Ÿç§°ä¸ºåº”ç”¨çº§åˆ«ï¼Œå³ä»£ç ç”¨äºå¤„ç†ç”¨æˆ·è¾“å…¥</li><li><strong>å…ƒçº§åˆ«</strong>ï¼ˆmeta levelï¼‰,å³å¤„ç†åŸºç¡€çº§åˆ«ä»£ç çš„ä»£ç </li></ul><p>åŸºç¡€å’Œå…ƒçº§åˆ«å¯ä»¥æ˜¯ä¸åŒçš„è¯­è¨€ï¼Œä¸‹é¢çš„å…ƒç¼–ç¨‹ä¸­ï¼Œå…ƒç¼–ç¨‹è¯­è¨€æ˜¯JSï¼ŒåŸºç¡€çº§åˆ«ç¼–ç¨‹è¯­è¨€æ˜¯Java:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> str </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">repeat</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">System.out.println(&quot;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> str </span><span style="color:#89DDFF;">+</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&quot;)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>å…ƒç¼–ç¨‹ä¹Ÿå¯ä»¥é‡‡ç”¨ä¸åŒå½¢å¼ã€‚ä¸Šé¢ä¾‹å­ï¼Œæˆ‘ä»¬å°†Javaä»£ç æ‰“å°åˆ°æ§åˆ¶å°ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨JSè¯­è¨€å½“åšåŸºç¡€è¯­è¨€å’Œå…ƒç¼–ç¨‹è¯­è¨€ã€‚ç»å…¸çš„ä¾‹å­æ˜¯ <a href="https://exploringjs.com/impatient-js/ch_callables.html#eval" target="_blank" rel="noreferrer">eval()å‡½æ•°</a>, <strong>å¯ä»¥è®©æˆ‘ä»¬åŠ¨æ€çš„è®¡ç®—å’Œç¼–è¯‘JS</strong>ã€‚ä¸‹é¢ä¾‹å­æˆ‘ä»¬è®¡ç®— <code>5+2</code> è¡¨è¾¾å¼ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">eval</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">5 + 2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 7</span></span>
<span class="line"></span></code></pre></div><p>JSä¸­çš„æŸäº›æ“ä½œå¯èƒ½çœ‹èµ·æ¥ä¸åƒå…ƒç¼–ç¨‹ï¼Œä½†å®é™…å®ƒä»¬æ˜¯çš„ğŸ˜‚ï¼Œå¦‚æœæˆ‘ä»¬é è¿‘ä¸€ç‚¹çœ‹ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line highlighted"><span style="color:#676E95;font-style:italic;">// åŸºç¡€çº§åˆ«</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> obj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">hello</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// å…ƒçº§åˆ«</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> (</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> key </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">keys</span><span style="color:#A6ACCD;">(obj)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ç¨‹åºä¼šåœ¨å…¶è¿è¡Œæ—¶æ£€æµ‹è‡ªå·±çš„ç»“æ„ã€‚è¿™çœ‹èµ·æ¥ä¸å¤ªåƒå…ƒç¼–ç¨‹ï¼Œå› ä¸ºåœ¨JSä¸­ç¼–ç¨‹ç»“æ„å’Œæ•°æ®ç»“æ„çš„ç•Œé™æ˜¯æ¨¡ç³Šçš„ã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>ğŸ‘©ğŸ»â€ğŸ« <strong>æ‰€æœ‰çš„ <code>Object.*</code> æ–¹æ³•éƒ½å¯ä»¥è®¤ä¸ºæ˜¯å…ƒç¼–ç¨‹åŠŸèƒ½</strong> ğŸ¤©ã€‚</p></div><h3 id="_2-1-å…ƒç¼–ç¨‹çš„ç§ç±»" tabindex="-1">2.1 å…ƒç¼–ç¨‹çš„ç§ç±» <a class="header-anchor" href="#_2-1-å…ƒç¼–ç¨‹çš„ç§ç±»" aria-hidden="true">#</a></h3><p>åå°„æ€§å…ƒç¼–ç¨‹æ„å‘³ç€ç¨‹åºèƒ½å¤Ÿå¤„ç†è‡ªèº«ï¼Œ<a href="https://exploringjs.com/deep-js/ch_proxies.html#further-reading-proxies" target="_blank" rel="noreferrer">Kiczales et al.</a> å°†å…¶åˆ’åˆ†ä¸º3ç§ç±»å‹ çš„å…ƒç¼–ç¨‹ğŸ‘©ğŸ»â€ğŸ«ï¼š</p><ol><li><strong>è‡ªçœï¼ˆ<code>Introspection</code>ï¼‰</strong>: æˆ‘ä»¬å¯¹ç¨‹åºç»“æ„æœ‰åªè¯»æ€§è®¿é—®æƒ</li><li><strong>è‡ªæˆ‘ä¿®æ”¹ï¼ˆ<code>self-modification</code>ï¼‰</strong>ï¼šæˆ‘ä»¬å¯ä»¥æ”¹å˜ç¨‹åºç»“æ„</li><li><strong>ä»£è¸Œï¼ˆ<code>Intercession</code>ï¼‰</strong>ï¼šæˆ‘ä»¬å¯ä»¥é‡æ–°å®šä¹‰è¯­è¨€æ“ä½œçš„è¯­ä¹‰</li></ol><p>æ¥çœ‹çœ‹ä¾‹å­ï¼š</p><p>ğŸŒ° <strong>ç¤ºä¾‹ - è‡ªçœ</strong>ï¼š <code>Object.keys()</code> æ‰§è¡Œè‡ªçœæ“ä½œï¼ˆçœ‹ä¸Šé¢çš„ä¾‹å­ï¼‰</p><p>ğŸŒ° <strong>ç¤ºä¾‹ - è‡ªæˆ‘ä¿®æ”¹</strong>ï¼šä¸‹é¢ <code>moveProperty</code> å‡½æ•°å°†æŸä¸ªå±æ€§ä»sourceç§»åˆ°targetã€‚å‡½æ•°é€šè¿‡ç”¨äºå±æ€§è®¿é—®çš„æ–¹æ‹¬å·æ“ä½œç¬¦ï¼Œ èµ‹å€¼æ“ä½œç¬¦å’Œ <code>delete</code> æ“ä½œç¬¦æ‰§è¡Œè‡ªæˆ‘ä¿®æ”¹ã€‚ï¼ˆåœ¨ç”Ÿäº§æ€§ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½åªä½¿ç”¨ <a href="https://exploringjs.com/deep-js/ch_property-attributes-intro.html#property-descriptors" target="_blank" rel="noreferrer">property descriptors</a> å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼‰ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">moveProperty</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">source</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propertyName</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">propertyName</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">propertyName</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">delete</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">propertyName</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ä½¿ç”¨ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> obj1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">color</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">blue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> obj2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">moveProperty</span><span style="color:#A6ACCD;">(obj1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">color</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> obj2)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deepEqual</span><span style="color:#A6ACCD;">(obj1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deepEqual</span><span style="color:#A6ACCD;">(obj2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">color</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">blue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>ES5æ˜¯ä¸æ”¯æŒä»£è¸Œçš„ï¼Œå› æ­¤ <code>Proxies</code> ä¾¿è¢«åˆ›é€ å‡ºæ¥æ¥å¡«è¡¥è¿™ä¸ªç©ºç¼ºğŸ‰ã€‚</p><h2 id="_3ï¸âƒ£-â­ä»£ç†è§£é‡Š" tabindex="-1">3ï¸âƒ£ â­ä»£ç†è§£é‡Š <a class="header-anchor" href="#_3ï¸âƒ£-â­ä»£ç†è§£é‡Š" aria-hidden="true">#</a></h2><p>ä»£ç†ç»™JSè¯­è¨€å¸¦æ¥äº†ä»£è¸Œã€‚å·¥ä½œåŸç†å¦‚ä¸‹ã€‚æˆ‘ä»¬å¯ä»¥å¯¹å¯¹è±¡ <code>obj</code> æ‰§è¡Œå¾ˆå¤šæ“ä½œï¼Œæ¯”å¦‚ï¼š</p><ul><li>é€šè¿‡ <code>obj.prop</code> è·å– <code>obj</code> ä¸Šçš„å±æ€§ <code>prop</code></li><li>é€šè¿‡ <code>prop in obj</code> æ¥æ£€æµ‹å¯¹è±¡ <code>obj</code> æ˜¯å¦å­˜åœ¨ <code>prop</code> å±æ€§</li></ul><p>ğŸ‘©ğŸ»â€ğŸ« <code>Proxies</code> æ˜¯å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰è¿™äº›æ“ä½œçš„ç‰¹æ®Šå¯¹è±¡ğŸ˜ï¼Œä»£ç†ä½¿ç”¨2ä¸ªå‚æ•°è¿›è¡Œæ„é€ ï¼š</p><ol><li><code>handler</code>ï¼šå¯¹æŸä¸ªæ“ä½œï¼Œå¦‚æœå®šä¹‰äº†handlerï¼Œè¯¥handlerä¸­å¯¹è¯¥æ“ä½œéƒ½æœ‰ä¸€ä¸ªç›¸å¯¹åº”çš„æ–¹æ³•ã€‚<em>å¯¹æ“ä½œæ‹¦æˆªï¼ˆåœ¨åˆ°è¾¾targetè·¯ä¸Šæ‹¦æˆªï¼‰çš„æ–¹æ³•æˆ‘ä»¬ç§°ä¹‹ä¸º <code>trap</code>(é™·é˜±)</em>ï¼Œ <code>trap</code>ï¼ˆé™·é˜±æˆ–æ•è·ï¼‰è¿™ä¸ªä¸“ä¸šåè¯æ¥è‡ªäºæ“ä½œç³»ç»Ÿ</li><li><code>target</code>ï¼šå¦‚æœhandleræ²¡æœ‰æ‹¦æˆªæŸä¸ªæ“ä½œï¼Œåˆ™è¯¥æ“ä½œç›´æ¥ä½œç”¨äºç›®æ ‡å¯¹è±¡ï¼ˆtargetï¼‰ä¸Šã€‚å³ï¼Œtargetå……å½“äº†handlerçš„fallbackã€‚ä»¥æŸç§æ–¹å¼ä»£ç†å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œäº†åŒ…è£…ã€‚</li></ol><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><code>intercession</code> çš„åŠ¨è¯å½¢å¼æ˜¯ <code>to intercede</code>ã€‚ <code>Interceding</code> å†…åœ¨æ˜¯åŒå‘çš„ï¼Œè€Œæ‹¦æˆªï¼ˆ<code>Intercepting</code>ï¼‰æœ¬è´¨ä¸Šæ˜¯å•å‘çš„ã€‚</p></div><h3 id="_3-1-ä¸€ä¸ªç¤ºä¾‹" tabindex="-1">3.1 ä¸€ä¸ªç¤ºä¾‹ <a class="header-anchor" href="#_3-1-ä¸€ä¸ªç¤ºä¾‹" aria-hidden="true">#</a></h3><p>ä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œhandleræ‹¦æˆª <code>get &amp; has</code> æ“ä½œ:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> logged </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> target </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ‹¦æˆªå±æ€§çš„è®¿é—®</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">logged</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">GET </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">propKey</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">123</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ‹¦æˆªï¼Œå±æ€§æ˜¯å¦å­˜åœ¨ xx in obj</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">has</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">logged</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">HAS </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">propKey</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬è®¿é—®å±æ€§ï¼ˆè¡Œ<code>A</code>æ“ä½œï¼‰æˆ–è€…ä½¿ç”¨ <code>in</code> æ“ä½œç¬¦(è¡Œ<code>B</code>æ“ä½œ)ï¼Œhandlerä¼šæ‹¦æˆªè¿™äº›æ“ä½œï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">age</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">123</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// A</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> proxy</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// B</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deepEqual</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  logged</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET age</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">HAS hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>ä¸Šé¢handleræ²¡æœ‰å®ç° <code>set</code> é™·é˜±ï¼ˆtrapï¼‰ï¼ˆå³è®¾ç½®å±æ€§ï¼‰ï¼Œå› æ­¤è®¾ç½® <code>proxy.age</code> ä¼šè½¬å‘åˆ° <code>target</code> ä¸Šï¼Œæœ€ç»ˆ <code>target.age</code> ä¼šè¢«è®¾ç½®ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">age </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">99</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">age</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">99</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="_3-2-â­-å‡½æ•°ä¸“æœ‰çš„é™·é˜±" tabindex="-1">3.2 â­ å‡½æ•°ä¸“æœ‰çš„é™·é˜± <a class="header-anchor" href="#_3-2-â­-å‡½æ•°ä¸“æœ‰çš„é™·é˜±" aria-hidden="true">#</a></h3><p>å¦‚æœtargetæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™æœ‰2ä¸ªé¢å¤–çš„æ“ä½œå¯ä»¥è¢«æ‹¦æˆªğŸ˜ï¼š</p><ol><li><code>apply</code>: è°ƒç”¨å‡½æ•°ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è§¦å‘ï¼š <ul><li><code>proxy(...)</code></li><li><code>proxy.call(...)</code></li><li><code>proxy.apply(...)</code></li></ul></li><li><code>construct</code>ï¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è§¦å‘è¿™ä¸ªé™·é˜±ï¼š <ul><li><code>new proxy(...)</code></li></ul></li></ol><p>è¿™2ä¸ªtrapsåªé’ˆå¯¹å‡½æ•°targetsçš„åŸå› å¾ˆç®€å•ï¼šå¦åˆ™æˆ‘ä»¬ä¸èƒ½è½¬å‘ <code>apply</code> &amp; <code>construct</code> æ“ä½œã€‚</p><h3 id="_3-3-æ‹¦æˆªæ–¹æ³•è°ƒç”¨" tabindex="-1">3.3 æ‹¦æˆªæ–¹æ³•è°ƒç”¨ <a class="header-anchor" href="#_3-3-æ‹¦æˆªæ–¹æ³•è°ƒç”¨" aria-hidden="true">#</a></h3><p>æˆ‘ä»¬å¸Œæœ›é€šè¿‡Proxyæ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œæˆ‘ä»¬å°†é¢ä¸´ä¸€ä¸ªæŒ‘æˆ˜ ğŸ˜­:</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>ä¸å­˜åœ¨é’ˆå¯¹æ–¹æ³•è°ƒç”¨çš„trapã€‚åä¹‹ï¼Œä¸€ä¸ªæ–¹æ³•è°ƒç”¨å¯ä»¥è¢«è§†ä½œä¸º2ä¸ªè¿ç»­çš„æ“ä½œï¼š</p></div><ol><li><code>get</code> æ“ä½œè·å–å‡½æ•°</li><li><code>apply</code> æ“ä½œè°ƒç”¨è·å–çš„å‡½æ•°</li></ol><p>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œæˆ‘ä»¬å¿…é¡»æ‹¦æˆª2ä¸ªæ“ä½œï¼š</p><ol><li>æ‹¦æˆª <code>get</code> æ“ä½œï¼Œå¹¶è¿”å›ä¸€ä¸ªå‡½æ•°</li><li>æ‹¦æˆªè¯¥å‡½æ•°çš„è°ƒç”¨</li></ol><p>ğŸŒ°ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> traced </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">traceMehodCalls</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">obj</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handler</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// åŸæ–¹æ³•</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">origMethod</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(...</span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// åŒ…å«éšå¼çš„ this å‚æ•°</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">origMethod</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">traced</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> -&gt; </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">JSON.stringify(result)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handler</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>æˆ‘ä»¬æ²¡æœ‰å¯¹ç¬¬2æ¬¡æ‹¦æˆªä½¿ç”¨Proxyï¼Œåªæ˜¯ç®€å•å°†åŸå§‹æ–¹æ³•åŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ã€‚</p><p>è°ƒç”¨ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> obj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">multiply</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">y</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">x</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">y</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">squared</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">multiply</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">x</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> trackedObj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">traceMehodCalls</span><span style="color:#A6ACCD;">(obj)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(trackedObj</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">squared</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">9</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">81</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deepEqual</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  traced</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">multiply[9,9] -&gt; 81</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">squared[9] -&gt; 81</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>å³ä½¿ <code>this.multiply</code> æ˜¯åœ¨ <code>obj.squared()</code> æ–¹æ³•å†…ä¹Ÿè¢«è¿½è¸ªäº†ã€‚è¿™æ˜¯å› ä¸º <code>this</code> ä¿æŒå¯¹è¯¥proxyçš„å¼•ç”¨ã€‚</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>è¿™ä¸æ˜¯æœ€é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç¼“å­˜å‡½æ•°ã€‚å¦å¤–ï¼Œ<strong>ä»£ç†æœ¬èº«å°±å¯¹æ€§èƒ½æœ‰ä¸€å®šçš„å½±å“ğŸ˜®â€ğŸ’¨</strong>ã€‚</p></div><h3 id="_3-4-â­-å¯æ’¤é”€çš„ä»£ç†" tabindex="-1">3.4 â­ å¯æ’¤é”€çš„ä»£ç† <a class="header-anchor" href="#_3-4-â­-å¯æ’¤é”€çš„ä»£ç†" aria-hidden="true">#</a></h3><p><strong>ä»£ç†æ˜¯å¯ä»¥è¢«æ’¤é”€çš„ï¼ˆå…³é—­ä»£ç†ï¼‰ğŸ¤©</strong>ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> proxy</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> revoke </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Proxy</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">revocable</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"></span></code></pre></div><p>åœ¨æˆ‘ä»¬é¦–æ¬¡è°ƒç”¨ <code>revoke()</code> æ–¹æ³•åï¼Œä»»ä½•ä½œç”¨äºè¯¥ <code>proxy</code> çš„æ“ä½œéƒ½ä¼šæŠ›å‡º <code>TypeError</code> ã€‚åç»­å†è°ƒç”¨ <code>revoke</code> æ²¡æœ‰ä»»ä½•æ•ˆæœã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line highlighted"><span style="color:#676E95;font-style:italic;">// proxyè¡¨ç°å¾—å°±åƒæ˜¯ target å¯¹è±¡</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">city </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Pairs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">city</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Pairs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line highlighted"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åŠé”€</span></span>
<span class="line"><span style="color:#82AAFF;">revoke</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// æŠ›å‡ºTypeError</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// ä¸èƒ½å¯¹å·²åŠé”€çš„proxyæ‰§è¡Œ â€™getâ€™ æ“ä½œ</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">throws</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prop</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">TypeError: Cannot perform &#39;get&#39; on a proxy that has been revoked</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// typeofä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼ˆè¯‘è€…æ³¨ï¼‰</span></span>
<span class="line"><span style="color:#89DDFF;">typeof</span><span style="color:#A6ACCD;"> proxy</span></span>
<span class="line"></span></code></pre></div><h3 id="_3-5-ä»£ç†ä½œä¸ºåŸå‹" tabindex="-1">3.5 ä»£ç†ä½œä¸ºåŸå‹ <a class="header-anchor" href="#_3-5-ä»£ç†ä½œä¸ºåŸå‹" aria-hidden="true">#</a></h3><p>ä¸€ä¸ªä»£ç†çš„ <code>proto</code> å¯ä»¥ä½œä¸ºä¸€ä¸ªå¯¹è±¡ <code>obj</code> çš„åŸå‹ã€‚<strong>èµ·å§‹äº <code>obj</code> çš„æŸä¸ªæ“ä½œå¯èƒ½åœ¨ <code>proto</code> ä¸­ç»§ç»­</strong>ã€‚æ¯”å¦‚ <code>get</code> å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ“ä½œï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proto </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// objç»§æ‰¿è‡ªproto, è€Œprotoæ˜¯ä¸€ä¸ªproxyï¼Œ </span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// å…¶handlerå¯¹ get æ“ä½œè¿›è¡Œæ•è·</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> obj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#A6ACCD;">(proto)</span></span>
<span class="line"><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">weight</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ‰“å°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// â€˜GET weightâ€™</span></span>
<span class="line"></span></code></pre></div><p>ğŸ’¡ åœ¨å¯¹è±¡ <code>obj</code> ä¸­æ‰¾ä¸åˆ° <code>weight</code> å±æ€§ï¼Œå› æ­¤æœç´¢ä¼šå»¶ç»­åˆ° <code>proto</code> ä¸­ï¼Œå› æ­¤ <code>get</code> é™·é˜±è¢«è§¦å‘ã€‚æœ‰æ›´å¤šçš„æ“ä½œä¼šå½±å“åŸå‹é“¾ï¼Œä¼šåœ¨æœ€ååˆ—ä¸¾å‡ºæ¥è¿™äº›æ“ä½œã€‚</p><h3 id="_3-6-è½¬å‘æ‹¦æˆªçš„æ“ä½œ" tabindex="-1">3.6 è½¬å‘æ‹¦æˆªçš„æ“ä½œ <a class="header-anchor" href="#_3-6-è½¬å‘æ‹¦æˆªçš„æ“ä½œ" aria-hidden="true">#</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>ğŸ‘©ğŸ»â€ğŸ« <strong>é‚£äº›åœ¨handlerä¸­æ²¡æœ‰å®ç°çš„trapsä¼šè‡ªåŠ¨è½¬å‘åˆ° <code>target</code> ä¸Š</strong>ã€‚</p></div><p>æœ‰æ—¶åœ¨è½¬å‘æŸä¸ªæ“ä½œçš„åŒæ—¶ï¼Œæˆ‘ä»¬æƒ³æ‰§è¡Œç›¸å…³æŸäº›ä»»åŠ¡ã€‚æ¯”å¦‚ï¼Œæ‹¦æˆªå’Œè®°å½•æ‰€æœ‰çš„æ“ä½œï¼Œè€Œä¸é˜»æ­¢å®ƒä»¬åˆ°è¾¾ç›®æ ‡å¯¹è±¡ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">deleteProperty</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DELETE </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">delete</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">has</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">HAS </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å…¶å®ƒtrapsç±»ä¼¼</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>ä½¿ç”¨ Reflect.* æå‡å†™æ³•</p></blockquote><p>å¯¹æ¯ä¸ªtrapï¼Œå¯¹äºæ¯ä¸€ä¸ªæ“ä½œï¼Œæˆ‘ä»¬éƒ½è®°å½•å®ƒï¼Œç„¶åæ‰‹åŠ¨è½¬å‘å®ƒã€‚<strong>JSä¸­å­˜åœ¨ç±»ä¼¼æ¨¡å—ä¸€æ ·çš„å¯¹è±¡ <code>Reflect</code> èƒ½å¸®åŠ©æˆ‘ä»¬è½¬å‘ ğŸ‰</strong></p><p>å¯¹äºæ¯ä¸ªtrapï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">handler</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">trap</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> arg_1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">...,</span><span style="color:#A6ACCD;"> arg_n)</span></span>
<span class="line"></span></code></pre></div><p>Reflectéƒ½æœ‰å¯¹åº”çš„æ–¹æ³•ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">trap</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> arg_1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">...,</span><span style="color:#A6ACCD;"> arg_n)</span></span>
<span class="line"></span></code></pre></div><p>å¦‚æœä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬ä½¿ç”¨ <code>Reflect</code>ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">deleteProperty</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DELETE </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deleteProperty</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">has</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">HAS </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">has</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å…¶å®ƒtrapsç±»ä¼¼</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>â­ handlerä½¿ç”¨proxyæå‡å†™æ³•</p></blockquote><p>æ—¢ç„¶æ¯ä¸ªtrapsæ‰€åšçš„éƒ½ç±»ä¼¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªä»£ç†å®ç°ä¸Šé¢çš„handler:ğŸ˜</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">trapName</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// è¿”å›handlerçš„æ–¹æ³•å trapName</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(...</span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">trapName</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toUpperCase</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">])</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è½¬å‘æ“ä½œ</span></span>
<span class="line highlighted"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">trapName</span><span style="color:#F07178;">](</span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>å¯¹äºæ¯ä¸ªtrapï¼Œä»£ç†ä¼šé€šè¿‡ <code>get</code> æ“ä½œè¯¢é—®handleræ–¹æ³•ï¼Œç„¶åæˆ‘ä»¬ç»™å®ƒä¸€ä¸ªtrapã€‚ <em>å³ï¼Œæ‰€æœ‰çš„handleræ–¹æ³•éƒ½å¯ä»¥é€šè¿‡å•ä¸€çš„å…ƒæ–¹æ³• <code>get</code> å®ç°ğŸ˜</em>ã€‚è¿™ä¹Ÿæ˜¯ä»£ç†APIçš„ä¸€ä¸ªç›®æ ‡ï¼Œä½¿è¿™ç§è™šæ‹ŸåŒ–å˜å¾—ç®€å•ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨è¿™ç§åŸºäºä»£ç†çš„handlerï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> target </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line highlighted"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">distance </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">450</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// set trap</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">distance</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">450</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// get trap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// set æ“ä½œæ­£ç¡®è½¬å‘åˆ°targetäº†å—ï¼Ÿ</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">distance</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">450</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¾“å‡º</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;SET distance&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;GETOWNPROPERTYDESCRIPTOR distance&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;DEFINEPROPERTY distance&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;GET distance&#39;</span></span>
<span class="line"></span></code></pre></div><h3 id="_3-7-â­-ç¼ºé™·-ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥è¢«ä»£ç†é€æ˜åŒ…è£…" tabindex="-1">3.7 â­ ç¼ºé™·ï¼šä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥è¢«ä»£ç†é€æ˜åŒ…è£… <a class="header-anchor" href="#_3-7-â­-ç¼ºé™·-ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥è¢«ä»£ç†é€æ˜åŒ…è£…" aria-hidden="true">#</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>ğŸ‘©ğŸ»â€ğŸ« ä¸€ä¸ªä»£ç†å¯¹è±¡å¯ä»¥è¢«è§†ä½œå¯¹targetå¯¹è±¡çš„æ‹¦æˆªæ“ä½œ - ä»£ç†åŒ…è£…targetã€‚ä»£ç†çš„handlerå°±å¥½åƒæ˜¯è¯¥ä»£ç†çš„è§‚å¯Ÿè€…æˆ–è€…ç›‘å¬è€…ã€‚</p></div><ul><li>å®ƒé€šè¿‡å®ç°ç›¸åº”çš„æ–¹æ³•ï¼ˆæ¯”å¦‚ <code>get</code> ç”¨äºè¯»å–æŸä¸ªå±æ€§ç­‰ ï¼‰è§„å®šå“ªäº›æ“ä½œå¯ä»¥è¢«æ‹¦æˆªã€‚</li><li>å¦‚æœhandleræ–¹æ³•ä¸­ç¼ºå°‘å¯¹æŸä¸ªæ“ä½œçš„æ•è·ï¼Œå®ƒä¼šç®€å•çš„å°†å…¶è½¬å‘ç»™target</li></ul><blockquote><p>a.åŒ…è£…çš„å¯¹è±¡å¯¹ this æŒ‡å‘çš„å½±å“</p></blockquote><p>åœ¨æ·±å…¥å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•å›é¡¾ä¸€ä¸‹åŒ…è£…targetæ˜¯å¦‚ä½•å½±å“ <code>this</code> çš„ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> target </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">myMethod</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">      thisIsTarget</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#F07178;">      thisIsProxy</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handler  </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬è°ƒç”¨ <code>target.myMethod()</code>, <code>this</code> æŒ‡å‘ <code>target</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">myMethod</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// {thisIsTarget: true, thisIsProxy: false}</span></span>
<span class="line"></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬é€šè¿‡ä»£ç†è°ƒç”¨ï¼Œåˆ™ <code>this</code> æŒ‡å‘ <code>proxy</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">proxy</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">myMethod</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// {thisIsTarget: false, thisIsProxy: true}</span></span>
<span class="line"></span></code></pre></div><p>ğŸ’¡å³ï¼Œå¦‚æœä»£ç†å°†æ–¹æ³•è°ƒç”¨è½¬å‘ç»™targetï¼Œ<code>this</code> æ˜¯ä¸å‘ç”Ÿå˜åŒ–çš„ã€‚ä½œä¸ºåæœï¼Œå¦‚æœtargetä½¿ç”¨thisï¼Œæ¯”å¦‚è°ƒç”¨æ–¹æ³•ï¼Œä»£ç†ä»ç„¶ä¼šåœ¨å¾ªç¯ä¸­ã€‚ğŸ¤”</p><blockquote><p>b.ä¸èƒ½è¢«é€æ˜åŒ…è£…çš„å¯¹è±¡</p></blockquote><div class="info custom-block"><p class="custom-block-title">INFO</p><p>ğŸ“šé€šå¸¸ï¼Œä½¿ç”¨ç©ºhandlerçš„ä»£ç†ä¼šé€æ˜çš„åŒ…è£…targetï¼š<em>å³æˆ‘ä»¬ä¸ä¼šå¯Ÿè§‰åˆ°ä»£ç†çš„å­˜åœ¨ï¼Œä»£ç†ä¹Ÿä¸ä¼šæ”¹å˜targetçš„è¡Œä¸ºğŸ‰</em>ã€‚</p></div><p>ç„¶è€Œï¼Œå¦‚æœtargeté€šè¿‡ä¸å—ä»£ç†æ§åˆ¶çš„æœºåˆ¶å°†ä¿¡æ¯ä¸ <code>this</code> ç›¸å…³è”ï¼Œæˆ‘ä»¬å°†ä¼šç¢°åˆ°é—®é¢˜ğŸ˜­ï¼šäº‹æƒ…ä¸ä¼šæŒ‰æˆ‘ä»¬æƒ³è±¡çš„é‚£æ ·æ­£å¸¸è¿ä½œï¼Œå› ä¸ºä¸åŒçš„ä¿¡æ¯å…³è”å–å†³äºtargetæ˜¯å¦è¢«åŒ…è£…ã€‚</p><p>æ¯”å¦‚ã€‚ä¸‹é¢ <code>Person</code> ç±»ä½¿ç”¨WeakMap <code>_name</code> å­˜å‚¨ç§æœ‰ä¿¡æ¯ï¼ˆ<a href="https://exploringjs.com/impatient-js/ch_weakmaps.html#private-data-in-weakmaps" target="_blank" rel="noreferrer">WeakMap private data</a>ï¼‰:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> _name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WeakMap</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Person</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">_name</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_name</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>Personå®ä¾‹ä¸èƒ½è¢«é€æ˜çš„åŒ…è£…ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> jane </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Person</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Jane</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// thisæŒ‡å‘jane</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(jane</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Jane</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(jane</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// thisæŒ‡å‘proxy</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p><code>jane.name</code> çš„ç»“æœä¸åŒäºåŒ…è£…çš„ <code>proxy.name</code>ï¼Œä¸‹é¢å®ç°åˆ™ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Person2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">name</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_name</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> jane </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Person2</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Jane</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// thisæŒ‡å‘jane</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(jane</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Jane</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(jane</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// thisæŒ‡å‘proxy</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Jane</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><blockquote><p>c.åŒ…è£…å†…ç½®æ„é€ å™¨å®ä¾‹</p></blockquote><p>ğŸ’¡<em>å¤§å¤šæ•°å†…ç½®æ„é€ å™¨å®ä¾‹ä¹Ÿä½¿ç”¨äº†ä¸è¢«ä»£ç†æ‹¦æˆªçš„æœºåˆ¶ã€‚</em> å› æ­¤ä¹Ÿä¸èƒ½è¢«é€æ˜åŒ…è£…ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Date</code> å®ä¾‹ä½œä¸ºä¾‹å­ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line highlighted"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> target </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">throws</span><span style="color:#A6ACCD;">(</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> proxy</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getFullYear</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">TypeError: this is not a Date object</span><span style="color:#A6ACCD;">\\.</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>ğŸ‘©ğŸ»â€ğŸ« <strong>ä¸å—proxyå½±å“çš„æœºåˆ¶ç§°ä¹‹ä¸ºå†…éƒ¨æ§½ï¼ˆ<code>internal slots</code>ï¼‰</strong>ã€‚è¿™äº›æ§½å’Œå…³è”çš„å®ä¾‹ä»¥å±æ€§ä¸€æ ·çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ã€‚è§„èŒƒä¸­å®šä¹‰ï¼Œå¤„ç†è¿™äº›æ§½å°±å¥½åƒæ˜¯é€šè¿‡å¸¦æ–¹æ‹¬å·åå­—çš„å±æ€§ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ–¹æ³•æ˜¯å†…éƒ¨çš„ï¼Œå¯ä»¥è¢«æ‰€æœ‰å¯¹è±¡ <code>o</code> è°ƒç”¨ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">O</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">[[GetPrototypeOf]]()</span></span>
<span class="line"></span></code></pre></div><p>ğŸ’¡ç›¸æ¯”äºå±æ€§ï¼Œè®¿é—®å†…éƒ¨æ§½ä¸æ˜¯é€šè¿‡æ™®é€šçš„ <code>get | set</code> æ“ä½œå®Œæˆçš„ã€‚</p><p>å¦‚æœ <code>.getFullYear()</code> é€šè¿‡ä»£ç†è°ƒç”¨ï¼Œå®ƒæ‰¾ä¸åˆ°å†…éƒ¨æ§½éœ€è¦çš„<code>this</code>ï¼Œå› æ­¤æŠ›å‡ºTypeErrorã€‚</p><p>å¯¹äºDateæ–¹æ³•ï¼š<a href="https://tc39.es/ecma262/#sec-properties-of-the-date-prototype-object" target="_blank" rel="noreferrer">TC39è¯­è¨€è§„èŒƒå¼ºè°ƒ</a>ï¼šé™¤éæ˜ç¡®å®šä¹‰ï¼Œå¦åˆ™ä¸‹é¢å®šä¹‰çš„ Date åŸå‹å¯¹è±¡çš„æ–¹æ³•ä¸æ˜¯é€šç”¨çš„ï¼Œå¹¶ä¸”ä¼ é€’ç»™å®ƒä»¬çš„ <code>this</code> å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå…·æœ‰å·²åˆå§‹åŒ–ä¸ºæ—¶é—´å€¼çš„ <code>[[DateValue]]</code> å†…éƒ¨æ§½çš„å¯¹è±¡ã€‚</p><blockquote><p>d.å˜é€šæ–¹æ¡ˆ</p></blockquote><p>ä½œä¸ºå˜é€šæ–¹æ¡ˆï¼Œæˆ‘ä»¬æ”¹å˜handlerå¦‚ä½•è½¬å‘æ–¹æ³•è°ƒç”¨å’Œé€‰æ‹©æ€§å°† <code>this</code> è®¾ç½®ä¸ºtargetï¼Œè€Œä¸æ˜¯ä»£ç†ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">getFullYear</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// é€‰æ‹©æ€§ç»‘å®šåˆ° target</span></span>
<span class="line highlighted"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getFullYear</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">bind</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-7-1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">proxy</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getFullYear</span><span style="color:#A6ACCD;">() </span><span style="color:#676E95;font-style:italic;">// 2022</span></span>
<span class="line"></span></code></pre></div><p>è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹å°±æ˜¯ï¼Œè¯¥æ–¹æ³•å¯¹thisæ‰§è¡Œçš„æ“ä½œéƒ½ä¸ä¼šé€šè¿‡ä»£ç†ã€‚</p><blockquote><p>e.æ•°ç»„å¯ä»¥è¢«é€æ˜åŒ…è£…</p></blockquote><p>ä¸åŒäºå…¶å®ƒå†…ç½®ç±»ï¼Œæ•°ç»„æ˜¯å¯ä»¥è¢«é€æ˜åŒ…è£…çš„ğŸ˜</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Array</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length </span><span style="color:#676E95;font-style:italic;">// 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length </span><span style="color:#676E95;font-style:italic;">// 0</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>ğŸ“šæ•°ç»„èƒ½è¢«é€æ˜åŒ…è£…çš„åŸå› æ˜¯ï¼Œå› ä¸ºæ•°ç»„æ–¹æ³•æ˜¯é€šç”¨çš„ï¼Œä¸”ä¸ä¾èµ–å†…éƒ¨æ§½ï¼ˆ<code>internal slots</code>ï¼‰</p></div><h2 id="_4ï¸âƒ£-ä»£ç†ä½¿ç”¨ç¤ºä¾‹" tabindex="-1">4ï¸âƒ£ ä»£ç†ä½¿ç”¨ç¤ºä¾‹ <a class="header-anchor" href="#_4ï¸âƒ£-ä»£ç†ä½¿ç”¨ç¤ºä¾‹" aria-hidden="true">#</a></h2><p>ä¸‹é¢å±•ç¤ºProxiesèƒ½åšäº›ä»€ä¹ˆã€‚é€šè¿‡è¿™äº›å¯ä»¥å¯¹ä»£ç†çš„APIè¿›è¡Œå®æˆ˜ã€‚</p><h3 id="_4-1-ç”¨get-setè¿½è¸ªå±æ€§è®¿é—®" tabindex="-1">4.1 ç”¨get &amp; setè¿½è¸ªå±æ€§è®¿é—® <a class="header-anchor" href="#_4-1-ç”¨get-setè¿½è¸ªå±æ€§è®¿é—®" aria-hidden="true">#</a></h3><p>å‡è®¾å­˜åœ¨ä¸€ä¸ª <code>tracePropertyAccesses(obj, propKeys)</code> çš„æ–¹æ³•ç”¨äºè®°å½•å¯¹è±¡ <code>obj</code> ä¸Šçš„å±æ€§ä»€ä¹ˆæ—¶å€™è¢«è®¿é—®æˆ–è€…è®¾ç½®ã€‚</p><p>ğŸŒ°ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Point</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">y</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">x</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">x</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">y</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">y</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">toString</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Point(</span><span style="color:#89DDFF;">\${</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">, </span><span style="color:#89DDFF;">\${</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">)</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¿½è¸ªå±æ€§ x | y çš„è®¿é—®</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> point </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Point</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> tracedPoint </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">tracePropertyAccesses</span><span style="color:#A6ACCD;">(point</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">x</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">y</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">])</span></span>
<span class="line"></span></code></pre></div><p>è·å–æˆ–è®¾ç½®è¢«è¿½è¸ªçš„å¯¹è±¡pçš„å±æ€§æœ‰å¦‚ä¸‹æ•ˆæœï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(tracedPoint</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">tracedPoint</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">21</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ‰“å°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;GET x&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;SET x=21&#39;</span></span>
<span class="line"></span></code></pre></div><p>æœ‰è¶£çš„æ˜¯ï¼Œå½“Pointè®¿é—®å±æ€§æ—¶ï¼Œè¿½è¸ªä»ç”Ÿæ•ˆï¼Œå› ä¸º <code>this</code> ç°åœ¨æŒ‡çš„æ˜¯è¢«è¿½è¸ªçš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯Pointçš„å®ä¾‹ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(tracedPoint</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Point(21, 7)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ‰“å°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;GET x&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;GET y&#39;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>ä¸ä½¿ç”¨ä»£ç†å®ç° tracePropertyAccesses()</p></blockquote><p>ä¸ä½¿ç”¨ä»£ç†çš„è¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>getter &amp; setter</code> ä»£æ›¿å„ä¸ªå±æ€§ç”¨äºè¿½è¸ªã€‚setters &amp; getters ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„å¯¹è±¡ <code>propData</code> å­˜å‚¨å±æ€§çš„æ•°æ®ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬ç ´åæ€§çš„æ”¹å˜äº†åŸæœ‰å®ç°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æ­£åœ¨è¿›è¡Œå…ƒç¼–ç¨‹ï¼šğŸ¤”</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">tracePropertyAccesses</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">obj</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKeys</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">log</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ç”¨propDataå­˜å‚¨å±æ€§æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line highlighted"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨ä¸€ä¸ªgetterå’Œä¸€ä¸ªsetteræ›¿ä»£æ¯ä¸ªå±æ€§</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">propKeys</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">propData</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">defineProperty</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propData</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">set</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">SET </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">propData</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">obj</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å‚æ•° <code>log</code> ä¾¿äºå•å…ƒæµ‹è¯•ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> obj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> logged </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"><span style="color:#82AAFF;">tracePropertyAccesses</span><span style="color:#A6ACCD;">(obj</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> logged</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#A6ACCD;">(x))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">c </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">c</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deepEqual</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  logged</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">SET a=1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><blockquote><p>ğŸ’¡ä½¿ç”¨ä»£ç†å®ç°</p></blockquote><p>ä»£ç†å®ç°æ›´ç®€å•ï¼Œæˆ‘ä»¬æ‹¦æˆªget &amp; setï¼Œè€Œä¸æ”¹å˜å®ç°ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">tracePropertyAccesses</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">obj</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKeys</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">log</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKeySet</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Set</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">propKeys</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">propKeySet</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">has</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    set</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">propKeySet</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">has</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">SET </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-2-è®¿é—®æœªçŸ¥å±æ€§è¿›è¡Œè­¦å‘Š" tabindex="-1">4.2 è®¿é—®æœªçŸ¥å±æ€§è¿›è¡Œè­¦å‘Š <a class="header-anchor" href="#_4-2-è®¿é—®æœªçŸ¥å±æ€§è¿›è¡Œè­¦å‘Š" aria-hidden="true">#</a></h3><p>å¦‚æœæˆ‘ä»¬è®¿é—®å¯¹è±¡æŸä¸ªä¸å­˜åœ¨çš„å±æ€§æ—¶ï¼Œjsä¼šè¿”å› <code>undefined</code>, è€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»£ç†æŠ›å‡ºå¼‚å¸¸ã€‚<strong>æˆ‘ä»¬å¯ä»¥è®©ä»£ç†æˆä¸ºå¯¹è±¡çš„åŸå‹ï¼Œå¦‚æœå±æ€§ä¸åœ¨å¯¹è±¡ä¸Šï¼Œåˆ™ä¼šè§¦å‘ä»£ç†ä¸Šçš„ <code>get</code> é™·é˜±</strong>ï¼š</p><ul><li>åœ¨ä»£ç†ä¹‹åï¼Œå¦‚æœåœ¨åŸå‹é“¾ä¸Šä¹Ÿæ‰¾ä¸åˆ°è¯¥å±æ€§ï¼Œè¯´æ˜è¯¥å±æ€§ç¡®å®ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠ›å‡ºå¼‚å¸¸</li><li>å¦åˆ™è¿”å›ç»§æ‰¿çš„å±æ€§å€¼ï¼Œé€šè¿‡è½¬å‘ <code>get</code> æ“ä½œåˆ°targetä¸Šå®ç°ï¼ˆä»£ç†ä»targetä¸Šè·å–å…¶åŸå‹ï¼‰</li></ul><p>æŸä¸ªå®ç°ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> propertyCheckerHandler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// åªæ£€æµ‹å­—ç¬¦ä¸²å±æ€§key</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">ReferenceError</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Unknown property: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PropertyChecker </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{},</span><span style="color:#A6ACCD;"> propertyCheckerHandler)</span></span>
<span class="line"></span></code></pre></div><p>ğŸ’¡å°† <code>PropertyChecker</code> ä½œä¸ºä¸€ä¸ªå¯¹è±¡ä½¿ç”¨ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> jane </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">__proto__</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> PropertyChecker</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Jane</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">jane</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name </span><span style="color:#676E95;font-style:italic;">// âœ… ok</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">jane</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">age </span><span style="color:#676E95;font-style:italic;">// âŒ ReferenceError: Unknown property: nmae</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç»§æ‰¿çš„å±æ€§</span></span>
<span class="line"><span style="color:#A6ACCD;">jane</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">() </span><span style="color:#676E95;font-style:italic;">// &#39;[object Object]&#39;</span></span>
<span class="line"></span></code></pre></div><p>å¦‚æœå°† <code>PropertyChecker</code> å˜ä¸ºä¸€ä¸ªæ„é€ å™¨ï¼Œåˆ™å¯ä»¥å¯¹ç±»ä½¿ç”¨ <code>extends</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line highlighted"><span style="color:#676E95;font-style:italic;">// æˆ‘ä»¬ä¸èƒ½æ”¹å˜classesçš„ .prototype å› æ­¤è¿™é‡Œä½¿ç”¨ä¸€ä¸ªfunction</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PropertyChecker2</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#FFCB6B;">PropertyChecker2</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{},</span><span style="color:#A6ACCD;"> propertyCheckerHandler)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Point</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PropertyChecker2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">y</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">super</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">x</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">x</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">y</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">y</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> point </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Point</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">point</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x </span><span style="color:#676E95;font-style:italic;">// âœ… 5 </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">point</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z </span><span style="color:#676E95;font-style:italic;">// âŒ ReferenceError: Unknown property: z</span></span>
<span class="line"></span></code></pre></div><p>ğŸ“šä¸‹é¢æ˜¯ <code>point</code> çš„åŸå‹é“¾ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// è·å–åŸå‹çš„æ–¹æ³•</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Object</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getPrototypeOf</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">bind</span><span style="color:#A6ACCD;">(Object)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// point çš„åŸå‹é“¾æ˜¯ Point.prototype ä¸€ç‚¹é—®é¢˜ä¹Ÿæ²¡æœ‰</span></span>
<span class="line"><span style="color:#82AAFF;">p</span><span style="color:#A6ACCD;">(point) </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Point</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å³Point.prototypeçš„åŸå‹æ˜¯PropertyChecker2.prototype</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å› ä¸ºPoint ç»§æ‰¿è‡ª PropertyChecker2 å› æ­¤å…³ç³»æˆç«‹</span></span>
<span class="line"><span style="color:#82AAFF;">p</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">p</span><span style="color:#A6ACCD;">(point)) </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PropertyChecker2</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æœ€å PropertyChecker2 ä»£ç†æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å®ƒçš„åŸå‹æ˜¯ Object.prototype ä¹Ÿæ²¡å•¥é—®é¢˜</span></span>
<span class="line"><span style="color:#82AAFF;">p</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">p</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">p</span><span style="color:#A6ACCD;">(point))) </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span></span>
<span class="line"></span></code></pre></div><blockquote><p>é˜»æ­¢å±æ€§çš„æ„å¤–åˆ›å»º</p></blockquote><p>å¦‚æœæˆ‘ä»¬æ‹…å¿ƒå±æ€§çš„æ„å¤–åˆ›å»ºï¼Œåˆ™æœ‰2ç§æ–¹å¼ï¼š</p><ol><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»£ç†çš„ <code>set</code> é™·é˜±åŒ…è£…å¯¹è±¡</li><li>æˆ‘ä»¬å¯ä»¥ç”¨ <code>Object.preventExtensions(obj)</code> ä½¿å¯¹è±¡å˜å¾—ä¸å¯æ‰©å±•ï¼Œå³JSä¸å…è®¸å¯¹objæ·»åŠ æ–°çš„å±æ€§</li></ol><h3 id="_4-3-è´Ÿæ•°ç»„ç´¢å¼•-get-trap" tabindex="-1">4.3 è´Ÿæ•°ç»„ç´¢å¼•ï¼ˆget trapï¼‰ <a class="header-anchor" href="#_4-3-è´Ÿæ•°ç»„ç´¢å¼•-get-trap" aria-hidden="true">#</a></h3><p>æ•°ç»„çš„æŸäº›æ–¹æ³•è¿è¡Œä½¿ç”¨ <code>-1</code> è·å–æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ <code>-2</code> è·å–æœ€å2ä¸ªå…ƒç´ ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">slice</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// [3]</span></span>
<span class="line"></span></code></pre></div><p>ä½†æ˜¯ä¸èƒ½ä½¿ç”¨è´Ÿç´¢å¼•è·å–æ•°ç»„å…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»£ç†æ·»åŠ è¿™ä¸ªèƒ½åŠ›ã€‚ä»£ç†æ‹¦æˆªç”± <code>[]</code> è§¦å‘çš„ <code>get</code> æ“ä½œï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createArray</span><span style="color:#89DDFF;">(...</span><span style="color:#A6ACCD;font-style:italic;">elements</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handler</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    get </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Number</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">String</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨ä»£ç†åŒ…è£…æ•°ç»„</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">elements</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handler</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> arr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createArray</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">c</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">arr[</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">] </span><span style="color:#676E95;font-style:italic;">// &#39;c&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">arr[</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">] </span><span style="color:#676E95;font-style:italic;">// &#39;a&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length </span><span style="color:#676E95;font-style:italic;">// 3</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-4-æ•°æ®ç»‘å®š-set-trap" tabindex="-1">4.4 æ•°æ®ç»‘å®šï¼ˆset trapï¼‰ <a class="header-anchor" href="#_4-4-æ•°æ®ç»‘å®š-set-trap" aria-hidden="true">#</a></h3><p>æ•°æ®ç»‘å®šæ˜¯å…³äºåœ¨å¯¹è±¡é—´åŒæ­¥æ•°æ®ã€‚ä¸€ç§æµè¡Œçš„åœºæ™¯æ˜¯ï¼ŒåŸºäºMVCæ¨¡å¼çš„widgetsï¼šé€šè¿‡æ•°æ®ç»‘å®šï¼Œå¯ä»¥ä½¿è§†å›¾ï¼ˆ<code>view</code> å³è¯¥widgetï¼‰åœ¨æ¨¡å‹ï¼ˆ<code>model</code>ï¼Œå³å¯¹è¯¥widgetçš„æ•°æ®è™šæ‹ŸåŒ–ï¼‰å‘ç”Ÿå˜åŒ–ååŒæ­¥æ›´æ–°ã€‚</p><p>ä¸ºäº†å®ç°æ•°æ®ç»‘å®šï¼Œæˆ‘ä»¬éœ€è¦è§‚å¯Ÿå’Œå“åº”å¯¹è±¡çš„å˜åŒ–ã€‚ä¸‹é¢ä»£ç ç‰‡æ®µæ˜¯å¦‚æœè§‚å¯Ÿæ•°ç»„å˜åŒ–çš„è‰ç¨¿ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createObservedArray</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">callback</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">array</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">array</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    set</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">propertyKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">callback</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">propertyKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propertyKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> observedArray </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createObservedArray</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">\`\${</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(key)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> = </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(value)</span><span style="color:#89DDFF;">}\`</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">observedArray</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ‰“å°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &quot;0 = &quot;a&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &quot;length&quot; = 1</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-5-è®¿é—®restfulç½‘ç»œæœåŠ¡-method-calls" tabindex="-1">4.5 è®¿é—®restfulç½‘ç»œæœåŠ¡ï¼ˆmethod callsï¼‰ <a class="header-anchor" href="#_4-5-è®¿é—®restfulç½‘ç»œæœåŠ¡-method-calls" aria-hidden="true">#</a></h3><p>ä»£ç†å¯ç”¨äºåˆ›å»ºå¯ä»¥è°ƒç”¨ä»»æ„æ–¹æ³•çš„å¯¹è±¡ã€‚ä¸‹é¢ä¾‹å­ä¸­ï¼Œ <code>createWebService()</code> å°†ä¼šåˆ›å»ºä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡ <code>service</code>ã€‚è°ƒç”¨serviceä¸Šçš„æ–¹æ³•å°†è·å–åˆ°åŒåçš„ç½‘ç»œæœåŠ¡èµ„æºå†…å®¹ã€‚è·å–æ˜¯é€šè¿‡Promiseå®Œæˆçš„ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> service </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createWebService</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://example.com/data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å½“å‰ http://example.com/data/employees jsonæ•°æ®</span></span>
<span class="line"><span style="color:#A6ACCD;">service</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">employees</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">jsonStr</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">employees</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">jsonStr</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>ä¸‹é¢ä¸ä½¿ç”¨ä»£ç†å¿«é€Ÿç²—ç³™çš„å®ç°è¯¥æ–¹æ³•ã€‚æˆ‘ä»¬éœ€è¦æå‰çŸ¥é“serviceä¸Šè°ƒç”¨çš„æ–¹æ³•ã€‚å‚æ•° <code>propKeys</code> å°†æä¾›è¿™äº›ä¿¡æ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…å«æ–¹æ³•åçš„æ•°ç»„ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createWebService</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">baseUrl</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKeys</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">service</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKeys</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">service</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">httpGet</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">baseUrl</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">service</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ğŸ’¡ä½¿ç”¨ä»£ç†çš„æ–¹å¼åˆ™æ›´ä¸ºç®€æ´ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createWebService</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">baseUrl</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{},</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">httpGet</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">baseUrl</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>httpGet</code> è¯·æ±‚ï¼Œ å…³äº <a href="https://exploringjs.com/impatient-js/ch_promises.html#promisifying-xmlhttprequest" target="_blank" rel="noreferrer">promise - impatient-js</a>ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">httpGet</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">xhr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">XMLHttpRequest</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onload</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">responseText</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// A</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// å‘ç”Ÿé”™è¯¯ æ¯”å¦‚404</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusText</span><span style="color:#F07178;">)) </span><span style="color:#676E95;font-style:italic;">// B</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onerror</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç½‘ç»œé”™è¯¯</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#676E95;font-style:italic;">// C</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-6-â­-å¯æ’¤é”€å¼•ç”¨" tabindex="-1">4.6 â­ å¯æ’¤é”€å¼•ç”¨ <a class="header-anchor" href="#_4-6-â­-å¯æ’¤é”€å¼•ç”¨" aria-hidden="true">#</a></h3><p>å¯æ’¤é”€å¼•ç”¨æ•ˆæœå¦‚ä¸‹ï¼š<em>å®¢æˆ·ç«¯ä¸å…è®¸ç›´æ¥è®¿é—®é‡è¦çš„èµ„æºï¼ˆæ¯”å¦‚æŸä¸ªå¯¹è±¡ï¼‰ï¼Œåªèƒ½é€šè¿‡å¼•ç”¨ï¼ˆé—´æ¥å¯¹è±¡ï¼Œå³èµ„æºåŒ…è£…å™¨ï¼‰è®¿é—®</em>ã€‚</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰é’ˆå¯¹å¼•ç”¨çš„æ“ä½œéƒ½è½¬å‘åˆ°èµ„æºä¸Šã€‚åœ¨å®¢æˆ·ç«¯æ“ä½œå®Œæˆåï¼Œ<strong>é€šè¿‡åŠé”€è¯¥å¼•ç”¨çš„æ–¹å¼ï¼Œä»è€Œè¾¾åˆ°ä¿æŠ¤èµ„æºçš„ç›®çš„</strong>ã€‚ä¹‹åï¼Œå†å¯¹å¼•ç”¨è¿›è¡Œæ“ä½œï¼Œç›´æ¥æŠ›å‡ºé”™è¯¯ï¼Œä¸å†å°†æ“ä½œè½¬å‘åˆ°èµ„æºä¸ŠğŸ‘©ğŸ»â€ğŸ«ã€‚</p></div><p>ä¸‹é¢ä¾‹å­ï¼Œæˆ‘ä»¬å¯¹èµ„æºåˆ›å»ºä¸€ä¸ªå¯æ’¤é”€çš„å¼•ç”¨ã€‚ç„¶åé€šè¿‡è¯¥å¼•ç”¨è¯»å–èµ„æºä¸Šçš„æŸä¸ªå±æ€§ã€‚è¿™ä¸€åˆ‡okï¼Œå› ä¸ºæ­¤æ—¶å¼•ç”¨ç¡®ä¿æ“ä½œè½¬å‘åˆ°èµ„æºä¸Šï¼Œç„¶åæˆ‘ä»¬åŠé”€è¯¥å¼•ç”¨ï¼Œä¹‹åè¯¥å¼•ç”¨ä¾¿ä¸å†å…è®¸æˆ‘ä»¬ç»§ç»­ä½¿ç”¨äº†ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> resouce </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">11</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> reference</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> revoke </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRevocableReference</span><span style="color:#A6ACCD;">(resource)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// å…è®¸è®¿é—®</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(reference</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">11</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// åŠé”€å¼•ç”¨</span></span>
<span class="line"><span style="color:#82AAFF;">revoke</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">throws</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> reference</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">TypeError: Cannot perform &#39;get&#39; on a proxy that has been revoked</span><span style="color:#89DDFF;">/</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><strong>ä»£ç†å°±å¾ˆé€‚åˆå®ç°å¯æ’¤é”€å¼•ç”¨ï¼Œå› ä¸ºå®ƒä»¬èƒ½æ‹¦æˆªå’Œè½¬å‘æ“ä½œğŸ˜</strong>ã€‚</p></div><p>ä¸‹é¢æ˜¯åŸºäºProxyçš„å®ç°ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRevocableReference</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">enabled</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    reference</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">enabled</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">TypeError</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Cannot perform &#39;get&#39; on a proxy that has been revoked</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      has</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">enabled</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">TypeError</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Cannot perform &#39;get&#39; on a proxy that has been revoked</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">has</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">revoke</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">enabled</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ä¸Šé¢çš„ä»£ç å¯ä»¥é€šè¿‡ <code>Proxy-as-handler</code>(å°†ä»£ç†å½“åšhandler ğŸ¤©)çš„æŠ€æœ¯è¿›è¡Œç®€åŒ–ã€‚è¿™é‡Œï¼ŒhandleråŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ª <code>Reflect</code> å¯¹è±¡ã€‚å› æ­¤ <code>get</code> é™·é˜±æ­£å¸¸è¿”å›åˆé€‚çš„Reflectæ–¹æ³•ã€‚å¦‚æœå¼•ç”¨å·²ç»è¢«åŠé”€ï¼Œåˆ™æŠ›å‡º <code>TypeError</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRevocableReference</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">enabled</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// Proxy-as-Handler ğŸ˜</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// proxyæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handler</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{},</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">_handlerTarget</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">trapName</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">receiver</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">enabled</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">TypeError</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Cannot perform &#39;</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">trapName</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&#39; on a proxy</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;"> that has been revoked</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Reflect</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">trapName</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    reference</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handler</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">rovoke</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">enabled</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ğŸ‰ç„¶è€Œï¼Œæˆ‘ä»¬æ— éœ€è‡ªå·±å®ç°è¿™æ ·çš„æ–¹æ³•ï¼Œå› ä¸ºProxyæœ¬èº«å°±æ˜¯å¯æ’¤é”€çš„ã€‚ç°åœ¨ï¼ŒåŠé”€å‘ç”Ÿåœ¨ä»£ç†å†…éƒ¨ï¼Œè€Œä¸æ˜¯handlerã€‚handleræ‰€è¦åšçš„å°±æ˜¯å°†æ“ä½œè½¬å‘ç»™ç›®æ ‡å¯¹è±¡ï¼Œå³handlerä¸å®ç°ä»»ä½•trapsæ–¹æ³•ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRevocableReference</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handler</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// è½¬å‘æ‰€æœ‰æ“ä½œ</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">revoke</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Proxy</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">revocable</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handler</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> reference</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">revoke</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>å±éšœï¼ˆMembrancesï¼‰</p></blockquote><p>å±éšœå»ºç«‹åœ¨å¯æ’¤é”€å¼•ç”¨çš„æ€æƒ³ä¹‹ä¸Šï¼šç”¨äºå®‰å…¨è¿è¡Œä¸å—ä¿¡ä»»ä»£ç çš„åº“ä¼šåœ¨è¯¥ä»£ç å‘¨å›´åŒ…è£¹ä¸€å±‚å±éšœä»¥éš”ç¦»å®ƒå¹¶ä¿æŒç³»ç»Ÿå…¶ä½™éƒ¨åˆ†çš„å®‰å…¨ã€‚å¯¹è±¡ä»2ä¸ªæ–¹å‘é€šè¿‡å±éšœï¼š</p><ul><li>ä¸å—ä¿¡ä»»çš„ä»£ç å¯èƒ½ä»å¤–ç•Œæ¥æ”¶å¯¹è±¡ï¼ˆå¹²å¯¹è±¡ï¼‰</li><li>å±éšœä¼ é€’å¯¹è±¡ï¼ˆæ¹¿å¯¹è±¡ï¼‰ç»™å¤–ç•Œ</li></ul><p>è¿™2ç§æƒ…å½¢ï¼Œå¯æ’¤é”€å¼•ç”¨åŒ…è£¹åœ¨è¿™äº›å¯¹è±¡å‘¨å›´ã€‚é€šè¿‡åŒ…è£…å‡½æ•°æˆ–æ–¹æ³•è¿”å›çš„å¯¹è±¡åŒæ ·ä¹Ÿè¢«åŒ…è£…ã€‚å¦å¤–ï¼Œå¦‚æœä¸€ä¸ªåŒ…è£…çš„æ¹¿å¯¹è±¡ä¼ å›å±éšœå†…ï¼Œåˆ™è¯¥å¯¹è±¡è§£é™¤åŒ…è£…ã€‚</p><p>ä¸€æ—¦å®Œæˆä¸å—ä¿¡ä»»çš„ä»£ç ï¼Œæ‰€æœ‰å¯æ’¤é”€çš„å¼•ç”¨éƒ½å°†è¢«æ’¤é”€ã€‚ç»“æœï¼Œå®ƒåœ¨å¤–éƒ¨çš„ä»»ä½•ä»£ç éƒ½æ— æ³•å†æ‰§è¡Œï¼Œå¹¶ä¸”å®ƒå¼•ç”¨çš„å¤–éƒ¨å¯¹è±¡ä¹Ÿåœæ­¢å·¥ä½œã€‚Caja ç¼–è¯‘å™¨æ˜¯â€œä½¿ç¬¬ä¸‰æ–¹ HTMLã€CSS å’Œ JavaScript å®‰å…¨åµŒå…¥æ‚¨çš„ç½‘ç«™çš„å·¥å…·â€ã€‚å®ƒä½¿ç”¨è†œæ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚</p><h3 id="_4-7-ä½¿ç”¨jså®ç°dom" tabindex="-1">4.7 ä½¿ç”¨jså®ç°DOM <a class="header-anchor" href="#_4-7-ä½¿ç”¨jså®ç°dom" aria-hidden="true">#</a></h3><p>æµè§ˆå™¨çš„DOMé€šå¸¸æ˜¯é€šè¿‡JSå’ŒC++ä¸€èµ·å®ç°çš„ã€‚çº¯ç²¹ä½¿ç”¨JSå®ç°å¯ç”¨äºï¼š</p><ul><li>æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼Œæ¯”å¦‚ï¼Œåœ¨Node.jsä¸­æ“ä½œDOMï¼Œ<a href="https://github.com/tmpvar/jsdom" target="_blank" rel="noreferrer">jsdom</a> åº“ä¾¿æ˜¯åšè¿™ä¸ªçš„</li><li>ä½¿DOMæ›´å¿«ï¼ˆjså’ŒC++ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šèŠ±è´¹æ—¶é—´ï¼‰</li></ul><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>ä½†æ˜¯ï¼Œæ ‡å‡†DOMåŠŸèƒ½ä¸å¤ªå®¹æ˜“é€šè¿‡çº¯JSå®ç°ã€‚æ¯”å¦‚ï¼Œå¤§å¤šæ•°DOMé›†åˆæ˜¯å®æ—¶é¢„è§ˆçš„ï¼Œå½“å‰DOMçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ŒDOMé›†åˆä¹Ÿä¼šåŠ¨æ€å˜åŒ–ã€‚çº¯JSå®ç°è¿™ä¸ªåŠŸèƒ½æ˜¯å¾ˆä½æ€§èƒ½çš„ã€‚è€Œä½¿ç”¨ä»£ç†è¿™å¯æå‡æ€§èƒ½ã€‚</p></div><h3 id="_4-8-æ›´å¤šä½¿ç”¨åœºæ™¯" tabindex="-1">4.8 æ›´å¤šä½¿ç”¨åœºæ™¯ <a class="header-anchor" href="#_4-8-æ›´å¤šä½¿ç”¨åœºæ™¯" aria-hidden="true">#</a></h3><p>ä»£ç†è¿˜å¯ç”¨äºï¼š</p><ul><li>è¿œç¨‹ï¼šæœ¬åœ°å ä½å¯¹è±¡è½¬å‘æ–¹æ³•è°ƒç”¨ç»™è¿œç¨‹å¯¹è±¡ï¼Œè¿™å’Œä¸Šé¢æåˆ°çš„web serviceç¤ºä¾‹å¾ˆåƒ</li><li>æ•°æ®åº“æ•°æ®è®¿é—®å¯¹è±¡ï¼šå¯¹å¯¹è±¡çš„è¯»å†™æ“ä½œå¯¹æ•°æ®åº“çš„è¯»å†™æ“ä½œã€‚è¿™å’Œä¸Šé¢æåˆ°çš„web serviceç¤ºä¾‹å¾ˆåƒ</li><li>è®°å½•ï¼ˆProfilingï¼‰ï¼šæ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œè¿½è¸ªæ–¹æ³•è€—æ—¶ã€‚ç±»ä¼¼ä¸Šé¢çš„è¿½è¸ªç¤ºä¾‹</li></ul><h3 id="_4-9-ä½¿ç”¨ä»£ç†çš„åº“" tabindex="-1">4.9 ä½¿ç”¨ä»£ç†çš„åº“ <a class="header-anchor" href="#_4-9-ä½¿ç”¨ä»£ç†çš„åº“" aria-hidden="true">#</a></h3><ul><li><a href="https://github.com/immerjs/immer" target="_blank" rel="noreferrer">Immerï¼ˆby Michel Weststrateï¼‰</a> å¸®åŠ©éç ´åæ€§æ›´æ–°æ•°æ®ã€‚åº”è¯¥åº”ç”¨çš„æ›´æ”¹å¯ä»¥é€šè¿‡è°ƒç”¨æ–¹æ³•ã€è®¾ç½®å±æ€§ã€è®¾ç½®Arrayå…ƒç´ ç­‰æ¥æŒ‡å®šã€‚é€šè¿‡ä¸€ä¸ª <strong>é¢„é€‰å¯¹è±¡ï¼ˆ<code>draft state</code>ï¼‰</strong>ï¼Œè€Œé¢„é€‰å¯¹è±¡æ˜¯é€šè¿‡ä»£ç†å®ç°</li><li><a href="https://mobx.js.org/" target="_blank" rel="noreferrer">MobX</a> å…è®¸ä½ è§‚å¯Ÿæ•°æ®ç»“æ„ï¼ˆæ¯”å¦‚å¯¹è±¡ï¼Œæ•°ç»„ï¼Œç±»å®ç°ï¼‰çš„å˜åŒ–ã€‚å®ƒæ˜¯é€šè¿‡ä»£ç†å®ç°çš„</li><li><a href="https://github.com/alpinejs/alpine" target="_blank" rel="noreferrer">Alphine.js</a> ä¸€ä¸ªé€šè¿‡ä»£ç†å®ç°æ•°æ®ç»‘å®šçš„å‰ç«¯åº“</li><li><a href="https://github.com/sindresorhus/on-change" target="_blank" rel="noreferrer">on-change</a> é€šè¿‡ä»£ç†è§‚å¯Ÿå¯¹è±¡çš„å˜åŒ–ï¼Œå¹¶è¿›è¡Œä¸ŠæŠ¥</li><li><a href="https://github.com/humanwhocodes/env" target="_blank" rel="noreferrer">Env utility - Nicholas C.Zakas</a> å…è®¸é€šè¿‡å±æ€§è®¿é—®ç¯å¢ƒå˜é‡å€¼ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚é€šè¿‡ä»£ç†å®ç°</li><li><a href="https://github.com/LDflex/LDflex" target="_blank" rel="noreferrer">LDFlex</a> æä¾›é“¾æ¥æ•°æ®æŸ¥è¯¢è¯­è¨€ã€‚æµå¼æŸ¥è¯¢APIæ˜¯é€šè¿‡ä»£ç†å®ç°</li></ul><h2 id="_5ï¸âƒ£-ğŸ“šproxy-apiçš„è®¾è®¡æ€æƒ³" tabindex="-1">5ï¸âƒ£ ğŸ“šProxy APIçš„è®¾è®¡æ€æƒ³ <a class="header-anchor" href="#_5ï¸âƒ£-ğŸ“šproxy-apiçš„è®¾è®¡æ€æƒ³" aria-hidden="true">#</a></h2><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†æ·±å…¥ä»£ç†å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠä¸ºä»€ä¹ˆé‚£æ ·å·¥ä½œ</p><h3 id="_5-1-åˆ†å±‚-ä¿æŒåŸºç¡€çº§åˆ«å’Œå…ƒçº§åˆ«åˆ†ç¦»" tabindex="-1">5.1 åˆ†å±‚ï¼šä¿æŒåŸºç¡€çº§åˆ«å’Œå…ƒçº§åˆ«åˆ†ç¦» <a class="header-anchor" href="#_5-1-åˆ†å±‚-ä¿æŒåŸºç¡€çº§åˆ«å’Œå…ƒçº§åˆ«åˆ†ç¦»" aria-hidden="true">#</a></h3><p>ç«ç‹æ›¾ç»ä¼˜å…ˆçš„æ”¯æŒè¿‡ä¸€ç§æœ‰è¶£çš„å…ƒç¼–ç¨‹ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡ <code>o</code> æœ‰ä¸€ä¸ªå« <code>__noSuchMethod__</code> çš„æ–¹æ³•ï¼Œå½“åœ¨ <code>o</code> å¯¹è±¡ä¸Šè°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ï¼Œä¼šå‘å‡ºé€šçŸ¥ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> calc </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">__noSuchMethod__</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">methodName</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">swtich</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">methodName</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">plus</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">:</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">reduce</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">times</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">:</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">reduce</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#F07178;">:</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">TypeError</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ä¸æ”¯æŒï¼š </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">methodName</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä¸‹é¢æ‰€æœ‰æ–¹æ³•è°ƒç”¨é€šè¿‡ .__noSuchMethod__()å®ç°</span></span>
<span class="line"><span style="color:#A6ACCD;">calc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">plus</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// 10</span></span>
<span class="line"><span style="color:#A6ACCD;">calc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">times</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// 24</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">calc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">plus</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Parts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> of </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// parts of a string</span></span>
<span class="line"></span></code></pre></div><p>å› æ­¤ï¼Œ<code>__noSuchMethod__</code> å·¥ä½œæ•ˆæœå’Œä»£ç†trapä¸€æ ·ã€‚å¯¹æ¯”ä»£ç†ï¼Œtrapæ˜¯æˆ‘ä»¬æƒ³è¦æ‹¦æˆªå…¶æ“ä½œçš„å¯¹è±¡çš„ä¸€ä¸ªè‡ªå·±æˆ–ç»§æ‰¿çš„æ–¹æ³•ã€‚<em>ç«ç‹çš„è¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼ŒåŸºç¡€çº§åˆ«ï¼ˆæ­£å¸¸æ–¹æ³•ï¼‰å’Œå…ƒçº§åˆ«ï¼ˆ<strong>noSuchMethod</strong>ï¼‰æ··åœ¨ä¸€èµ·äº†</em>ã€‚åŸºç¡€çº§åˆ«ä»£ç å¯èƒ½ä¸å°å¿ƒè°ƒç”¨æˆ–çœ‹åˆ°äº†å…ƒçº§åˆ«ä»£ç ï¼Œå¹¶æœ‰å¯èƒ½ä¸å°å¿ƒå®šä¹‰äº†ä¸€ä¸ªç›¸åŒåå­—çš„å…ƒçº§åˆ«çš„æ–¹æ³•ã€‚</p><p>ğŸ“š å³ä½¿åœ¨æ ‡å‡†çš„ECMAScriptä¸­ï¼Œ<strong>åŸºç¡€çº§åˆ«å’Œå…ƒçº§åˆ«æœ‰æ—¶å€™ä¹Ÿæ··åœ¨ä¸€èµ·äº†</strong>ã€‚æ¯”å¦‚ï¼Œä¸‹é¢å…ƒç¼–ç¨‹æœºåˆ¶å¯èƒ½å¤±è´¥ï¼Œå› ä¸ºå®ƒä»¬å­˜åœ¨äºåŸºç¡€çº§åˆ«ä¸­ï¼š</p><ul><li><p><code>obj.hasOwnProperty(propKey)</code>: å¦‚æœå±æ€§åœ¨åŸå‹é“¾ä¸­è¦†ç›–äº†å†…éƒ¨å®ç°ï¼Œè¿™ä¸ªæ–¹æ³•è°ƒç”¨å¯èƒ½å¤±æ•ˆã€‚æ¯”å¦‚ï¼Œ</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> obj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">hasOwnProperty</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// TypeError: obj.hasOwnProperty is not a function</span></span>
<span class="line"><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">hasOwnProperty</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">width</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>ğŸ’¡ä¸‹é¢æ˜¯å®‰å…¨è°ƒç”¨ <code>hasOwnProperty()</code> çš„æ–¹å¼ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// false</span></span>
<span class="line"><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hasOwnProperty</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#A6ACCD;">(obj</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">width</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç®€å†™ false</span></span>
<span class="line"><span style="color:#89DDFF;">{}.</span><span style="color:#A6ACCD;">hasOwnProperty</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#A6ACCD;">(obj</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">width</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div></li><li><p><code>func.call(...) &amp; func.apply(...)</code>: è¿™2ä¸ªæ–¹æ³•ï¼Œä¹Ÿå­˜åœ¨å’Œ <code>hasOwnProperty</code> ä¸€æ ·çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•ä¹Ÿä¸€æ ·</p></li><li><p><code>obj.__proto__</code>: åœ¨æ™®é€šå¯¹è±¡ä¸­ï¼Œ<code>__proto__</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼Œå®ƒå…è®¸æˆ‘ä»¬è·å–å’Œè®¾ç½®æ¥æ”¶è€…çš„åŸå‹ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æŠŠæ™®é€šå¯¹è±¡å½“åšå­—å…¸ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»é¿å…å°† <a href="https://exploringjs.com/impatient-js/ch_single-objects.html#the-pitfalls-of-using-an-object-as-a-dictionary" target="_blank" rel="noreferrer"><strong>proto</strong> ä½œä¸ºå±æ€§é”®</a></p></li></ul><p>ğŸ‰ğŸ‰ç°åœ¨ï¼Œåº”è¯¥å¾ˆæ˜æ˜¾äº†ï¼Œä½¿åŸºç¡€çº§åˆ«çš„å±æ€§é”®ç‰¹æ®ŠåŒ–ä¼šå­˜åœ¨é—®é¢˜ã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å› æ­¤ï¼Œä»£ç†æ˜¯åˆ†å±‚çš„ï¼š<strong>åŸºç¡€çº§åˆ«ï¼ˆä»£ç†å¯¹è±¡ï¼‰å’Œå…ƒçº§åˆ«ï¼ˆhandler å¯¹è±¡ï¼‰æ˜¯åˆ†å¼€çš„</strong> ã€‚</p></div><h3 id="_5-2-è™šæ‹Ÿå¯¹è±¡-vs-åŒ…è£…å™¨" tabindex="-1">5.2 è™šæ‹Ÿå¯¹è±¡ vs åŒ…è£…å™¨ <a class="header-anchor" href="#_5-2-è™šæ‹Ÿå¯¹è±¡-vs-åŒ…è£…å™¨" aria-hidden="true">#</a></h3><p>ä»£ç†å¯ç”¨ä½œ2ç§è§’è‰²ï¼š</p><ol><li>ä½œä¸ºåŒ…è£…å™¨ï¼ˆ<code>wrappers</code>ï¼‰ï¼šåŒ…è£…ç›®æ ‡å¯¹è±¡ï¼Œæ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ã€‚åŒ…è£…å™¨ç¤ºä¾‹ï¼šå¯æ’¤é”€èµ„æºå’Œé€šè¿‡ä»£ç†è¿›è¡Œè¿½è¸ª</li><li>ä½œä¸ºè™šæ‹Ÿå¯¹è±¡ï¼ˆ<code>virtual objects</code>ï¼‰: å®ƒä»¬æ˜¯åŒ…å«ç‰¹æ®Šè¡Œä¸ºçš„ç®€å•å¯¹è±¡ï¼Œå®ƒä»¬çš„targetsä¸é‡è¦ã€‚ä¾‹å­ï¼šä»£ç†è½¬å‘æ–¹æ³•è°ƒç”¨ç»™è¿œç¨‹å¯¹è±¡</li></ol><p>ä»£ç† API çš„æ—©æœŸè®¾è®¡å°†ä»£ç†è§†ä¸ºçº¯è™šæ‹Ÿå¯¹è±¡ã€‚ç„¶è€Œï¼Œäº‹å®è¯æ˜ï¼Œå³ä½¿åœ¨é‚£ä¸ªè§’è‰²ä¸­ï¼Œç›®æ ‡ä¹Ÿæ˜¯æœ‰ç”¨çš„ï¼Œå¯ä»¥å¼ºåˆ¶æ‰§è¡Œä¸å˜æ€§å¹¶ä½œä¸ºhandleræœªå®ç°çš„trapsçš„fallbackã€‚</p><h3 id="_5-3-é€æ˜è™šæ‹ŸåŒ–å’Œhandlerå°è£…" tabindex="-1">5.3 é€æ˜è™šæ‹ŸåŒ–å’Œhandlerå°è£… <a class="header-anchor" href="#_5-3-é€æ˜è™šæ‹ŸåŒ–å’Œhandlerå°è£…" aria-hidden="true">#</a></h3><p>ä»£ç†é€šè¿‡ä¸¤ç§æ–¹å¼è¿›è¡Œå±è”½ï¼š</p><ol><li><strong>æ— æ³•ç¡®å®šå¯¹è±¡æ˜¯å¦ä¸ºä»£ç†ï¼ˆé€æ˜è™šæ‹ŸåŒ–ï¼‰ğŸ˜</strong></li><li>æˆ‘ä»¬æ— æ³•é€šè¿‡å…¶ä»£ç†è®¿é—®handlerï¼ˆhandlerå°è£…ï¼‰</li></ol><p>è¿™ä¸¤ä¸ªåŸåˆ™éƒ½èµ‹äºˆä»£ç†ç›¸å½“å¤§çš„èƒ½åŠ›æ¥æ¨¡æ‹Ÿå…¶ä»–å¯¹è±¡ã€‚å¼ºåˆ¶æ‰§è¡Œä¸å˜æ€§çš„ä¸€ä¸ªåŸå› ï¼ˆå¦‚åæ‰€è¿°ï¼‰æ˜¯ä¸ºäº†æ§åˆ¶è¿™ç§åŠ›é‡ã€‚</p><p>ğŸ¤”å¦‚æœæˆ‘ä»¬éœ€è¦åŒºåˆ†ä»£ç†å’Œéä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬å¿…é¡»è‡ªå·±å®ç°è¯¥åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯æ¨¡å— <code>lib.mjs</code> ä»£ç ï¼šä¸€ä¸ªåˆ›å»ºä»£ç†ï¼Œä¸€ä¸ªç¡®å®šå¯¹è±¡æ˜¯å¦æ˜¯å…¶ä¸­æŸä¸ªä»£ç†ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// lib.mjs</span></span>
<span class="line highlighted"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxies </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WeakSet</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createProxy</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">obj</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handler</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handler</span><span style="color:#F07178;">)</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">proxies</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">proxy</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isProxy</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">obj</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxies</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">has</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>è¯¥æ¨¡å—ä½¿ç”¨æ•°æ®ç»“æ„ <code>WeakSet</code> æ¥è·Ÿè¸ªä»£ç†ã€‚ WeakSet éå¸¸é€‚åˆæ­¤ç›®çš„ï¼Œå› ä¸ºå®ƒä¸ä¼šé˜»æ­¢å…¶å…ƒç´ è¢«åƒåœ¾å›æ”¶ã€‚</p><p>ç¤ºä¾‹ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createProxy</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isProxy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./lib.mjs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createProxy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">isProxy</span><span style="color:#A6ACCD;">(proxy)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equal</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">isProxy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p id="5.4"></p><h3 id="_5-4-â­ï¸-å…ƒå¯¹è±¡åè®®å’Œä»£ç†traps" tabindex="-1">5.4 â­ï¸ å…ƒå¯¹è±¡åè®®å’Œä»£ç†traps <a class="header-anchor" href="#_5-4-â­ï¸-å…ƒå¯¹è±¡åè®®å’Œä»£ç†traps" aria-hidden="true">#</a></h3><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥JSçš„å†…éƒ¨ç»“æ„ä»¥åŠå¦‚ä½•é€‰æ‹©ä»£ç†trapsã€‚</p><p>åœ¨ç¼–ç¨‹è¯­è¨€å’Œ API è®¾è®¡çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œåè®®æ˜¯ä¸€ç»„æ¥å£ä»¥åŠä½¿ç”¨å®ƒä»¬çš„è§„åˆ™ã€‚ECMAScriptè§„èŒƒæè¿°äº†å¦‚ä½•æ‰§è¡ŒJSä»£ç ã€‚å…¶ä¸­åŒ…å« <a href="https://tc39.es/ecma262/#sec-ordinary-and-exotic-objects-behaviours" target="_blank" rel="noreferrer">å¤„ç†å¯¹è±¡çš„åè®®</a>ã€‚<em>è¿™ä¸ªåè®®åœ¨å…ƒçº§åˆ«è¿›è¡Œæ“ä½œï¼Œæœ‰æ—¶è¢«ç§°ä¸ºå…ƒå¯¹è±¡åè®®ï¼ˆ<code>MOP</code>ï¼‰ğŸ‘©ğŸ»â€ğŸ«</em>ã€‚MOPç”±æ‰€æœ‰å¯¹è±¡éƒ½æ‹¥æœ‰çš„ <strong>å†…éƒ¨æ–¹æ³•</strong> ç»„æˆã€‚å†…éƒ¨æ„å‘³ç€å®ƒä»¬åªå­˜åœ¨äºè§„èŒƒä¸­ï¼ˆJSå¼•æ“å¯èƒ½å®ç°å®ƒä»¬ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰å®ç°ï¼‰ï¼Œä¸èƒ½è¢«JSæ‰€è®¿é—®ğŸ˜ã€‚å†…éƒ¨æ–¹æ³•ä¸€èˆ¬ä½¿ç”¨åŒä¸­æ‹¬å·ï¼ˆ<code>[[internal-method]]</code>ï¼‰çš„å½¢å¼ã€‚</p><p>è·å–å±æ€§çš„å†…éƒ¨æ–¹æ³•ç§°ä¹‹ä¸º <code>[[Get]]()</code>ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨åŒä¸‹åˆ’çº¿ï¼ˆ<code>__internalMethod__</code>ï¼‰æ›¿ä»£åŒä¸­æ‹¬å·ï¼Œåˆ™è¿™ä¸ªæ–¹æ³•å¤§è‡´å¯ä»¥ç”¨å¦‚ä¸‹JSå®ç°ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æ–¹æ³•å®šä¹‰</span></span>
<span class="line"><span style="color:#82AAFF;">__Get__</span><span style="color:#A6ACCD;">(propKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> receiver) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">desc</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">__GetOwnProperty__</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">propKey</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æŸ¥çœ‹å±æ€§æ˜¯å¦å­˜åœ¨</span></span>
<span class="line"><span style="color:#89DDFF;"> 	</span><span style="color:#676E95;font-style:italic;">// ä¸å­˜åœ¨å°±åœ¨çˆ¶åŸå‹é“¾ä¸ŠæŸ¥æ‰¾</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">desc</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">parent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">__GetPrototypeOf__</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">parent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¦‚æœæ‰¾åˆ° åˆ™é€’å½’è°ƒç”¨parentçš„ __Get__ æ–¹æ³•</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">parent</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">__Get__</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">propKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// A</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å¦‚æœå¯¹è±¡ä¸Šå­˜åœ¨ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦ç›´æ¥å°±å¯ä»¥è·å–</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">value</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">desc</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">desc</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å¦‚æœæ²¡æœ‰ç›´æ¥è·å–åˆ°ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº† getterçš„å½¢å¼å®šä¹‰çš„</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">getter</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">desc</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">get</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">getter</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å¦‚æœæ˜¯getterå½¢å¼å®šä¹‰çš„å±æ€§ï¼Œåˆ™è°ƒç”¨è¯¥getter</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">getter</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">__Call__</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">receiver</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> [])</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ğŸ“šä¸Šé¢ä»£ç ä¸­è°ƒç”¨çš„MOPæ–¹æ³•æœ‰ï¼š</p><ul><li><code>[[GetOwnProperty]]</code> (æ•è· <code>getOwnPropertyDescriptor</code>)</li><li><code>[[GetPrototypeOf]]</code>ï¼ˆæ•è· <code>getPrototypeOf</code>ï¼‰</li><li><code>[[Get]]</code> (æ•è· <code>get</code>)</li><li><code>[[Call]]</code> ï¼ˆæ•è· <code>apply</code>ï¼‰</li></ul><p>åœ¨è¡Œ <code>A</code> ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸ºä»€ä¹ˆåœ¨åŸå‹é“¾ä¸­çš„ä»£ç†åœ¨ä¸€ä¸ªå±æ€§åœ¨å…ˆå‰å¯¹è±¡æ‰¾ä¸åˆ°æ—¶ä¼šå»æ‰¾ <code>get</code>ï¼šå¦‚æœè‡ªèº«ä¸å­˜åœ¨keyä¸º <code>propKey</code> çš„å±æ€§ï¼Œ<code>this</code> æœç´¢å°†å»¶ç»­åˆ°åŸå‹é“¾ <code>parent</code> ã€‚</p><p>ğŸ‘©ğŸ»â€ğŸ« <strong>åŸºç¡€æ“ä½œ vs æ´¾ç”Ÿæ“ä½œ</strong>ã€‚æˆ‘ä»¬å¯ä»¥çœ‹å‡º <code>.[[Get]]()</code> ä¼šè°ƒç”¨å…¶å®ƒçš„MOPæ“ä½œã€‚è¿™æ ·è°ƒç”¨å…¶å®ƒæ“ä½œçš„æ–¹å¼ç§°ä¹‹ä¸º <strong>æ´¾ç”Ÿï¼ˆ<code>derived</code>ï¼‰</strong>ï¼Œå“ªäº›ä¸ä¾èµ–å…¶å®ƒæ“ä½œçš„ç§°ä¹‹ä¸º <strong>åŸºç¡€ï¼ˆ<code>fundamental</code>ï¼‰</strong>ã€‚</p><h4 id="ä»£ç†ä¸­çš„å…ƒå¯¹è±¡åè®®-the-meta-object-protocol-of-proxies" tabindex="-1">ä»£ç†ä¸­çš„å…ƒå¯¹è±¡åè®®ï¼ˆthe meta object protocol of Proxiesï¼‰ <a class="header-anchor" href="#ä»£ç†ä¸­çš„å…ƒå¯¹è±¡åè®®-the-meta-object-protocol-of-proxies" aria-hidden="true">#</a></h4><p><a href="https://tc39.es/ecma262/#sec-proxy-object-internal-methods-and-internal-slots" target="_blank" rel="noreferrer">ä»£ç†ä¸­çš„å…ƒå¯¹è±¡åè®®</a> ä¸åŒäºæ™®é€šå¯¹è±¡ã€‚å¯¹äºæ™®é€šå¯¹è±¡ï¼Œæ´¾ç”Ÿæ“ä½œä¼šè°ƒç”¨å…¶å®ƒæ“ä½œã€‚è€Œå¯¹ä»£ç†ï¼Œæ¯ä¸ªæ“ä½œï¼ˆä¸è®ºæ˜¯åŸºç¡€è¿˜æ˜¯æ´¾ç”Ÿçš„ï¼‰è¦ä¹ˆè¢«handleræ‹¦æˆªï¼Œè¦ä¹ˆè½¬å‘ç»™targetã€‚</p><p>å“ªäº›æ“ä½œä¼šè¢«ä»£ç†æ‹¦æˆªå‘¢ï¼Ÿ</p><ul><li>ä¸€ç§å¯èƒ½æ˜¯ï¼Œåªå¯¹åŸºç¡€æ“ä½œæä¾›é™·é˜±</li><li>å¦ä¸€ç§å°±æ˜¯åŒ…å«æŸäº›æ´¾ç”Ÿæ“ä½œçš„</li></ul><p>åä¸€ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ï¼Œå¢åŠ æ€§èƒ½å’Œæ›´åŠ æ–¹ä¾¿ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ²¡æœ‰ <code>get</code> trapï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»é€šè¿‡ <code>getOwnPropertyDescriptor</code> å®ç°å®ƒçš„åŠŸèƒ½ã€‚</p><p>è€ŒåŒ…å«æ´¾ç”Ÿtrapsçš„ç¼ºç‚¹å°±æ˜¯ï¼Œå¯èƒ½å¯¼è‡´ä»£ç†è¡Œä¸ºä¸ä¸€è‡´ã€‚æ¯”å¦‚ï¼Œ<code>get</code> å¯èƒ½è¿”å›ä¸€ä¸ªä¸åŒäº <code>getOwnPropertyDescriptor</code> è¿”å›çš„å€¼ã€‚</p><h4 id="é€‰æ‹©æ€§æ‹¦æˆª-å“ªäº›æ“ä½œåº”å½“è¢«æ‹¦æˆª" tabindex="-1">é€‰æ‹©æ€§æ‹¦æˆªï¼šå“ªäº›æ“ä½œåº”å½“è¢«æ‹¦æˆªï¼Ÿ <a class="header-anchor" href="#é€‰æ‹©æ€§æ‹¦æˆª-å“ªäº›æ“ä½œåº”å½“è¢«æ‹¦æˆª" aria-hidden="true">#</a></h4><p>ğŸ‘©ğŸ»â€ğŸ« é€šè¿‡ä»£ç†çš„æ‹¦æˆªæ˜¯é€‰æ‹©æ€§çš„ã€‚æˆ‘ä»¬ä¸èƒ½æ‹¦æˆªæ‰€æœ‰çš„è¯­è¨€æ“ä½œã€‚é‚£ä¸ºä»€ä¹ˆæœ‰äº›æ“ä½œä¼šè¢«æ’é™¤åœ¨å¤–å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬çœ‹çœ‹2ä¸ªåŸå› ã€‚</p><p>ç¬¬ä¸€ï¼Œ<strong>ç¨³å®šï¼ˆ<code>stable</code>ï¼‰</strong> æ“ä½œä¸å¤ªé€‚åˆæ‹¦æˆªã€‚<em>ä¸€ä¸ªæ“ä½œå¦‚æœè¾“å…¥ç›¸åŒçš„å‚æ•°æ€»è¿”å›ç›¸åŒç»“æœï¼Œæˆ‘ä»¬ç§°è¿™ç§æ“ä½œæ˜¯ç¨³å®šçš„</em>ã€‚å¦‚æœä»£ç†èƒ½æ‹¦æˆªç¨³å®šæ“ä½œï¼Œé‚£ä¹ˆè¯¥æ“ä½œå°†å˜å¾—ä¸ç¨³å®šå’Œä¸å¯é ã€‚ <a href="http://speakingjs.com/es5/ch09.html#_strict_equality" target="_blank" rel="noreferrer">ä¸¥æ ¼ç›¸ç­‰æ€§</a> å°±æ˜¯è¿™æ ·ä¸€ä¸ªç¨³å®šæ“ä½œã€‚å®ƒä¸èƒ½è¢«æ•è·ï¼Œå®ƒé€šè¿‡å°†ä»£ç†å¯¹è±¡è‡ªèº«å½“åšä¸€ä¸ªæ™®é€šå¯¹è±¡æ¥è®¡ç®—ç›¸ç­‰æ€§ç»“æœã€‚å¦ä¸€ç§ä¿æŒç¨³å®šæ€§çš„æ–¹å¼æ˜¯ï¼Œå¯¹targetæ‰§è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯å¯¹ä»£ç†ã€‚æ­£å¦‚ç¨åå°†è§£é‡Šçš„ï¼Œå½“æˆ‘ä»¬çŸ¥é“å¦‚ä½•å¼ºåˆ¶ä»£ç†æ‰§è¡Œä¸å˜æ€§æ—¶ï¼Œè¿™å¯¹é‚£äº›ä»£ç†äº†ä¸å¯æ‰©å±•çš„targetä½¿ç”¨ <code>Object.getPrototypeOf()</code> æ—¶å°±ä¼šå‘ç”Ÿã€‚</p><p>ä¸èƒ½å¯¹æ›´å¤šæ“ä½œè¿›è¡Œæ‹¦æˆªçš„ç¬¬äºŒä¸ªåŸå› æ˜¯ï¼Œæ‹¦æˆªæ„å‘³ç€æ‰§è¡Œé‚£äº›æ­£å¸¸æƒ…å†µä¸‹ä¸èƒ½æ‰§è¡Œä»£ç çš„æƒ…å½¢ã€‚æ‹¦æˆªå¾—è¶Šå¤šï¼Œç†è§£å’Œè°ƒè¯•ç¨‹åºå˜å¾—è¶Šå›°éš¾ã€‚åŒæ—¶å¯¹æ€§èƒ½ä¹Ÿä¼šæœ‰æ‰€å½±å“ã€‚</p><h4 id="â­-é™·é˜±-get-vs-invoke" tabindex="-1">â­ é™·é˜±ï¼šget vs invoke <a class="header-anchor" href="#â­-é™·é˜±-get-vs-invoke" aria-hidden="true">#</a></h4><p>ğŸ¤” å¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡ä»£ç†åˆ›å»ºè™šæ‹Ÿæ–¹æ³•ï¼Œæˆ‘ä»¬å¿…é¡»ä» <code>get</code> trapä¸­è¿”å›ä¸€ä¸ªå‡½æ•°ã€‚è¿™å°±å¼•å‘äº†ä¸€ä¸ªé—®é¢˜ï¼š<em>ä¸ºä»€ä¹ˆä¸å†æ·»åŠ ä¸€ä¸ªç”¨äºæ–¹æ³•è°ƒç”¨ï¼ˆæ¯”å¦‚ <code>invoke</code>ï¼‰çš„é™·é˜±å‘¢ï¼Ÿ</em> è¿™è®©æˆ‘ä»¬èƒ½åŒºåˆ†ï¼š</p><ul><li>è·å–å±æ€§é€šè¿‡ <code>obj.prop</code> ï¼ˆ<code>get</code> é™·é˜±ï¼‰</li><li>è°ƒç”¨æ–¹æ³•é€šè¿‡ <code>obj.prop()</code> ï¼ˆ<code>invoke</code> é™·é˜±ï¼‰</li></ul><p>ä¸è¿™æ ·åšæœ‰2ä¸ªåŸå› ï¼š</p><p>ç¬¬ä¸€ï¼Œä¸æ˜¯æ‰€æœ‰å®ç°éƒ½èƒ½åŒºåˆ† <code>get</code> å’Œ <code>invoke</code>,æ¯”å¦‚ è‹¹æœçš„ <code>JavaScriptCore</code> å°±ä¸èƒ½åŒºåˆ†ã€‚</p><p>ç¬¬äºŒï¼Œæå–æ–¹æ³•ï¼Œä¹‹åé€šè¿‡ <code>call() | apply()</code> è°ƒç”¨åº”å½“å’Œé€šè¿‡dispatchè°ƒç”¨æ–¹æ³•å…·æœ‰ç›¸åŒçš„æ•ˆæœã€‚æ¢å¥è¯è¯´ï¼Œä¸‹é¢2ç§å˜ç§åº”å½“æ•ˆæœä¸€æ ·ã€‚å¦‚æœå­˜åœ¨ä¸€ä¸ªé¢å¤–çš„é™·é˜± <code>invoke</code>ï¼Œåˆ™è¿™ç§ç›¸ç­‰æ€§å°±å¾ˆéš¾ç»´æŠ¤ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// å˜ç§1ï¼š åŠ¨æ€dispatchçš„æ–¹å¼è°ƒç”¨</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> result1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> obj</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">m</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å˜ç§2ï¼šå…ˆæå–ï¼Œä¹‹åè°ƒç”¨</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> m </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">m</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> result2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> m</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#A6ACCD;">(obj)</span></span>
<span class="line"></span></code></pre></div><blockquote><p>invokeçš„ä½¿ç”¨åœºæ™¯</p></blockquote><p>æœ‰æ—¶æœ‰äº›ä»£ç åªæœ‰åŒºåˆ†äº† <code>get</code> å’Œ <code>invoke</code> æ‰è¡Œã€‚è¿™ç§æƒ…å†µé€šè¿‡ç°åœ¨çš„ä»£ç†APIæ˜¯æ— æ³•å®Œæˆçš„ã€‚2ä¸ªç¤ºä¾‹ï¼š <strong>è‡ªåŠ¨ç»‘å®šå’Œæ‹¦æˆªä¸å­˜åœ¨çš„æ–¹æ³•</strong>ã€‚ä¸‹é¢çœ‹çœ‹å‡è®¾ä»£ç†æ”¯æŒ <code>invoke</code> é™·é˜±çš„å®ç°æ–¹å¼ã€‚</p><p><strong>è‡ªåŠ¨ç»‘å®šï¼ˆ<code>Auto-binding</code>ï¼‰</strong>ã€‚é€šè¿‡å°†ä»£ç†ä½œä¸ºå¯¹è±¡çš„åŸå‹ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªåŠ¨ç»‘å®šæ–¹æ³•ï¼š</p><ul><li>é€šè¿‡ <code>obj.m</code> å–å›æ–¹æ³•ï¼Œæ­¤æ—¶ <code>this</code> ç»‘å®šä¸º <code>obj</code></li><li><code>obj.m()</code> è°ƒç”¨æ–¹æ³•</li></ul><p>è‡ªåŠ¨ç»‘å®šåœ¨æˆ‘ä»¬å°†æ–¹æ³•å½“åšå›è°ƒå‡½æ•°æ—¶æœ‰ç”¨ï¼Œæ¯”å¦‚ï¼Œä¸Šé¢å˜ç§2å¯ä»¥ç®€å†™ä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> boundMethod </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">m</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä¸å†éœ€è¦.callå†ç»‘å®š</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">boundMethod</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span></code></pre></div><p><strong>æ‹¦æˆªä¸å­˜åœ¨çš„æ–¹æ³•</strong>ã€‚<code>invoke</code> å¯ä»¥æ¨¡æ‹Ÿå…ˆå‰æåˆ°çš„ <code>__noSuchMethod__</code> æœºåˆ¶ã€‚ä»£ç†è¿˜æ˜¯ä½œä¸ºå¯¹è±¡çš„åŸå‹ã€‚å®ƒä¼šå“åº”æœªçŸ¥å±æ€§ <code>prop</code> çš„è®¿é—®ï¼š</p><ul><li>æˆ‘ä»¬æˆ‘ä»¬é€šè¿‡ <code>obj.prop</code> è¯»å–å±æ€§ï¼Œæ²¡æœ‰æ‹¦æˆªè¡Œä¸ºå‘ç”Ÿï¼Œè¿”å› <code>undefined</code></li><li>å¦‚æœæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>obj.prop()</code> æ–¹æ³•ï¼Œåˆ™ä»£ç†æ‹¦æˆªå®ƒï¼Œæ¯”å¦‚é€šçŸ¥ä¸€ä¸ªå›è°ƒ</li></ul><p id="5.5"></p><h3 id="_5-5-å¯¹ä»£ç†å¼ºåˆ¶ä¸å˜æ€§" tabindex="-1">5.5 å¯¹ä»£ç†å¼ºåˆ¶ä¸å˜æ€§ <a class="header-anchor" href="#_5-5-å¯¹ä»£ç†å¼ºåˆ¶ä¸å˜æ€§" aria-hidden="true">#</a></h3><p>åœ¨æˆ‘ä»¬äº†è§£ä»€ä¹ˆæ˜¯ä¸å˜æ€§ï¼ˆ<code>invariants</code>ï¼‰å‰ï¼Œå…ˆäº†è§£ä»£ç†æ˜¯å¦‚ä½•å¼ºåˆ¶ä¸å˜æ€§çš„ã€‚æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ï¼Œå¯¹è±¡å¦‚ä½•é€šè¿‡ä¸å¯æ‰©å±•å’Œä¸å¯é…ç½®è¿›è¡Œä¿æŠ¤çš„ã€‚</p><h4 id="ä¿æŠ¤å¯¹è±¡" tabindex="-1">ä¿æŠ¤å¯¹è±¡ <a class="header-anchor" href="#ä¿æŠ¤å¯¹è±¡" aria-hidden="true">#</a></h4><p>2ç§ä¿æŠ¤å¯¹è±¡çš„æ–¹å¼ï¼š</p><ol><li>ä¸å¯æ‰©å±•æ€§ä¿æŠ¤å¯¹è±¡ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯ä¸å¯æ‰©å±•çš„ï¼Œæˆ‘ä»¬å¯¹å…¶ä¸èƒ½æ·»åŠ å±æ€§ï¼Œä»¥åŠæ”¹å˜å…¶åŸå‹</li><li>ä¸å¯é…ç½®ä¿æŠ¤å±æ€§ï¼ˆå‡†ç¡®æ¥è¯´æ˜¯ <code>attributes</code>ï¼‰: <ul><li><code>writable</code> attributeè¡¨ç¤ºä¸€ä¸ªå±æ€§å€¼æ˜¯å¦å¯ä»¥æ”¹å˜</li><li><code>configurable</code> æ§åˆ¶å±æ€§çš„attributesæ˜¯å¦å¯æ”¹å˜</li></ul></li></ol><p><a href="https://exploringjs.com/deep-js/ch_protecting-objects.html" target="_blank" rel="noreferrer">10 Protecting objects from being changed</a> äº†è§£æ›´å¤š</p><h4 id="å¼ºåˆ¶ä¸å˜æ€§-enforcing-invariants" tabindex="-1">å¼ºåˆ¶ä¸å˜æ€§ï¼ˆenforcing invariantsï¼‰ <a class="header-anchor" href="#å¼ºåˆ¶ä¸å˜æ€§-enforcing-invariants" aria-hidden="true">#</a></h4><p>ä¼ ç»Ÿä¸Šï¼Œä¸å¯æ‰©å±•æ€§å’Œä¸å¯é…ç½®æ€§ï¼š</p><ul><li>é€šç”¨çš„ï¼šå¯¹æ‰€æœ‰å¯¹è±¡éƒ½ç”Ÿæ•ˆ</li><li>å•è°ƒæ€§ï¼ˆ<code>Monotonic</code>ï¼‰ï¼šä¸€æ—¦æ‰“å¼€ï¼Œåˆ™ä¸èƒ½å°†å…¶å…³é—­ï¼Œå³è¿™ä¸ªè¿‡ç¨‹ä¸å¯é€†</li></ul><p>ğŸ“šè¿™äº›å’Œå…¶ä»–åœ¨è¯­è¨€æ“ä½œé¢å‰ä¿æŒä¸å˜çš„ç‰¹å¾ç§°ä¸ºä¸å˜æ€§ï¼ˆ<code>invariants</code>ï¼‰ã€‚é€šè¿‡ä»£ç†å¾ˆå®¹æ˜“è¿åä¸å˜æ€§ï¼Œå› ä¸ºå®ƒä»¬æœ¬è´¨ä¸Šä¸å—ä¸å¯æ‰©å±•æ€§ç­‰çš„çº¦æŸã€‚<strong>ä»£ç† API é€šè¿‡æ£€æŸ¥targetå’Œhandleræ–¹æ³•çš„ç»“æœæ¥é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿ</strong> ğŸ˜</p><p>ä¸‹é¢2ä¸ªå­å°èŠ‚æè¿°4ç§ä¸å˜æ€§ã€‚æ‰€æœ‰ä¸å˜æ€§æ¸…å•åœ¨æœ¬ç« æœ€ååˆ—å‡ºã€‚</p><h4 id="é€šè¿‡targetå¯¹è±¡çš„2ä¸ªå¼ºåˆ¶ä¸å˜æ€§" tabindex="-1">é€šè¿‡targetå¯¹è±¡çš„2ä¸ªå¼ºåˆ¶ä¸å˜æ€§ <a class="header-anchor" href="#é€šè¿‡targetå¯¹è±¡çš„2ä¸ªå¼ºåˆ¶ä¸å˜æ€§" aria-hidden="true">#</a></h4><p>ä¸‹é¢2ä¸ªä¸å˜æ€§æ¶‰åŠåˆ°ä¸å¯æ‰©å±•æ€§å’Œä¸å¯é…ç½®æ€§ã€‚è¿™äº›æ˜¯é€šè¿‡ä½¿ç”¨targetå¯¹è±¡ç™»è®°æ¥å¼ºåˆ¶æ‰§è¡Œçš„ï¼š<em>handleræ–¹æ³•è¿”å›çš„ç»“æœå¿…é¡»å¤§éƒ¨åˆ†ä¸targetå¯¹è±¡åŒæ­¥</em>ã€‚</p><ul><li>ä¸å˜æ€§ï¼šå¦‚æœ <code>Object.preventExtensions(obj)</code> è¿”å› <code>true</code>ï¼Œåˆ™ä¹‹åçš„æ‰€æœ‰è°ƒç”¨éƒ½å¿…é¡»è¿”å› <code>false</code>ï¼Œå¹¶ä¸”ç°åœ¨ <code>obj</code> å¿…é¡»ä¸å¯æ‰©å±• <ul><li>å¦‚æœhandlerè¿”å›trueï¼Œåˆ™å¼ºåˆ¶ä»£ç†æŠ›å‡º <code>TypeError</code> é”™è¯¯ï¼Œä½†æ˜¯targetå¯¹è±¡æ˜¯ä¸å¯æ‰©å±•çš„</li></ul></li><li>ä¸å˜æ€§ï¼šä¸€æ—¦å¯¹è±¡å˜å¾—ä¸å¯æ‰©å±•ï¼Œ<code>Object.isExtensible(obj)</code> æ€»æ˜¯è¿”å› <code>false</code><ul><li>å¦‚æœhandlerè¿”å›çš„ç»“æœä¸ Object.isExtensible(target) ä¸åŒï¼ˆè½¬æ¢ï¼ˆ<code>coercion</code>ï¼‰ä¹‹åï¼‰ï¼Œåˆ™é€šè¿‡æŠ›å‡º TypeError å¼ºåˆ¶ä»£ç†ã€‚</li></ul></li></ul><h4 id="ä¸å˜æ€§çš„å¥½å¤„" tabindex="-1">ä¸å˜æ€§çš„å¥½å¤„ <a class="header-anchor" href="#ä¸å˜æ€§çš„å¥½å¤„" aria-hidden="true">#</a></h4><p>å¼ºåˆ¶ä¸å˜æ€§æœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p><ul><li>åœ¨å¯é…ç½®æ€§å’Œå¯æ‰©å±•æ€§ä¸Šï¼Œä»£ç†å’Œæ™®é€šå¯¹è±¡ä¸€æ ·ï¼Œå› æ­¤ï¼Œé€šç”¨æ€§å¾—ä»¥ä¿æŒã€‚è¿™æ˜¯åœ¨ä¸é˜»æ­¢ä»£ç†è™šæ‹ŸåŒ–ï¼ˆæ¨¡æ‹Ÿï¼‰å—ä¿æŠ¤å¯¹è±¡çš„æƒ…å†µä¸‹å®ç°çš„ã€‚</li><li>ä¸€ä¸ªå—ä¿æŠ¤çš„å¯¹è±¡ä¸èƒ½é€šè¿‡åœ¨å®ƒå‘¨å›´åŒ…è£¹ä¸€ä¸ªä»£ç†æ¥è¢«é”™è¯¯è¡¨ç¤ºã€‚é”™è¯¯è¡¨ç¤ºå¯èƒ½æ˜¯ç”±é”™è¯¯æˆ–æ¶æ„ä»£ç å¼•èµ·çš„ã€‚</li></ul><p>æ¥ä¸‹æ¥çš„ä¸¤èŠ‚ç»™å‡ºäº†å¼ºåˆ¶æ‰§è¡Œä¸å˜æ€§çš„ç¤ºä¾‹ã€‚</p><h4 id="ğŸŒ°-ç¤ºä¾‹-ä¸å¯æ‰©å±•çš„targetçš„åŸå‹è¢«è¡¨ç¤ºæ—¶å¿…é¡»å¤±è´¥" tabindex="-1">ğŸŒ° ç¤ºä¾‹ï¼šä¸å¯æ‰©å±•çš„targetçš„åŸå‹è¢«è¡¨ç¤ºæ—¶å¿…é¡»å¤±è´¥ <a class="header-anchor" href="#ğŸŒ°-ç¤ºä¾‹-ä¸å¯æ‰©å±•çš„targetçš„åŸå‹è¢«è¡¨ç¤ºæ—¶å¿…é¡»å¤±è´¥" aria-hidden="true">#</a></h4><p>ä¸ºäº†å“åº” <code>getPrototypeOf</code> é™·é˜±ï¼Œå¦‚æœtargetæ˜¯ä¸å¯æ‰©å±•çš„ï¼Œä»£ç†å¿…é¡»è¿”å›targetçš„åŸå‹ã€‚</p><p>ä¸ºäº†æ¼”ç¤ºè¿™ç§ä¸å˜æ€§ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªhandlerï¼Œhandlerè¿”å›ä¸€ä¸ªä¸åŒäºtargetåŸå‹çš„åŸå‹ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fakeProto </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">getPrototypeOf</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">t</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fakeProto</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å¦‚æœtargetæ˜¯å¯æ‰©å±•çš„ï¼Œåˆ™å‡å†’çš„åŸå‹æ­£å¸¸å·¥ä½œï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> extensibleTarget </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> extProxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(extensibleTarget</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getPrototypeOf</span><span style="color:#A6ACCD;">(extProxy) </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> fakeProto </span><span style="color:#676E95;font-style:italic;">// true</span></span>
<span class="line"></span></code></pre></div><p>ä½†æ˜¯ï¼Œå½“targetæ˜¯ä¸å¯æ‰©å±•æ—¶ï¼Œè¿”å›å‡å†’åŸå‹ï¼Œå°†æŠ›å‡ºTypeError:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> nonextensibleTarget </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">preventExtensions</span><span style="color:#A6ACCD;">(nonextensibleTarget)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> nonExtProxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(nonextensibleTarget</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// âŒ TypeErrorï¼š ä»£ç†ç›®æ ‡ä¸ºä¸å¯æ‰©å±•ï¼Œtrapåº”è¯¥è¿”å›å…¶çœŸæ­£çš„åŸå‹</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// &#39;getPrototypeOf&#39; on proxy: proxy target is</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// non-extensible but the trap did not return its</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// actual prototype&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getPrototypeOf</span><span style="color:#A6ACCD;">(nonExtProxy)</span></span>
<span class="line"></span></code></pre></div><h4 id="ğŸŒ°-ç¤ºä¾‹-ä¸å¯å†™-ä¸å¯é…ç½®targetå±æ€§å¿…é¡»æ˜¾ç¤ºå¤±è´¥" tabindex="-1">ğŸŒ° ç¤ºä¾‹ï¼šä¸å¯å†™ï¼Œä¸å¯é…ç½®targetå±æ€§å¿…é¡»æ˜¾ç¤ºå¤±è´¥ <a class="header-anchor" href="#ğŸŒ°-ç¤ºä¾‹-ä¸å¯å†™-ä¸å¯é…ç½®targetå±æ€§å¿…é¡»æ˜¾ç¤ºå¤±è´¥" aria-hidden="true">#</a></h4><p>å¦‚æœä¸€ä¸ªtargetçš„å±æ€§ä¸å¯å†™(<code>non-writable</code>)ä¸å¯é…ç½®(<code>unconfigurable</code>)ï¼Œåˆ™handlerå¿…é¡»è¿”å›è¯¥å±æ€§çš„å€¼ï¼Œä½œä¸ºå¯¹ <code>get</code> é™·é˜±çš„å“åº”ã€‚ä¸ºäº†æ¼”ç¤ºè¿™ä¸ªä¸å¯å˜æ€§ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªhandlerï¼Œæ€»æ˜¯å¯¹å±æ€§è¿”å›ç›¸åŒçš„å€¼ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">propKey</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> target </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">defineProperties</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">manufacturer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¯å†™ å¯é…ç½®å±æ€§</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Iso Autoveicoli</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">writable</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">configuratble</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">model</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ğŸš¨ ä¸å¯å†™ä¸å¯é…ç½®å±æ€§</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Isetta</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    writable</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> false.</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">configurablt</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"></span></code></pre></div><p><code>manufacturer</code> å±æ€§å¯å†™å¯é…ç½®ï¼Œåˆ™è¡¨ç¤ºhandlerå…è®¸å…¶å‡è£…æœ‰ä¸åŒçš„å€¼ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">proxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">manufacturer </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// true</span></span>
<span class="line"></span></code></pre></div><p>è€Œ <code>target.model</code> æ—¢ä¸å¯å†™ä¹Ÿä¸å¯é…ç½®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½å†’å……å®ƒçš„å€¼ğŸ˜…ï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line highlighted"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">âŒ</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">TypeError:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">modelæ˜¯ä¸€ä¸ªåªè¯»ä¸”ä¸å¯é…ç½®çš„æ•°æ®å±æ€§ï¼Œä½†ä»£ç†æ²¡æœ‰è¿”å›å…¶å®é™…å€¼</span></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">proxy:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">property</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">model</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">read-only</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">and</span></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">non-configurable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">data</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">property</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">proxy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">target</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">but</span></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">proxy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">did</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">its</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">actual</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">expected</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Isetta</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">but</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">got</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">proxy.model</span></span>
<span class="line"></span></code></pre></div><p>proxyçš„ <code>get</code>: å±æ€§ <code>model</code> æ˜¯ä¸€ä¸ªåœ¨ä»£ç†targetä¸Šåªè¯»ä¸”ä¸å¯é…ç½®çš„æ•°æ®å±æ€§ã€‚ä½†æ˜¯ä»£ç†æ²¡æœ‰è¿”å›å…¶çœŸå®å€¼ï¼ˆæœŸæœ› &#39;Isetta&#39;, ä½†æ˜¯å¾—åˆ°çš„æ˜¯ &#39;abc&#39;ï¼‰</p><p id="6"></p><h2 id="_6ï¸âƒ£-proxyé—®ç­”-enumerate-é™·é˜±å»å“ªé‡Œäº†" tabindex="-1">6ï¸âƒ£ Proxyé—®ç­”ï¼šenumerate é™·é˜±å»å“ªé‡Œäº†ï¼Ÿ <a class="header-anchor" href="#_6ï¸âƒ£-proxyé—®ç­”-enumerate-é™·é˜±å»å“ªé‡Œäº†" aria-hidden="true">#</a></h2><p>ES6å¼€å§‹æ˜¯ç”± <code>enumerate</code> é™·é˜±çš„ï¼Œé€šè¿‡ <code>for...in</code> å¾ªç¯è§¦å‘ã€‚ä½†æ˜¯ä¸ºäº†ç®€åŒ–ä»£ç†ç°åœ¨å·²è¢«ç§»é™¤ã€‚<code>Reflect.enumerate()</code> ä¹Ÿä¸€å¹¶è¢«ç§»é™¤ã€‚</p><p id="7"></p><h2 id="_7ï¸âƒ£-proxy-api-æ‰‹å†Œ" tabindex="-1">7ï¸âƒ£ Proxy API æ‰‹å†Œ <a class="header-anchor" href="#_7ï¸âƒ£-proxy-api-æ‰‹å†Œ" aria-hidden="true">#</a></h2><p>è¿™ä¸ªå°èŠ‚å¯¹Proxy APIå¿«é€ŸæŸ¥é˜…</p><ul><li>å…¨å±€å¯¹è±¡ <code>Proxy</code></li><li>å…¨å±€å¯¹è±¡ <code>Reflect</code></li></ul><p>æ‰‹å†Œä½¿ç”¨ä¸‹é¢è‡ªå®šä¹‰ç±»å‹ï¼š</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PropertyKey</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">symbol</span></span>
<span class="line"></span></code></pre></div><p id="7.1"></p><h3 id="_7-1-åˆ›å»ºä»£ç†" tabindex="-1">7.1 åˆ›å»ºä»£ç† <a class="header-anchor" href="#_7-1-åˆ›å»ºä»£ç†" aria-hidden="true">#</a></h3><p>2ç§æ–¹å¼åˆ›å»ºä»£ç†:</p><p>æ–¹å¼1ï¼š ä½¿ç”¨ç»™å®štargetå’Œhandleråˆ›å»ºä»£ç†</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"></span></code></pre></div><p>æ–¹å¼2ï¼šåˆ›å»ºå¯æ’¤é”€çš„ä»£ç†ï¼Œ<code>rovoke</code> å¯ä»¥è°ƒç”¨å¤šæ¬¡ï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡ç”Ÿæ•ˆï¼Œå…³é—­ä»£ç†ã€‚ä¹‹åï¼Œä»»ä½•å¯¹ä»£ç†çš„æ“ä½œéƒ½ä¼šæŠ›å‡ºTypeError</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> proxy</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> revoke </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Proxy</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">revocable</span><span style="color:#A6ACCD;">(target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> handler)</span></span>
<span class="line"></span></code></pre></div><p id="7.2"></p><h3 id="_7-2-handleræ–¹æ³•" tabindex="-1">7.2 Handleræ–¹æ³• <a class="header-anchor" href="#_7-2-handleræ–¹æ³•" aria-hidden="true">#</a></h3><p>è¿™ä¸€èŠ‚ä»‹ç»handlerå¯ä»¥å®ç°ä»€ä¹ˆtrapsï¼Œä»¥åŠä»€ä¹ˆæ“ä½œä¼šè§¦å‘ç›¸åº”çš„trapsã€‚å‡ ä¸ªtrapsè¿”å›å¸ƒå°”å€¼ã€‚æ¯”å¦‚ <code>has</code> &amp; <code>isExtensible</code>ï¼Œ å¸ƒå°”å€¼æ˜¯æ“ä½œçš„ç»“æœã€‚è€Œå¯¹æ‰€æœ‰å…¶å®ƒtrapsï¼Œå¸ƒå°”å€¼è¡¨ç¤ºæ“ä½œæ˜¯å¦æˆåŠŸã€‚</p><p>æ‰€æœ‰å¯¹è±¡çš„traps:</p><ul><li><code>defineProperty(target, propKey, propDesc): boolean</code><ul><li><code>Object.defineProperty(target, propKey, propDesc)</code></li></ul></li><li><code>deleteProperty(target, propKey): boolean</code><ul><li><code>delete proxy[propKey]</code></li><li><code>delete proxy.someProp</code></li></ul></li><li><code>get(target, propKey, receiver): any</code><ul><li><code>receiver[propKey]</code></li><li><code>receiver.someProp</code></li></ul></li><li><code>getOwnPropertyDescriptor(target, propKey): undefined | PropDesc</code><ul><li><code>Object.getOwnPropertyDescriptor(target, propKey)</code></li></ul></li><li><code>getPrototypeOf(target): null|object</code><ul><li><code>Object.getPrototypeOf(proxy)</code></li></ul></li><li><code>has(target, propKey): boolean</code><ul><li><code>propKey in proxy</code></li></ul></li><li><code>isExtensiable(target): boolean</code><ul><li><code>Object.isExtensiable(proxy)</code></li></ul></li><li><code>ownKeys(target): Array&lt;PropertyKey&gt;</code><ul><li><code>Object.getOwnPropertyNames(proxy)</code>: åªä½¿ç”¨å­—ç¬¦ä¸²keys</li><li><code>Object.getOwnPropertySymbols(proxy)</code>: åªä½¿ç”¨ symbol Keys</li><li><code>Object.keys(proxy)</code>: åªä½¿ç”¨å¯æšä¸¾çš„å­—ç¬¦ä¸²keysã€‚å¯æšä¸¾æ€§å¯ä»¥é€šè¿‡ <code>Object.getOwnPropertyDescriptor</code> æ£€æµ‹</li></ul></li><li><code>preventExtensions(target): boolean</code><ul><li><code>Object.preventExtensions(proxy)</code></li></ul></li><li><code>set(target, propKey, value, receiver): boolean</code><ul><li><code>receiver[propKey] = value</code></li><li><code>receiver.someProp = value</code></li></ul></li><li><code>setPrototypeOf(target, proto): boolean</code><ul><li><code>Object.setPrototypeOf(proxy, proto)</code></li></ul></li></ul><p>åªé’ˆå¯¹å‡½æ•°çš„trapsï¼ˆtargetæ˜¯ä¸€ä¸ªå‡½æ•°ï¼‰ï¼š</p><ul><li><code>apply(target, thisArgument, argumentsList): any</code><ul><li><code>proxy.apply(thisArgument, argumentsList)</code></li><li><code>proxy.call(thisArgument, ...argumentsList)</code></li><li><code>proxy(...argumentsList)</code></li></ul></li><li><code>constructor(target, argumentsList, newTarget): object</code><ul><li><code>new Proxy(...argumentsList)</code></li></ul></li></ul><blockquote><p>åŸºç¡€æ“ä½œ vs æ´¾ç”Ÿæ“ä½œ</p></blockquote><p>ä¸‹é¢æ“ä½œæ˜¯åŸºç¡€çš„ï¼Œå®ƒä»¬ä¸ä¾èµ–å…¶å®ƒæ“ä½œï¼š</p><ul><li>apply</li><li>defineProperty</li><li>deleteProperty</li><li>getOwnPropertyDescriptor</li><li>getPrototypeOf</li><li>isExtensiable</li><li>ownKeys</li><li>preventExtensions</li><li>setPrototypeOf</li></ul><p>å…¶ä½™çš„æ“ä½œåˆ™éƒ½æ˜¯æ´¾ç”Ÿçš„ï¼Œå®ƒä»¬é€šè¿‡ç»„åˆåŸºæœ¬æ“ä½œå®ç°ã€‚æ¯”å¦‚ï¼š<code>get</code> é€šè¿‡ <code>getPrototypeOf</code> è¿­ä»£åŸå‹é“¾å’Œå¯¹é“¾ä¸Šçš„æˆå‘˜è°ƒç”¨ <code>getOwnPropertyDescritptor</code> ï¼Œç›´åˆ°æ‰¾åˆ°è‡ªèº«å±æ€§æˆ–åŸå‹é“¾ä¸Šçš„å±æ€§ä¸ºæ­¢ã€‚</p><p id="7.3"></p><h3 id="_7-3-handleræ–¹æ³•çš„ä¸å˜æ€§" tabindex="-1">7.3 handleræ–¹æ³•çš„ä¸å˜æ€§ <a class="header-anchor" href="#_7-3-handleræ–¹æ³•çš„ä¸å˜æ€§" aria-hidden="true">#</a></h3><p>ä¸å˜æ€§æ˜¯handlersçš„å®‰å…¨çº¦æŸã€‚è¿™ä¸€èŠ‚ä»‹ç»ä»£ç† API å¼ºåˆ¶æ‰§è¡Œå“ªäº›ä¸å˜æ€§ä»¥åŠå¦‚ä½•æ‰§è¡Œã€‚<em>ä¸‹é¢å¦‚æœæåˆ° handlerå¿…é¡»åšä»€ä¹ˆï¼Œå¦‚æœæ²¡æœ‰åšï¼Œåˆ™ä¼šæŠ›å‡ºTypeErrorã€‚</em> æœ‰äº›ä¸å˜æ€§é™åˆ¶è¿”å›å€¼ï¼Œæœ‰ä¸€äº›åˆ™é™åˆ¶å‚æ•°ã€‚trapè¿”å›å€¼çš„æ­£ç¡®æ€§ç”±ä»¥ä¸‹2ç§æ–¹å¼ç¡®ä¿ï¼š</p><ol><li>å¦‚æœå¸Œæœ›è¿”å›å¸ƒå°”å€¼ï¼Œåˆ™ä¼šå°†éå¸ƒå°”å€¼è½¬æ¢ï¼ˆcoercionï¼‰æˆå¸ƒå°”å€¼</li><li>å…¶å®ƒæƒ…å†µï¼Œéæ³•å€¼å°†æŠ›å‡ºTypeError</li></ol><p>ä¸‹é¢æ˜¯å®Œæ•´çš„å¼ºåˆ¶ä¸å˜æ€§åˆ—è¡¨ï¼š</p><ol><li><code>apply(target, thisArgument, argumentsList): any</code><ul><li>ä¸å¼ºåˆ¶ä¸å˜æ€§</li><li>åªæœ‰å½“targetæ˜¯å¯è°ƒç”¨çš„ï¼ˆå³ä¸ºå‡½æ•°æˆ–è€…æ„é€ å™¨ï¼‰æ—¶æ‰æ¿€æ´»å¼ºåˆ¶ä¸å˜æ€§</li></ul></li><li><code>construct(target, argumentsList, newTarget):objcet</code><ul><li>handlerçš„è¿”å›å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ ï¼ˆé nullæˆ–å…¶å®ƒä»»ä½•åŸºç¡€ç±»å‹å€¼ï¼‰</li><li>åªæœ‰å½“targetèƒ½æ„é€ æ—¶æ¿€æ´»</li></ul></li><li><code>defineProperty(target, propKey, propDesc): boolean</code><ul><li>å¦‚æœtargetä¸å¯æ‰©å±• ï¼Œåˆ™ä¸èƒ½æ·»åŠ æ–°çš„å±æ€§</li><li>å¦‚æœ <code>propDesc</code> å°†attribute <code>configurable</code> è®¾ç½®ä¸º <code>false</code>ï¼Œåˆ™targetå¿…é¡»æœ‰ä¸€ä¸ªkeyåä¸º <code>propKey</code>çš„ ä¸å¯é…ç½®çš„å±æ€§</li><li>å¦‚æœ <code>propDesc</code> å°†attribute <code>configurable</code> &amp; <code>writable</code> éƒ½è®¾ç½®ä¸º <code>false</code>ï¼Œåˆ™targetå¿…é¡»æœ‰ä¸€ä¸ªkeyåä¸º <code>propKey</code>çš„ ä¸å¯é…ç½®ä¸”ä¸å¯å†™çš„å±æ€§</li><li>å¦‚æœtaregtæœ‰ä¸€ä¸ªè‡ªå·±çš„å±æ€§ï¼Œkeyä¸º <code>propKey</code>, åˆ™ <code>propDesc</code> å¿…é¡»å…¼å®¹è¯¥å±æ€§ï¼šå¦‚æœæˆ‘ä»¬é‡æ–°å®šä¹‰targetå±æ€§çš„descriptorï¼Œå°±ä¸€å®šä¸èƒ½æŠ›å‡ºå¼‚å¸¸</li></ul></li><li><code>deleteProperty(target, propKey): boolean</code><ul><li>å¦‚æœå‡ºç°ä»¥ä¸‹æƒ…å†µï¼Œåˆ™ä¸èƒ½å°†å±æ€§æŠ¥å‘Šä¸ºå·²åˆ é™¤ï¼š <ul><li>target æœ‰ä¸€ä¸ª <code>propKey</code> å±æ€§ä¸å¯é…ç½®</li><li>targetä¸å¯æ‰©å±•å¹¶æœ‰ä¸€ä¸ªè‡ªèº«çš„å±æ€§ <code>propKey</code></li></ul></li></ul></li><li><code>get(target, propKey, receiver): any</code><ul><li>å¦‚æœtargetçš„propKeyä¸å¯å†™ä¸å¯é…ç½®ï¼Œåˆ™handlerå¿…é¡»è¿”å›è¯¥å±æ€§å€¼</li><li>å¦‚æœtargetæœ‰ä¸€ä¸ªä¸å¯é…ç½®ï¼Œæ²¡æœ‰getterè®¿é—®å™¨çš„å±æ€§ï¼Œåˆ™å¿…é¡»è¿”å›undefined</li></ul></li><li><code>getOwnPropertyDescriptor(target, propKey): undefined|PropDesc</code><ul><li>handlerå¿…é¡»è¿”å›undefinedæˆ–ä¸€ä¸ªå¯¹è±¡</li><li>targetè‡ªèº«ä¸å¯é…ç½®å±æ€§ï¼Œhandlerä¸èƒ½å°†ç›®æ ‡çš„ä¸å¯é…ç½®è‡ªèº«å±æ€§æŠ¥å‘Šä¸ºä¸å­˜åœ¨ã€‚</li><li>å¦‚æœtargetæ˜¯ä¸å¯æ‰©å±•çš„ï¼Œé‚£ä¹ˆhandlerå¿…é¡»å°†targetè‡ªèº«å‡†ç¡®åœ°æŠ¥å‘Šä¸ºå­˜åœ¨</li><li>å¦‚æœhandleræŠ¥å‘ŠæŸä¸ªå±æ€§ä¸ºä¸å¯é…ç½®çš„ï¼Œé‚£ä¹ˆè¯¥å±æ€§å¿…é¡»æ˜¯targetçš„ä¸å¯é…ç½®è‡ªèº«å±æ€§</li><li>å¦‚æœhandleræŠ¥å‘ŠæŸä¸ªå±æ€§ä¸ºä¸å¯é…ç½®å’Œä¸å¯å†™çš„ï¼Œé‚£ä¹ˆè¯¥å±æ€§å¿…é¡»æ˜¯targetçš„ä¸å¯é…ç½®å’Œä¸å¯å†™çš„è‡ªèº«å±æ€§</li></ul></li><li><code>getPrototypeOf(target): null|object</code><ul><li>å¿…é¡»è¿”å›nullæˆ–ä¸€ä¸ªå¯¹è±¡</li><li>å¦‚æœtargetæ˜¯ä¸å¯æ‰©å±•çš„ï¼Œåˆ™handlerå¿…é¡»è¿”å›targetç‹¬äº«çš„ åŸå‹</li></ul></li><li><code>has(target, propKey): boolean</code><ul><li>targetè‡ªèº«ä¸å¯é…ç½®çš„è‡ªèº«å±æ€§ä¸èƒ½æŠ¥å‘Šä¸ºä¸å­˜åœ¨</li><li>å¦‚æœtargetæ˜¯ä¸å¯æ‰©å±•çš„ï¼Œåˆ™targetè‡ªèº«çš„å±æ€§ä¸å­˜åœ¨ä¸ŠæŠ¥ä¸ºä¸å­˜åœ¨</li></ul></li><li><code>isExtensible(target): boolean</code><ul><li>åœ¨è½¬æ¢ä¸ºå¸ƒå°”å€¼ä¹‹åï¼Œhandlerè¿”å›çš„å€¼å¿…é¡»å’Œ <code>target.isExtensible()</code> ç›¸åŒ</li></ul></li><li><code>ownKeys(target): Array&lt;PropertyKey&gt;</code><ul><li>handlerå¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè§†ä½œç±»æ•°ç»„å’Œè½¬æ¢ä¸ºæ•°ç»„</li><li>è¿”å›çš„æ•°ç»„ä¸èƒ½åŒ…å«é‡å¤çš„entries</li><li>ç»“æœä¸­çš„æ¯ä¸ªå…ƒç´ è¦ä¹ˆæ˜¯å­—ç¬¦ä¸²è¦ä¹ˆæ˜¯symbol</li><li>è¿”å›çš„ç»“æœå¿…é¡»åŒ…å«targetæ‰€æœ‰ä¸å¯é…ç½®çš„è‡ªèº«å±æ€§keys</li><li>å¦‚æœtargetä¸å¯æ‰©å±•ï¼Œåˆ™è¿”å›ç»“æœå¿…é¡»å€¼åŒ…å«targetè‡ªèº«çš„å±æ€§keysï¼ˆä¸å­˜åœ¨å…¶å®ƒå€¼ï¼‰</li></ul></li><li><code>preventExtensions(target): boolean</code><ul><li>å¦‚æœ target.isExtensibleè¿”å›falseï¼Œåˆ™handlerå¿…é¡»åªè¿”å›ä¸€ä¸ªçœŸå€¼ï¼ˆè¡¨ç¤ºä¸€ä¸ªæˆåŠŸçš„æ”¹å˜ï¼‰</li></ul></li><li><code>set(target, propKey, value, receiver): boolean</code><ul><li>å¦‚æœtargetæ˜¯ä¸€ä¸ªä¸å¯å†™ï¼Œä¸å¯é…ç½®çš„æ•°æ®ï¼Œå…¶keyä¸º <code>propPey</code>ï¼Œåˆ™è¯¥å±æ€§ä¸èƒ½æ”¹å˜ã€‚è¿™ç§æƒ…å†µï¼Œ<code>value</code> å¿…é¡»æ˜¯è¯¥å±æ€§çš„å€¼ï¼Œå¦åˆ™æŠ›å‡º TypeError</li><li>å¦‚æœç›¸åº”çš„è‡ªå·±çš„targetå±æ€§æ˜¯æ²¡æœ‰è®¾ç½®å™¨çš„ä¸å¯é…ç½®è®¿é—®å™¨ï¼Œåˆ™ä¸èƒ½ä»¥ä»»ä½•æ–¹å¼è®¾ç½®è¯¥å±æ€§</li></ul></li><li><code>setPrototypeOf(target, proto): boolean</code><ul><li>å¦‚æœtargetæ˜¯ä¸å¯æ‰©å±•çš„ï¼Œå±æ€§ä¸èƒ½æ”¹å˜ã€‚é€šè¿‡ä¸‹é¢æ–¹å¼è¿›è¡Œå¼ºåˆ¶è¿™ç§è¡Œä¸ºï¼šå¦‚æœtargetä¸å¯æ‰©å±•ï¼Œhandlerè¿”å›ä¸€ä¸ªçœŸå€¼ï¼ˆè¡¨ç¤ºæˆåŠŸæ”¹å˜ï¼‰ï¼Œ<code>proto</code> å¿…é¡»å’ŒtargetåŸå‹ä¸€æ ·ï¼Œå¦åˆ™æŠ›å‡ºTypeError</li></ul></li></ol><p>æ›´å¤šå¯å‚è€ƒï¼š</p><ul><li><a href="https://tc39.es/ecma262/#sec-proxy-object-internal-methods-and-internal-slots" target="_blank" rel="noreferrer">ä»£ç†å¯¹è±¡å†…éƒ¨æ–¹æ³•å’Œå†…éƒ¨æ§½ - ECMAScriptè§„èŒƒ</a></li></ul><p id="7.4"></p><h3 id="_7-4-å½±å“åŸå‹é“¾çš„æ“ä½œ" tabindex="-1">7.4 å½±å“åŸå‹é“¾çš„æ“ä½œ <a class="header-anchor" href="#_7-4-å½±å“åŸå‹é“¾çš„æ“ä½œ" aria-hidden="true">#</a></h3><p>ä¸‹é¢æ˜¯æ™®é€šå¯¹è±¡å¯¹å¯¹è±¡åŸå‹é“¾çš„æ“ä½œã€‚å› æ­¤ï¼Œå¦‚æœå¯¹è±¡çš„åŸå‹é“¾æ˜¯ä¸€ä¸ªä»£ç† ï¼Œå®ƒçš„trapså°†è¢«è§¦å‘ã€‚è§„èŒƒä»¥è‡ªå·±å†…éƒ¨æ–¹æ³•å®ç°è¯¥æ“ä½œï¼ˆå³å¯¹JSä»£ç ä¸å¯è§ï¼‰ã€‚ä½†æ˜¯åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å‡è£…å®ƒä»¬æ˜¯å’Œtrapsæœ‰ä¸€æ ·åå­—çš„æ™®é€šæ–¹æ³•ã€‚<code>target</code> å‚æ•°å˜ä¸ºæ–¹æ³•è°ƒç”¨çš„æ¥æ”¶è€…ã€‚</p><ul><li><code>target.get(propertyKey, receiver)</code>: å¦‚æœå¯¹ç»™å®šçš„keyä¸å­˜åœ¨è‡ªèº«å±æ€§ï¼Œ<code>get</code> å°†åœ¨targetçš„åŸå‹ä¸Šè¢«è°ƒç”¨</li><li><code>target.has(propertyKey)</code>: åŒ <code>get</code> ç›¸ä¼¼ã€‚ å¦‚æœå¯¹ç»™å®šçš„keyä¸å­˜åœ¨è‡ªèº«å±æ€§ï¼Œ<code>has</code> å°†åœ¨targetçš„åŸå‹ä¸Šè¢«è°ƒç”¨</li><li><code>target.set(propertyKey, value, receiver)</code>: åŒ <code>get</code> ç›¸ä¼¼ã€‚ å¦‚æœå¯¹ç»™å®šçš„keyä¸å­˜åœ¨è‡ªèº«å±æ€§ï¼Œ<code>set</code> å°†åœ¨targetçš„åŸå‹ä¸Šè¢«è°ƒç”¨</li></ul><p>å…¶å®ƒæ“ä½œåªä¼šå½±å“è‡ªèº«çš„å±æ€§ï¼Œå¯¹åŸå‹é“¾æ²¡æœ‰æ•ˆæœã€‚</p><p>æ›´å¤šå¯å‚è€ƒï¼š</p><ul><li><a href="https://tc39.es/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots" target="_blank" rel="noreferrer">æ™®é€šå¯¹è±¡å†…éƒ¨æ–¹æ³•å’Œå†…éƒ¨æ§½</a></li></ul><p id="7.5"></p><h3 id="_7-5-reflect" tabindex="-1">7.5 Reflect <a class="header-anchor" href="#_7-5-reflect" aria-hidden="true">#</a></h3><p>ğŸ“š å…¨å±€å¯¹è±¡ <code>Reflect</code> ä»¥æ–¹æ³•å½¢å¼å®ç°æ‰€æœ‰JSå…ƒå¯¹è±¡åè®®ï¼ˆ<code>MOP</code>ï¼‰ æ‹¦æˆªæ“ä½œã€‚æ–¹æ³•åå’Œhandleræ–¹æ³•ç›¸åŒï¼Œ<strong>å¸®åŠ©å°†handleræ“ä½œè½¬å‘åˆ°targetä¸Šã€‚</strong></p><ul><li><code>Reflect.apply(target, thisArgument, argumentsList): any</code> : ç±»ä¼¼ <code>Function.prototype.apply()</code></li><li><code>Reflect.construct(target, argumentsList, newTarget=target): object</code>: <code>new</code> æ“ä½œç¬¦ä½œä¸ºå‡½æ•°ã€‚<code>target</code> æ˜¯å¾…è°ƒç”¨çš„æ„é€ å‡½æ•°ï¼Œå¯é€‰å‚æ•° <code>newTarget</code> æŒ‡å‘æ„é€ å™¨ï¼Œè¯¥æ„é€ å™¨å¼€å¯å½“å‰æ„é€ å™¨è°ƒç”¨çš„é“¾</li><li><code>Reflect.defineProperty(target, propertyKey, propDesc): boolean</code>: ç±»ä¼¼ <code>Object.defineProperty()</code></li><li><code>Reflect.deleteProperty(target, propertyKey): boolean</code>: <code>delete</code> æ“ä½œç¬¦å½“åšå‡½æ•°ã€‚å·¥ä½œæ–¹å¼æœ‰ç¨å¾®ä¸åŒï¼šå¦‚æœæˆåŠŸåˆ é™¤å±æ€§æˆ–è€…è¯¥å±æ€§ä¸å­˜åœ¨åˆ™è¿”å›trueã€‚å”¯ä¸€èƒ½ä¿æŠ¤å±æ€§ä¸è¢«åˆ é™¤çš„æ–¹å¼æ˜¯ï¼Œå°†å±æ€§å˜ä¸ºä¸å¯é…ç½®ã€‚åœ¨æ™®é€šæ¨¡å¼ä¸‹ï¼Œdeleteæ“ä½œç¬¦è¿”å›ç›¸åŒç»“æœï¼Œä½†åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒæŠ›å‡ºé”™è¯¯</li><li>ğŸ¤© <code>Reflect.get(tareget, propertyKey, receiver=target):any</code>: è·å–å±æ€§å‡½æ•°ã€‚å¯é€‰å‚æ•° <code>receiver</code> æŒ‡å‘getå¼€å§‹çš„å¯¹è±¡ã€‚<em>å½“ <code>get</code> ä¹‹ååˆ°è¾¾åŸå‹é“¾ä¸­çš„ <code>getter</code>æ—¶éœ€è¦ï¼Œå®ƒå°†æä¾› <code>this</code> çš„å€¼ ğŸ“š</em></li><li><code>Reflect.getOwnPropertyDescriptor(target, propertyKey): undeinfed|PropDesc</code>: åŒ <code>Object.getOwnPropertyDescriptor()</code></li><li><code>Reflect.getPrototypeOf(target): null|object</code>: åŒ <code>Object.getPrototypeOf()</code></li><li><code>Reflect.has(target, propertyKey): boolean</code> : <code>in</code> æ“ä½œç¬¦ä½œä¸ºå‡½æ•°</li><li><code>Reflect.isExtensible(target): boolean</code>: åŒ <code>Object.isExtensible()</code></li><li><code>Reflect.ownKeys(target): Array&lt;PropertyKey&gt;</code>: è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å±æ€§keysçš„æ•°ç»„ï¼šè‡ªèº«æ‰€æœ‰å¯æšä¸¾å’Œä¸å¯æšä¸¾çš„å­—ç¬¦ä¸²keys &amp; symbol keys</li><li><code>Reflect.set(target, propertyKey, value, receiver=target): boolean</code>ï¼šè®¾ç½®å±æ€§çš„å‡½æ•°</li><li><code>Reflect.setPrototypeOf(target, proto): boolean</code>ï¼šåˆ›å»ºå¯¹è±¡åŸå‹çš„ä¸€ç§æ–°çš„æ ‡å‡†æ–¹å¼ã€‚å½“å‰éæ ‡å‡†æ–¹å¼å¤§å¤šæ•°å¼•æ“éƒ½ç”Ÿæ•ˆï¼Œéƒ½æ˜¯è®¾ç½®ç‰¹æ®Šçš„ <code>__proto__</code> å±æ€§</li></ul><p>å‡ ä¸ªæ–¹æ³•éƒ½è¿”å›å¸ƒå°”ç»“æœï¼Œå¯¹äº <code>has() &amp; isExtensible()</code>, è¿™æ˜¯è¯¥æ“ä½œçš„ç»“æœå€¼ã€‚è€ŒåŒå…¶å®ƒçš„æ–¹æ³•ï¼Œåˆ™è¡¨ç¤ºè¯¥æ“ä½œæ˜¯å¦æˆåŠŸã€‚</p><h4 id="reflecté™¤äº†è½¬å‘æ“ä½œä¹‹å¤–çš„æƒ…æ™¯" tabindex="-1">Reflecté™¤äº†è½¬å‘æ“ä½œä¹‹å¤–çš„æƒ…æ™¯ <a class="header-anchor" href="#reflecté™¤äº†è½¬å‘æ“ä½œä¹‹å¤–çš„æƒ…æ™¯" aria-hidden="true">#</a></h4><p>é™¤äº†è½¬å‘æ“ä½œï¼Œ<a href="https://github.com/tvcutsem/harmony-reflect/wiki" target="_blank" rel="noreferrer">ä¸ºä»€ä¹ˆReflect æœ‰ç”¨</a>ï¼š</p><ul><li><p>ä¸åŒè¿”å›å€¼ï¼š<code>Reflect</code> é‡å¤äº†ä¸‹é¢ <code>Object</code> çš„æ–¹æ³•ï¼Œä½†æ˜¯å®ƒçš„æ–¹æ³•è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥æ“ä½œæ˜¯å¦æˆåŠŸï¼Œè€ŒObjectæ–¹æ³•è¿”å›è¢«ä¿®æ”¹çš„å¯¹è±¡</p><ul><li><code>Object.defineProperty(obj, propertyKey, propDesc): object</code></li><li><code>Object.preventExtensions(obj): object</code></li><li><code>Object.setPrototypeOf(obj, proto): object</code></li></ul></li><li><p>æ“ä½œç¬¦ä½œä¸ºå‡½æ•°ï¼šä¸‹é¢Reflectæ–¹æ³•å®ç°çš„åŠŸèƒ½åªæœ‰æ“ä½œç¬¦æ‰èƒ½ç›¸å¯¹åº”ï¼š</p><ul><li><code>Reflect.construct(target, argumentsList, newTarget=target): object</code>ï¼šå¯¹åº” <code>new XX</code></li><li><code>Reflect.deleteProperty(target, propertyKey): boolean</code>ï¼šå¯¹åº” <code>delete xxx.prop</code></li><li><code>Reflect.get(target, propKey, receiver): any</code>ï¼šå¯¹åº” <code>xxx.prop æˆ– xxx[prop]</code></li><li><code>Reflect.has(target, propKey): boolean</code>ï¼šå¯¹åº” <code>prop in xxx</code></li><li><code>Reflect.set(target, propertyKey, value, receiver=target): boolean</code>ï¼šå¯¹åº” <code>xxx.prop = value</code></li></ul></li><li><p>æ›´çŸ­ç‰ˆæœ¬ <code>apply()</code>: å¦‚æœæˆ‘ä»¬æƒ³å®Œå…¨å®‰å…¨çš„å¯¹æŸä¸ªå‡½æ•°è°ƒç”¨ <code>apply</code>ï¼Œæˆ‘ä»¬ä¸èƒ½é€šè¿‡åŠ¨æ€åˆ†å‘çš„æ–¹å¼ï¼Œå› ä¸ºå‡½æ•°å¯èƒ½æ‹¥æœ‰ä¸€ä¸ªåŒåçš„keyä¸º <code>apply</code> çš„å±æ€§ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">func</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#A6ACCD;">(thisArg</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> argArray) </span><span style="color:#676E95;font-style:italic;">// ä¸å®‰å…¨</span></span>
<span class="line"><span style="color:#FFCB6B;">Function</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">apply</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#A6ACCD;">(func</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> thisArg</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> argArray) </span><span style="color:#676E95;font-style:italic;">// å®‰å…¨</span></span>
<span class="line"></span></code></pre></div><p>ä½¿ç”¨ <code>Reflect.apply()</code> æ›´çŸ­å®ç°å®‰å…¨ç‰ˆæœ¬ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#A6ACCD;">(func</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> thisArg</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> argArray)</span></span>
<span class="line"></span></code></pre></div></li><li><p>åˆ é™¤å±æ€§æ˜¯ä¸å­˜åœ¨å¼‚å¸¸ï¼š<code>delete</code> æ“ä½œç¬¦åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹åˆ é™¤ä¸€ä¸ªä¸å¯é…ç½®çš„è‡ªèº«å±æ€§æ—¶ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è€Œ <code>Reflect.deleteProperty()</code> è¿”å› <code>false</code></p></li></ul><h4 id="object-vs-reflect" tabindex="-1">Object.* vs Reflect.* <a class="header-anchor" href="#object-vs-reflect" aria-hidden="true">#</a></h4><p><code>Object.*</code> å°†æ“ä½œè¿è¡Œåœ¨å¯¹å…¶æ„Ÿå…´è¶£çš„æ™®é€šåº”ç”¨ä¸­ï¼Œè€Œ <code>Reflect.*</code> å°†æ“ä½œè¿è¡Œåœ¨æ›´åº•å±‚</p><p id="8"></p><h2 id="_8ï¸âƒ£-æ€»ç»“" tabindex="-1">8ï¸âƒ£ æ€»ç»“ <a class="header-anchor" href="#_8ï¸âƒ£-æ€»ç»“" aria-hidden="true">#</a></h2><p>è¿™é‡Œæ€»ç»“æ·±å…¥äº†è§£Proxy APIã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœå¯¹æ€§èƒ½æœ‰ä¸¥æ ¼è¦æ±‚çš„ï¼Œä»£ç†ä¼šé™ä½ä»£ç æ€§èƒ½ã€‚</p><p>å¦å¤–ï¼Œæ€§èƒ½æœ‰æ—¶æ²¡é‚£ä¹ˆé‡è¦ï¼Œæ­¤æ—¶ä»£ç†å¸¦æ¥çš„å…ƒç¼–ç¨‹åˆ™å¾ˆæœ‰ç”¨ã€‚</p><p>åŸæ–‡ï¼š</p><ul><li><a href="https://exploringjs.com/deep-js/ch_proxies.html#further-reading-proxies" target="_blank" rel="noreferrer">Metaprogramming with Proxies</a></li></ul><p>2022å¹´07æœˆ03æ—¥13:54:56</p><p>è€—æ—¶5å¤© ğŸ˜…</p>`,356),e=[o];function t(c,r,y,F,D,i){return n(),a("div",null,e)}const d=s(p,[["render",t]]);export{C as __pageData,d as default};
